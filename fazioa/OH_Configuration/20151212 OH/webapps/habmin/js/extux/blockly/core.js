/*! HABmin 2014-06-20 */
"use strict";var Blockly={};Blockly.pathToBlockly="./",Blockly.SVG_NS="http://www.w3.org/2000/svg",Blockly.HTML_NS="http://www.w3.org/1999/xhtml",Blockly.HSV_SATURATION=.45,Blockly.HSV_VALUE=.65,Blockly.makeColour=function(a){return Ext.draw.Color.fromHSL(a,Blockly.HSV_SATURATION,Blockly.HSV_VALUE).toString()},Blockly.INPUT_VALUE=1,Blockly.OUTPUT_VALUE=2,Blockly.NEXT_STATEMENT=3,Blockly.PREVIOUS_STATEMENT=4,Blockly.DUMMY_INPUT=5,Blockly.ALIGN_LEFT=-1,Blockly.ALIGN_CENTRE=0,Blockly.ALIGN_RIGHT=1,Blockly.OPPOSITE_TYPE=[],Blockly.OPPOSITE_TYPE[Blockly.INPUT_VALUE]=Blockly.OUTPUT_VALUE,Blockly.OPPOSITE_TYPE[Blockly.OUTPUT_VALUE]=Blockly.INPUT_VALUE,Blockly.OPPOSITE_TYPE[Blockly.NEXT_STATEMENT]=Blockly.PREVIOUS_STATEMENT,Blockly.OPPOSITE_TYPE[Blockly.PREVIOUS_STATEMENT]=Blockly.NEXT_STATEMENT,Blockly.SOUNDS_=Object.create(null),Blockly.selected=null,Blockly.readOnly=!1,Blockly.highlightedConnection_=null,Blockly.localConnection_=null,Blockly.DRAG_RADIUS=5,Blockly.SNAP_RADIUS=20,Blockly.BUMP_DELAY=250,Blockly.COLLAPSE_CHARS=30,Blockly.mainWorkspace=null,Blockly.clipboard_=null,Blockly.svgSize=function(){return{width:Blockly.svg.cachedWidth_,height:Blockly.svg.cachedHeight_}},Blockly.svgResize=function(){var a=Blockly.svg,b=a.parentNode,c=b.clientWidth,d=b.clientHeight;a.cachedWidth_!=c&&(a.setAttribute("width",c+"px"),a.cachedWidth_=c),a.cachedHeight_!=d&&(a.setAttribute("height",d+"px"),a.cachedHeight_=d),Blockly.mainWorkspace.scrollbar&&Blockly.mainWorkspace.scrollbar.resize(),Blockly.mainWorkspace.trashcan&&Blockly.mainWorkspace.trashcan.position_()},Blockly.onMouseDown_=function(a){console.log("Blockly mouse down"),Blockly.svgResize(),Blockly.terminateDrag_(),Blockly.hideChaff();var b=a.target&&a.target.nodeName&&"svg"==a.target.nodeName.toLowerCase();!Blockly.readOnly&&Blockly.selected&&b&&Blockly.selected.unselect(),a.target==Blockly.svg&&Blockly.isRightButton(a)?Blockly.showContextMenu_(a):(Blockly.readOnly||b)&&Blockly.mainWorkspace.scrollbar&&(Blockly.mainWorkspace.dragMode=!0,Blockly.mainWorkspace.startDragMouseX=a.clientX,Blockly.mainWorkspace.startDragMouseY=a.clientY,Blockly.mainWorkspace.startDragMetrics=Blockly.mainWorkspace.getMetrics(),Blockly.mainWorkspace.startScrollX=Blockly.mainWorkspace.scrollX,Blockly.mainWorkspace.startScrollY=Blockly.mainWorkspace.scrollY)},Blockly.onMouseUp_=function(){Blockly.setCursorHand_(!1),Blockly.mainWorkspace.dragMode=!1},Blockly.onMouseMove_=function(a){if(Blockly.mainWorkspace.dragMode){Blockly.removeAllRanges();var b=a.clientX-Blockly.mainWorkspace.startDragMouseX,c=a.clientY-Blockly.mainWorkspace.startDragMouseY,d=Blockly.mainWorkspace.startDragMetrics,e=Blockly.mainWorkspace.startScrollX+b,f=Blockly.mainWorkspace.startScrollY+c;e=Math.min(e,-d.contentLeft),f=Math.min(f,-d.contentTop),e=Math.max(e,d.viewWidth-d.contentLeft-d.contentWidth),f=Math.max(f,d.viewHeight-d.contentTop-d.contentHeight),Blockly.mainWorkspace.scrollbar.set(-e-d.contentLeft,-f-d.contentTop)}},Blockly.onKeyDown_=function(a){if(!Blockly.isTargetInput_(a))if(27==a.keyCode)Blockly.hideChaff();else if(8==a.keyCode||46==a.keyCode)try{Blockly.selected&&Blockly.selected.isDeletable()&&(Blockly.hideChaff(),Blockly.selected.dispose(!0,!0))}finally{a.preventDefault()}else(a.altKey||a.ctrlKey||a.metaKey)&&(Blockly.selected&&Blockly.selected.isDeletable()&&Blockly.selected.workspace==Blockly.mainWorkspace&&(Blockly.hideChaff(),67==a.keyCode?Blockly.copy_(Blockly.selected):88==a.keyCode&&(Blockly.copy_(Blockly.selected),Blockly.selected.dispose(!0,!0))),86==a.keyCode&&Blockly.clipboard_&&Blockly.mainWorkspace.paste(Blockly.clipboard_))},Blockly.terminateDrag_=function(){Blockly.Block.terminateDrag_(),Blockly.Flyout.terminateDrag_()},Blockly.copy_=function(a){var b=Blockly.Json.blockToDom_(a);Blockly.Json.deleteNext(b);var c=a.getRelativeToSurfaceXY();b.setAttribute("x",Blockly.RTL?-c.x:c.x),b.setAttribute("y",c.y),Blockly.clipboard_=b},Blockly.showContextMenu_=function(a){if(!Blockly.readOnly){var b=[];if(Blockly.collapse){for(var c=!1,d=!1,e=Blockly.mainWorkspace.getTopBlocks(!1),f=0;f<e.length;f++)e[f].isCollapsed()?c=!0:d=!0;var g={enabled:d};g.text=Blockly.Msg.COLLAPSE_ALL,g.callback=function(){for(var a=0;a<e.length;a++)e[a].setCollapsed(!0)},b.push(g);var h={enabled:c};h.text=Blockly.Msg.EXPAND_ALL,h.callback=function(){for(var a=0;a<e.length;a++)e[a].setCollapsed(!1)},b.push(h)}Blockly.ContextMenu.show(a,b)}},Blockly.onContextMenu_=function(a){Blockly.isTargetInput_(a)||a.preventDefault()},Blockly.hideChaff=function(){Blockly.Tooltip.hide(),Blockly.WidgetDiv.hide()},Blockly.removeAllRanges=function(){if(window.getSelection){var a=window.getSelection();a&&a.removeAllRanges&&(a.removeAllRanges(),window.setTimeout(function(){try{window.getSelection().removeAllRanges()}catch(a){}},0))}},Blockly.isTargetInput_=function(a){return"textarea"==a.target.type||"text"==a.target.type},Blockly.loadAudio_=function(a,b){if(window.Audio&&a.length){for(var c,d=new window.Audio,e=0;e<a.length;e++){var f=a[e],g=f.match(/\.(\w+)$/);if(g&&d.canPlayType("audio/"+g[1])){c=new window.Audio(Blockly.pathToBlockly+f);break}}c&&c.play&&(c.volume=.01,c.play(),Blockly.SOUNDS_[b]=c)}},Blockly.playAudio=function(a,b){var c=Blockly.SOUNDS_[a];if(c){var d;d=Ext.is.Phone||Ext.is.Tablet?c:c.cloneNode(),d.volume=void 0===b?1:b,d.play()}},Blockly.setCursorHand_=function(a){if(!Blockly.readOnly){var b="";a&&(b="url("+Blockly.pathToBlockly+"media/handclosed.cur) 7 3, auto"),Blockly.selected&&(Blockly.selected.getSvgRoot().style.cursor=b),Blockly.svg.style.cursor=b}},Blockly.getMainWorkspaceMetrics_=function(){var a=Blockly.svgSize(),b=a.width-Blockly.Scrollbar.scrollbarThickness,c=a.height-Blockly.Scrollbar.scrollbarThickness;try{var d=Blockly.mainWorkspace.getCanvas().getBBox()}catch(e){return null}if(Blockly.mainWorkspace.scrollbar)var f=Math.min(d.x-b/2,d.x+d.width-b),g=Math.max(d.x+d.width+b/2,d.x+b),h=Math.min(d.y-c/2,d.y+d.height-c),i=Math.max(d.y+d.height+c/2,d.y+c);else var f=d.x,g=f+d.width,h=d.y,i=h+d.height;var j={viewHeight:a.height,viewWidth:a.width,contentHeight:i-h,contentWidth:g-f,viewTop:-Blockly.mainWorkspace.scrollY,viewLeft:-Blockly.mainWorkspace.scrollX,contentTop:h,contentLeft:f,absoluteTop:0,absoluteLeft:0};return j},Blockly.setMainWorkspaceMetrics_=function(a){if(!Blockly.mainWorkspace.scrollbar)throw"Attempt to set main workspace scroll without scrollbars.";var b=Blockly.getMainWorkspaceMetrics_();Ext.isNumber(a.x)&&(Blockly.mainWorkspace.scrollX=-b.contentWidth*a.x-b.contentLeft),Ext.isNumber(a.y)&&(Blockly.mainWorkspace.scrollY=-b.contentHeight*a.y-b.contentTop);var c="translate("+(Blockly.mainWorkspace.scrollX+b.absoluteLeft)+","+(Blockly.mainWorkspace.scrollY+b.absoluteTop)+")";Blockly.mainWorkspace.getCanvas().setAttribute("transform",c),Blockly.mainWorkspace.getBubbleCanvas().setAttribute("transform",c)},Blockly.doCommand=function(a){a()},Blockly.addChangeListener=function(a){return Blockly.bindEvent_(Blockly.mainWorkspace.getCanvas(),"blocklyWorkspaceChange",null,a)},Blockly.removeChangeListener=function(a){Blockly.unbindEvent_(a)},Blockly.getMainWorkspace=function(){return Blockly.mainWorkspace},Blockly.inherits=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a},Blockly.mixin=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},Blockly.caseInsensitiveCompare=function(a,b){var c=String(a).toLowerCase(),d=String(b).toLowerCase();return d>c?-1:c==d?0:1},Blockly.removeChildren=function(a){for(var b;b=a.firstChild;)a.removeChild(b)},Blockly.uidCounter_=0,Blockly.getUidCounter=function(){return Blockly.uidCounter_},Blockly.setUidCounter=function(a){Blockly.uidCounter_=a},Blockly.genUid=function(){var a=(++Blockly.uidCounter_).toString();return a},Blockly.Block=function(){},Blockly.Block.obtain=function(a,b){var c=new Blockly.Block;return c.initialize(a,b),c},Blockly.Block.prototype.initialize=function(a,b){this.id=Blockly.genUid(),a.addTopBlock(this),this.fill(a,b),Ext.isFunction(this.onchange)&&Blockly.bindEvent_(a.getCanvas(),"blocklyWorkspaceChange",this,this.onchange)},Blockly.Block.prototype.fill=function(a,b){if(this.outputConnection=null,this.nextConnection=null,this.previousConnection=null,this.inputList=[],this.inputsInline=!1,this.rendered=!1,this.disabled=!1,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.deletable_=!0,this.movable_=!0,this.editable_=!0,this.collapsed_=!1,this.workspace=a,this.isInFlyout=a.isFlyout,b){this.type=b;var c=Blockly.Blocks[b];"object"!=typeof c&&console.log('Error: "%s" is an unknown language block.',b),Blockly.mixin(this,c)}Ext.isFunction(this.init)&&this.init()},Blockly.Block.getById=function(a,b){return b.getBlockById(a)},Blockly.Block.prototype.svg_=null,Blockly.Block.prototype.mutator=null,Blockly.Block.prototype.comment=null,Blockly.Block.prototype.warning=null,Blockly.Block.prototype.getIcons=function(){var a=[];return this.mutator&&a.push(this.mutator),this.comment&&a.push(this.comment),this.warning&&a.push(this.warning),a},Blockly.Block.prototype.initSvg=function(){this.svg_=new Blockly.BlockSvg(this),this.svg_.init(),Blockly.readOnly||Blockly.bindEvent_(this.svg_.getRootElement(),"mousedown",this,this.onMouseDown_),this.workspace.getCanvas().appendChild(this.svg_.getRootElement())},Blockly.Block.prototype.getSvgRoot=function(){return this.svg_&&this.svg_.getRootElement()},Blockly.Block.dragMode_=0,Blockly.Block.onMouseUpWrapper_=null,Blockly.Block.onMouseMoveWrapper_=null,Blockly.Block.terminateDrag_=function(){Blockly.Block.onMouseUpWrapper_&&(Blockly.unbindEvent_(Blockly.Block.onMouseUpWrapper_),Blockly.Block.onMouseUpWrapper_=null),Blockly.Block.onMouseMoveWrapper_&&(Blockly.unbindEvent_(Blockly.Block.onMouseMoveWrapper_),Blockly.Block.onMouseMoveWrapper_=null);var a=Blockly.selected;if(2==Blockly.Block.dragMode_&&a){var b=a.getRelativeToSurfaceXY(),c=b.x-a.startDragX,d=b.y-a.startDragY;a.moveConnections_(c,d),delete a.draggedBubbles_,a.setDragging_(!1),a.render();var e=new Ext.util.DelayedTask(a.bumpNeighbours_,a);e.delay(Blockly.BUMP_DELAY),Blockly.mainWorkspace.scrollbar&&Blockly.mainWorkspace.scrollbar.resize()}a&&a.workspace.fireChangeEvent(),Blockly.Block.dragMode_=0},Blockly.Block.prototype.select=function(){"object"!=typeof this.svg_&&console.log("Block is not rendered."),Blockly.selected&&Blockly.selected.unselect(),Blockly.selected=this,this.svg_.addSelect(),Blockly.fireUiEvent(this.workspace.getCanvas(),"blocklySelectChange")},Blockly.Block.prototype.unselect=function(){"object"!=typeof this.svg_&&console.log("Block is not rendered."),Blockly.selected=null,this.svg_.removeSelect(),Blockly.fireUiEvent(this.workspace.getCanvas(),"blocklySelectChange")},Blockly.Block.prototype.dispose=function(a,b,c){this.rendered=!1,this.unplug(a),b&&this.svg_&&this.svg_.disposeUiEffect(),this.workspace&&!c&&(this.workspace.removeTopBlock(this),this.workspace=null),Blockly.selected==this&&(Blockly.selected=null,Blockly.terminateDrag_()),Blockly.ContextMenu.currentBlock==this&&Blockly.ContextMenu.hide();for(var d=this.childBlocks_.length-1;d>=0;d--)this.childBlocks_[d].dispose(!1);for(var e=this.getIcons(),d=0;d<e.length;d++)e[d].dispose();for(var f,d=0;f=this.inputList[d];d++)f.dispose();this.inputList=[];for(var g=this.getConnections_(!0),d=0;d<g.length;d++){var h=g[d];h.targetConnection&&h.disconnect(),g[d].dispose()}this.svg_&&(this.svg_.dispose(),this.svg_=null)},Blockly.Block.prototype.unplug=function(a,b){if(b=b&&!!this.getParent(),this.outputConnection)this.outputConnection.targetConnection&&this.setParent(null);else{var c=null;if(this.previousConnection&&this.previousConnection.targetConnection&&(c=this.previousConnection.targetConnection,this.setParent(null)),a&&this.nextConnection&&this.nextConnection.targetConnection){var d=this.nextConnection.targetConnection,e=this.nextConnection.targetBlock();e.setParent(null),c&&c.connect(d)}}if(b){var f=Blockly.SNAP_RADIUS*(Blockly.RTL?-1:1),g=2*Blockly.SNAP_RADIUS;this.moveBy(f,g)}},Blockly.Block.prototype.getRelativeToSurfaceXY=function(){var a=0,b=0;if(this.svg_){var c=this.svg_.getRootElement();do{var d=Blockly.getRelativeXY_(c);a+=d.x,b+=d.y,c=c.parentNode}while(c&&c!=this.workspace.getCanvas())}return{x:a,y:b}},Blockly.Block.prototype.moveBy=function(a,b){var c=this.getRelativeToSurfaceXY();this.svg_.getRootElement().setAttribute("transform","translate("+(c.x+a)+", "+(c.y+b)+")"),this.moveConnections_(a,b)},Blockly.Block.prototype.getHeightWidth=function(){var a=this.svg_.height,b=this.svg_.width,c=this.nextConnection&&this.nextConnection.targetBlock();if(c){var d=c.getHeightWidth();a+=d.height-4,b=Math.max(b,d.width)}return{height:a,width:b}},Blockly.Block.prototype.onMouseDown_=function(a){if(console.log("block.onMouseDown "+this.id+" ("+a.clientX+","+a.clientY+")"),!this.isInFlyout){if(Blockly.mainWorkspace.scrollbar&&Blockly.mainWorkspace.scrollbar.resize(),Blockly.terminateDrag_(),this.select(),Blockly.hideChaff(),Blockly.isRightButton(a))this.showContextMenu_(a);else{if(!this.isMovable())return;Blockly.removeAllRanges(),Blockly.setCursorHand_(!0);var b=this.getRelativeToSurfaceXY();this.startDragX=b.x,this.startDragY=b.y,this.startDragMouseX=a.clientX,this.startDragMouseY=a.clientY,Blockly.Block.dragMode_=1,Blockly.Block.onMouseUpWrapper_=Blockly.bindEvent_(document,"mouseup",this,this.onMouseUp_),Blockly.Block.onMouseMoveWrapper_=Blockly.bindEvent_(document,"mousemove",this,this.onMouseMove_),this.draggedBubbles_=[];for(var c,d=this.getDescendants(),e=0;c=d[e];e++)for(var f=c.getIcons(),g=0;g<f.length;g++){var h=f[g].getIconLocation();h.bubble=f[g],this.draggedBubbles_.push(h)}}a.stopPropagation()}},Blockly.Block.prototype.onMouseUp_=function(a){console.log("block.onMouseUp "+this.id+" ("+a.clientX+","+a.clientY+")");var b=this;Blockly.doCommand(function(){if(Blockly.terminateDrag_(),Blockly.selected&&Blockly.highlightedConnection_){if(Blockly.localConnection_.connect(Blockly.highlightedConnection_),b.svg_){var a;a=Blockly.localConnection_.isSuperior()?Blockly.highlightedConnection_:Blockly.localConnection_,a.sourceBlock_.svg_.connectionUiEffect()}b.workspace.trashcan&&b.workspace.trashcan.isOpen&&b.workspace.trashcan.close()}else if(b.workspace.trashcan&&b.workspace.trashcan.isOpen){var c=b.workspace.trashcan,d=new Ext.util.DelayedTask(c.close,c);d.delay(100),Blockly.selected.dispose(!1,!0),Blockly.fireUiEvent(window,"resize")}Blockly.highlightedConnection_&&(Blockly.highlightedConnection_.unhighlight(),Blockly.highlightedConnection_=null)})},Blockly.Block.prototype.showHelp_=function(){var a=Ext.isFunction(this.helpUrl)?this.helpUrl():this.helpUrl;a&&window.open(a)},Blockly.Block.prototype.duplicate_=function(){var a=Blockly.Json.blockToDom_(this);Blockly.Json.deleteNext(a);var b=Blockly.Json.domToBlock(this.workspace,a),c=this.getRelativeToSurfaceXY();return Blockly.RTL?c.x-=Blockly.SNAP_RADIUS:c.x+=Blockly.SNAP_RADIUS,c.y+=2*Blockly.SNAP_RADIUS,b.moveBy(c.x,c.y),b.select(),b},Blockly.Block.prototype.showContextMenu_=function(a){if(!Blockly.readOnly&&this.contextMenu){var b=this,c=[];if(this.isDeletable()&&!b.isInFlyout){var d={text:Blockly.Msg.DUPLICATE_BLOCK,enabled:!0,callback:function(){b.duplicate_()}};if(this.getDescendants().length>this.workspace.remainingCapacity()&&(d.enabled=!1),c.push(d),this.isEditable()&&!this.collapsed_){var e={enabled:!0};this.comment?(e.text=Blockly.Msg.REMOVE_COMMENT,e.callback=function(){b.setCommentText(null)}):(e.text=Blockly.Msg.ADD_COMMENT,e.callback=function(){b.setCommentText("")}),c.push(e)}if(!this.collapsed_)for(var f=0;f<this.inputList.length;f++)if(this.inputList[f].type==Blockly.INPUT_VALUE){var g={enabled:!0};g.text=this.inputsInline?Blockly.Msg.EXTERNAL_INPUTS:Blockly.Msg.INLINE_INPUTS,g.callback=function(){b.setInputsInline(!b.inputsInline)},c.push(g);break}if(Blockly.collapse)if(this.collapsed_){var h={enabled:!0};h.text=Blockly.Msg.EXPAND_BLOCK,h.callback=function(){b.setCollapsed(!1)},c.push(h)}else{var i={enabled:!0};i.text=Blockly.Msg.COLLAPSE_BLOCK,i.callback=function(){b.setCollapsed(!0)},c.push(i)}var j={text:this.disabled?Blockly.Msg.ENABLE_BLOCK:Blockly.Msg.DISABLE_BLOCK,enabled:!this.getInheritedDisabled(),callback:function(){b.setDisabled(!b.disabled)}};c.push(j);var k=this.getDescendants().length;b.nextConnection&&b.nextConnection.targetConnection&&(k-=this.nextConnection.targetBlock().getDescendants().length);var l={text:1==k?Blockly.Msg.DELETE_BLOCK:Blockly.Msg.DELETE_X_BLOCKS.replace("%1",String(k)),enabled:!0,callback:function(){b.dispose(!0,!0)}};c.push(l)}var m=Ext.isFunction(this.helpUrl)?this.helpUrl():this.helpUrl,n={enabled:!!m};n.text=Blockly.Msg.HELP,n.callback=function(){b.showHelp_()},c.push(n),this.customContextMenu&&!b.isInFlyout&&this.customContextMenu(c),Blockly.ContextMenu.show(a,c),Blockly.ContextMenu.currentBlock=this}},Blockly.Block.prototype.getConnections_=function(a){var b=[];if((a||this.rendered)&&(this.outputConnection&&b.push(this.outputConnection),this.nextConnection&&b.push(this.nextConnection),this.previousConnection&&b.push(this.previousConnection),a||!this.collapsed_))for(var c,d=0;c=this.inputList[d];d++)c.connection&&b.push(c.connection);return b},Blockly.Block.prototype.moveConnections_=function(a,b){if(this.rendered){for(var c=this.getConnections_(!1),d=0;d<c.length;d++)c[d].moveBy(a,b);for(var e=this.getIcons(),d=0;d<e.length;d++)e[d].computeIconLocation();for(var d=0;d<this.childBlocks_.length;d++)this.childBlocks_[d].moveConnections_(a,b)}},Blockly.Block.prototype.setDragging_=function(a){a?this.svg_.addDragging():this.svg_.removeDragging();for(var b=0;b<this.childBlocks_.length;b++)this.childBlocks_[b].setDragging_(a)},Blockly.Block.prototype.onMouseMove_=function(a){console.log("block.onMouseMove "+this.id+" ("+a.clientX+","+a.clientY+")");var b=this;Blockly.doCommand(function(){if(console.log("block.onMouseMove "+b.id+" ** 1 **"),"mousemove"==a.type&&a.clientX<=1&&0==a.clientY&&0==a.button)return console.log("block.onMouseMove "+b.id+" ** 2 **"),void a.stopPropagation();Blockly.removeAllRanges();var c=a.clientX-b.startDragMouseX,d=a.clientY-b.startDragMouseY;if(1==Blockly.Block.dragMode_){var e=Math.sqrt(Math.pow(c,2)+Math.pow(d,2));e>Blockly.DRAG_RADIUS&&(Blockly.Block.dragMode_=2,b.setParent(null),b.setDragging_(!0))}if(2==Blockly.Block.dragMode_){console.log("block.onMouseMove "+b.id+" ** 3 **");var f=b.startDragX+c,g=b.startDragY+d;b.svg_.getRootElement().setAttribute("transform","translate("+f+", "+g+")");for(var h=0;h<b.draggedBubbles_.length;h++){var i=b.draggedBubbles_[h];i.bubble.setIconLocation(i.x+c,i.y+d)}for(var j=b.getConnections_(!1),k=null,l=null,m=Blockly.SNAP_RADIUS,h=0;h<j.length;h++){var n=j[h],o=n.closest(m,c,d);o.connection&&(k=o.connection,l=n,m=o.radius)}Blockly.highlightedConnection_&&Blockly.highlightedConnection_!=k&&(Blockly.highlightedConnection_.unhighlight(),Blockly.highlightedConnection_=null,Blockly.localConnection_=null),k&&k!=Blockly.highlightedConnection_&&(k.highlight(),Blockly.highlightedConnection_=k,Blockly.localConnection_=l),b.workspace.trashcan&&b.isDeletable()&&b.workspace.trashcan.onMouseMove(a),console.log("block.onMouseMove "+b.id+" ** 9 **")}console.log("block.onMouseMove "+b.id+" ** 10 **"),a.stopPropagation(),console.log("block.onMouseMove "+b.id+" ** 11 **")})},Blockly.Block.prototype.bumpNeighbours_=function(){if(0==Blockly.Block.dragMode_){var a=this.getRootBlock();if(!a.isInFlyout)for(var b=this.getConnections_(!1),c=0;c<b.length;c++){var d=b[c];d.targetConnection&&d.isSuperior()&&d.targetBlock().bumpNeighbours_();for(var e=d.neighbours_(Blockly.SNAP_RADIUS),f=0;f<e.length;f++){var g=e[f];d.targetConnection&&g.targetConnection||g.sourceBlock_.getRootBlock()!=a&&(d.isSuperior()?g.bumpAwayFrom_(d):d.bumpAwayFrom_(g))}}}},Blockly.Block.prototype.getParent=function(){return this.parentBlock_},Blockly.Block.prototype.getSurroundParent=function(){for(var a=this;;){do{var b=a;if(a=a.getParent(),!a)return null}while(a.nextConnection&&a.nextConnection.targetBlock()==b);return a}},Blockly.Block.prototype.getRootBlock=function(){var a,b=this;do a=b,b=a.parentBlock_;while(b);return a},Blockly.Block.prototype.getChildren=function(){return this.childBlocks_},Blockly.Block.prototype.setParent=function(a){if(this.parentBlock_){for(var b,c=this.parentBlock_.childBlocks_,d=0;b=c[d];d++)if(b==this){c.splice(d,1);break}var e=this.getRelativeToSurfaceXY();this.workspace.getCanvas().appendChild(this.svg_.getRootElement()),this.svg_.getRootElement().setAttribute("transform","translate("+e.x+", "+e.y+")"),this.parentBlock_=null,this.previousConnection&&this.previousConnection.targetConnection&&this.previousConnection.disconnect(),this.outputConnection&&this.outputConnection.targetConnection&&this.outputConnection.disconnect()}else this.workspace.getTopBlocks(!1).indexOf(this)&&this.workspace.removeTopBlock(this);if(this.parentBlock_=a,a){a.childBlocks_.push(this);var f=this.getRelativeToSurfaceXY();a.svg_&&this.svg_&&a.svg_.getRootElement().appendChild(this.svg_.getRootElement());var g=this.getRelativeToSurfaceXY();this.moveConnections_(g.x-f.x,g.y-f.y)}else this.workspace.addTopBlock(this)},Blockly.Block.prototype.getDescendants=function(){for(var a,b=[this],c=0;a=this.childBlocks_[c];c++)b=b.concat(a.getDescendants());return b},Blockly.Block.prototype.isDeletable=function(){return this.deletable_&&!Blockly.readOnly},Blockly.Block.prototype.setDeletable=function(a){this.deletable_=a,this.svg_&&this.svg_.updateMovable()},Blockly.Block.prototype.isMovable=function(){return this.movable_&&!Blockly.readOnly},Blockly.Block.prototype.setMovable=function(a){this.movable_=a},Blockly.Block.prototype.isEditable=function(){return this.editable_&&!Blockly.readOnly},Blockly.Block.prototype.setEditable=function(a){this.editable_=a;for(var b,c=0;b=this.inputList[c];c++)for(var d,e=0;d=b.fieldRow[e];e++)d.updateEditable();for(var f=this.getIcons(),c=0;c<f.length;c++)f[c].updateEditable()},Blockly.Block.prototype.setHelpUrl=function(a){this.helpUrl=a},Blockly.Block.prototype.getColour=function(){return this.colourHue_},Blockly.Block.prototype.setColour=function(a){this.colourHue_=a,this.svg_&&this.svg_.updateColour();for(var b=this.getIcons(),c=0;c<b.length;c++)b[c].updateColour();if(this.rendered){for(var d,c=0;d=this.inputList[c];c++)for(var e,f=0;e=d.fieldRow[f];f++)e.setText(null);this.render()}},Blockly.Block.prototype.getField_=function(a){for(var b,c=0;b=this.inputList[c];c++)for(var d,e=0;d=b.fieldRow[e];e++)if(d.name===a)return d;return null},Blockly.Block.prototype.getFieldValue=function(a){var b=this.getField_(a);return b?b.getValue():null},Blockly.Block.prototype.getTitleValue=function(a){return console.log("Deprecated call to getTitleValue, use getFieldValue instead."),this.getFieldValue(a)},Blockly.Block.prototype.setFieldValue=function(a,b){var c=this.getField_(b);return null==c?void console.log('Field "%s" not found.',b):void c.setValue(a)},Blockly.Block.prototype.setTitleValue=function(a,b){console.log("Deprecated call to setTitleValue, use setFieldValue instead."),this.setFieldValue(a,b)},Blockly.Block.prototype.setTooltip=function(a){this.tooltip=a},Blockly.Block.prototype.setPreviousStatement=function(a,b){this.previousConnection&&(this.previousConnection.targetConnection&&console.log("Must disconnect previous statement before removing connection."),this.previousConnection.dispose(),this.previousConnection=null),a&&(this.outputConnection&&console.log("Remove output connection prior to adding previous connection."),void 0===b&&(b=null),this.previousConnection=new Blockly.Connection(this,Blockly.PREVIOUS_STATEMENT),this.previousConnection.setCheck(b)),this.rendered&&(this.render(),this.bumpNeighbours_())},Blockly.Block.prototype.setNextStatement=function(a,b){this.nextConnection&&(this.nextConnection.targetConnection&&console.log("Must disconnect next statement before removing connection."),this.nextConnection.dispose(),this.nextConnection=null),a&&(void 0===b&&(b=null),this.nextConnection=new Blockly.Connection(this,Blockly.NEXT_STATEMENT),this.nextConnection.setCheck(b)),this.rendered&&(this.render(),this.bumpNeighbours_())},Blockly.Block.prototype.setOutput=function(a,b){this.outputConnection&&(this.outputConnection.targetConnection&&console.log("Must disconnect output value before removing connection."),this.outputConnection.dispose(),this.outputConnection=null),a&&(this.previousConnection&&console.log("Remove previous connection prior to adding output connection."),void 0===b&&(b=null),this.outputConnection=new Blockly.Connection(this,Blockly.OUTPUT_VALUE),this.outputConnection.setCheck(b)),this.rendered&&(this.render(),this.bumpNeighbours_())},Blockly.Block.prototype.changeOutput=function(a){this.outputConnection&&console.log("Only use changeOutput() on blocks that already have an output."),this.outputConnection.setCheck(a)},Blockly.Block.prototype.setInputsInline=function(a){this.inputsInline=a,this.rendered&&(this.render(),this.bumpNeighbours_(),this.workspace.fireChangeEvent())},Blockly.Block.prototype.setDisabled=function(a){this.disabled!=a&&(this.disabled=a,this.svg_.updateDisabled(),this.workspace.fireChangeEvent())},Blockly.Block.prototype.getInheritedDisabled=function(){for(var a=this;;){if(a=a.getSurroundParent(),!a)return!1;if(a.disabled)return!0}},Blockly.Block.prototype.isCollapsed=function(){return this.collapsed_},Blockly.Block.prototype.setCollapsed=function(a){if(this.collapsed_!=a){this.collapsed_=a;for(var b,c=[],d=0;b=this.inputList[d];d++)c=c.concat(b.setVisible(!a));var e="_TEMP_COLLAPSED_INPUT";if(a){for(var f=this.getIcons(),d=0;d<f.length;d++)f[d].setVisible(!1);var g=this.toString(Blockly.COLLAPSE_CHARS);this.appendDummyInput(e).appendField(g)}else this.removeInput(e);if(c.length||(c[0]=this),this.rendered){for(var h,d=0;h=c[d];d++)h.render();this.bumpNeighbours_()}}},Blockly.Block.prototype.toString=function(a){for(var b,c=[],d=0;b=this.inputList[d];d++){for(var e,f=0;e=b.fieldRow[f];f++)c.push(e.getText());if(b.connection){var g=b.connection.targetBlock();c.push(g?g.toString():"?")}}return c=Ext.util.Format.trim(c.join(" "))||"???",a&&(c=Ext.util.Format.substr(c,0,a)),c},Blockly.Block.prototype.appendValueInput=function(a){return this.appendInput_(Blockly.INPUT_VALUE,a)},Blockly.Block.prototype.appendStatementInput=function(a){return this.appendInput_(Blockly.NEXT_STATEMENT,a)},Blockly.Block.prototype.appendDummyInput=function(a){return this.appendInput_(Blockly.DUMMY_INPUT,a||"")},Blockly.Block.prototype.interpolateMsg=function(a){function b(a){a instanceof Blockly.Field?this.appendField(a):(Ext.isArray(a)||console.log("Error in addFieldToInput"),this.appendField(a[1],a[0]))}"string"!=typeof a&&console.log("msg is not STRING");var c=arguments[arguments.length-1];(c!==Blockly.ALIGN_LEFT||c!==Blockly.ALIGN_CENTRE||c!==Blockly.ALIGN_RIGHT)&&console.log('Illegal final argument "%d" is not an alignment.',c),arguments.length=arguments.length-1;for(var d=a.split(this.interpolateMsg.SPLIT_REGEX_),e=[],f=0;f<d.length;f+=2){var g=Ext.util.Format.trim(d[f]),h=void 0;g&&e.push(new Blockly.FieldLabel(g));var i=d[f+1];if(i&&"%"==i.charAt(0)){var j=parseInt(i.substring(1),10),k=arguments[j];"array"!=typeof k&&console.log('Message symbol "%s" is out of range.',i),"array"!=typeof k&&console.log('Argument "%s" is not a tuple.',i),k[1]instanceof Blockly.Field?e.push([k[0],k[1]]):h=this.appendValueInput(k[0]).setCheck(k[1]).setAlign(k[2]),arguments[j]=null}else"\n"==i&&e.length&&(h=this.appendDummyInput());h&&e.length&&(e.forEach(b,h),e=[])}if(e.length){var h=this.appendDummyInput().setAlign(c);e.forEach(b,h)}for(var f=1;f<arguments.length-1;f++)null===arguments[f]&&console.log('Input "%%s" not used in message: "%s"',f,a);this.setInputsInline(!a.match(this.interpolateMsg.INLINE_REGEX_))},Blockly.Block.prototype.interpolateMsg.SPLIT_REGEX_=/(%\d+|\n)/,Blockly.Block.prototype.interpolateMsg.INLINE_REGEX_=/%1\s*$/,Blockly.Block.prototype.appendInput_=function(a,b){var c=null;(a==Blockly.INPUT_VALUE||a==Blockly.NEXT_STATEMENT)&&(c=new Blockly.Connection(this,a));var d=new Blockly.Input(a,b,this,c);return this.inputList.push(d),this.rendered&&(this.render(),this.bumpNeighbours_()),d},Blockly.Block.prototype.moveInputBefore=function(a,b){if(a!=b){for(var c,d=-1,e=b?-1:this.inputList.length,f=0;c=this.inputList[f];f++)if(c.name==a){if(d=f,-1!=e)break}else if(b&&c.name==b&&(e=f,-1!=d))break;-1!=d&&console.log('Named input "%s" not found.',a),-1!=e&&console.log('Reference input "%s" not found.',b),this.moveNumberedInputBefore(d,e)}},Blockly.Block.prototype.moveNumberedInputBefore=function(a,b){a!=b&&console.log("Can't move input to itself."),a<this.inputList.length&&console.log("Input index "+a+" out of bounds."),b<=this.inputList.length&&console.log("Reference input "+b+" out of bounds.");var c=this.inputList[a];this.inputList.splice(a,1),b>a&&b--,this.inputList.splice(b,0,c),this.rendered&&(this.render(),this.bumpNeighbours_())},Blockly.Block.prototype.removeInput=function(a,b){for(var c,d=0;c=this.inputList[d];d++)if(c.name==a)return c.connection&&c.connection.targetConnection&&c.connection.targetBlock().setParent(null),c.dispose(),this.inputList.splice(d,1),void(this.rendered&&(this.render(),this.bumpNeighbours_()));b||console.log('Input "%s" not found.',a)},Blockly.Block.prototype.getInput=function(a){for(var b,c=0;b=this.inputList[c];c++)if(b.name==a)return b;return null},Blockly.Block.prototype.getInputTargetBlock=function(a){var b=this.getInput(a);return b&&b.connection&&b.connection.targetBlock()},Blockly.Block.prototype.setMutator=function(a){this.mutator&&this.mutator!==a&&this.mutator.dispose(),a&&(a.block_=this,this.mutator=a,this.svg_&&a.createIcon())},Blockly.Block.prototype.getCommentText=function(){if(this.comment){var a=this.comment.getText();return a.replace(/\s+$/,"").replace(/ +\n/g,"\n")}return""},Blockly.Block.prototype.setCommentText=function(a){var b=!1;Ext.isString(a)?(this.comment||(this.comment=new Blockly.Comment(this),b=!0),this.comment.setText(a)):this.comment&&(this.comment.dispose(),b=!0),this.rendered&&(this.render(),b&&this.bumpNeighbours_())},Blockly.Block.prototype.setWarningText=function(a){this.isInFlyout&&(a=null);var b=!1;Ext.isString(a)?(this.warning||(this.warning=new Blockly.Warning(this),b=!0),this.warning.setText(a)):this.warning&&(this.warning.dispose(),b=!0),b&&this.rendered&&(this.render(),this.bumpNeighbours_())},Blockly.Block.prototype.render=function(){"object"!=typeof this.svg_&&console.log("Uninitialized block cannot be rendered.  Call block.initSvg()"),this.svg_.render()},Blockly.BlockSvg=function(a){this.block_=a,this.svgGroup_=Blockly.createSvgElement("g",{},null),this.svgPathDark_=Blockly.createSvgElement("path",{"class":"blocklyPathDark",transform:"translate(1, 1)"},this.svgGroup_),this.svgPath_=Blockly.createSvgElement("path",{"class":"blocklyPath"},this.svgGroup_),this.svgPathLight_=Blockly.createSvgElement("path",{"class":"blocklyPathLight"},this.svgGroup_),this.svgPath_.tooltip=this.block_,Blockly.Tooltip.bindMouseEvents(this.svgPath_),this.updateMovable()},Blockly.BlockSvg.prototype.height=0,Blockly.BlockSvg.prototype.width=0,Blockly.BlockSvg.INLINE=-1,Blockly.BlockSvg.prototype.init=function(){var a=this.block_;this.updateColour();for(var b,c=0;b=a.inputList[c];c++)b.init();a.mutator&&a.mutator.createIcon()},Blockly.BlockSvg.prototype.updateMovable=function(){this.block_.isMovable()?Blockly.addClass_(this.svgGroup_,"blocklyDraggable"):Blockly.removeClass_(this.svgGroup_,"blocklyDraggable")},Blockly.BlockSvg.prototype.getRootElement=function(){return this.svgGroup_},Blockly.BlockSvg.SEP_SPACE_X=10,Blockly.BlockSvg.SEP_SPACE_Y=10,Blockly.BlockSvg.INLINE_PADDING_Y=5,Blockly.BlockSvg.MIN_BLOCK_Y=25,Blockly.BlockSvg.TAB_HEIGHT=20,Blockly.BlockSvg.TAB_WIDTH=8,Blockly.BlockSvg.NOTCH_WIDTH=30,Blockly.BlockSvg.CORNER_RADIUS=8,Blockly.BlockSvg.FIELD_HEIGHT=18,Blockly.BlockSvg.DISTANCE_45_INSIDE=(1-Math.SQRT1_2)*(Blockly.BlockSvg.CORNER_RADIUS-1)+1,Blockly.BlockSvg.DISTANCE_45_OUTSIDE=(1-Math.SQRT1_2)*(Blockly.BlockSvg.CORNER_RADIUS+1)-1,Blockly.BlockSvg.NOTCH_PATH_LEFT="l 6,4 3,0 6,-4",Blockly.BlockSvg.NOTCH_PATH_LEFT_HIGHLIGHT="l 6.5,4 2,0 6.5,-4",Blockly.BlockSvg.NOTCH_PATH_RIGHT="l -6,4 -3,0 -6,-4",Blockly.BlockSvg.JAGGED_TEETH="l 8,0 0,4 8,4 -16,8 8,4",Blockly.BlockSvg.JAGGED_TEETH_HEIGHT=20,Blockly.BlockSvg.JAGGED_TEETH_WIDTH=15,Blockly.BlockSvg.TAB_PATH_DOWN="v 5 c 0,10 -"+Blockly.BlockSvg.TAB_WIDTH+",-8 -"+Blockly.BlockSvg.TAB_WIDTH+",7.5 s "+Blockly.BlockSvg.TAB_WIDTH+",-2.5 "+Blockly.BlockSvg.TAB_WIDTH+",7.5",Blockly.BlockSvg.TAB_PATH_DOWN_HIGHLIGHT_RTL="v 6.5 m -"+.98*Blockly.BlockSvg.TAB_WIDTH+",2.5 q -"+.05*Blockly.BlockSvg.TAB_WIDTH+",10 "+.27*Blockly.BlockSvg.TAB_WIDTH+",10 m "+.71*Blockly.BlockSvg.TAB_WIDTH+",-2.5 v 1.5",Blockly.BlockSvg.TOP_LEFT_CORNER_START="m 0,"+Blockly.BlockSvg.CORNER_RADIUS,Blockly.BlockSvg.TOP_LEFT_CORNER_START_HIGHLIGHT_RTL="m "+Blockly.BlockSvg.DISTANCE_45_INSIDE+","+Blockly.BlockSvg.DISTANCE_45_INSIDE,Blockly.BlockSvg.TOP_LEFT_CORNER_START_HIGHLIGHT_LTR="m 1,"+(Blockly.BlockSvg.CORNER_RADIUS-1),Blockly.BlockSvg.TOP_LEFT_CORNER="A "+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+" 0 0,1 "+Blockly.BlockSvg.CORNER_RADIUS+",0",Blockly.BlockSvg.TOP_LEFT_CORNER_HIGHLIGHT="A "+(Blockly.BlockSvg.CORNER_RADIUS-1)+","+(Blockly.BlockSvg.CORNER_RADIUS-1)+" 0 0,1 "+Blockly.BlockSvg.CORNER_RADIUS+",1",Blockly.BlockSvg.INNER_TOP_LEFT_CORNER=Blockly.BlockSvg.NOTCH_PATH_RIGHT+" h -"+(Blockly.BlockSvg.NOTCH_WIDTH-15-Blockly.BlockSvg.CORNER_RADIUS)+" a "+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+" 0 0,0 -"+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS,Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER="a "+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+" 0 0,0 "+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS,Blockly.BlockSvg.INNER_TOP_LEFT_CORNER_HIGHLIGHT_RTL="a "+(Blockly.BlockSvg.CORNER_RADIUS+1)+","+(Blockly.BlockSvg.CORNER_RADIUS+1)+" 0 0,0 "+(-Blockly.BlockSvg.DISTANCE_45_OUTSIDE-1)+","+(Blockly.BlockSvg.CORNER_RADIUS-Blockly.BlockSvg.DISTANCE_45_OUTSIDE),Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER_HIGHLIGHT_RTL="a "+(Blockly.BlockSvg.CORNER_RADIUS+1)+","+(Blockly.BlockSvg.CORNER_RADIUS+1)+" 0 0,0 "+(Blockly.BlockSvg.CORNER_RADIUS+1)+","+(Blockly.BlockSvg.CORNER_RADIUS+1),Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER_HIGHLIGHT_LTR="a "+(Blockly.BlockSvg.CORNER_RADIUS+1)+","+(Blockly.BlockSvg.CORNER_RADIUS+1)+" 0 0,0 "+(Blockly.BlockSvg.CORNER_RADIUS-Blockly.BlockSvg.DISTANCE_45_OUTSIDE)+","+(Blockly.BlockSvg.DISTANCE_45_OUTSIDE+1),Blockly.BlockSvg.prototype.dispose=function(){Ext.removeNode(this.svgGroup_),this.svgGroup_=null,this.svgPath_=null,this.svgPathLight_=null,this.svgPathDark_=null,this.block_=null
},Blockly.BlockSvg.prototype.disposeUiEffect=function(){Blockly.playAudio("delete");var a=Blockly.getSvgXY_(this.svgGroup_),b=this.svgGroup_.cloneNode(!0);b.translateX_=a.x,b.translateY_=a.y,b.setAttribute("transform","translate("+b.translateX_+","+b.translateY_+")"),Blockly.svg.appendChild(b),b.bBox_=b.getBBox(),b.startDate_=new Date,Blockly.BlockSvg.disposeUiStep_(b)},Blockly.BlockSvg.disposeUiStep_=function(a){var b=new Date-a.startDate_,c=b/150;if(c>1)Ext.removeNode(a);else{var d=a.translateX_+(Blockly.RTL?-1:1)*a.bBox_.width/2*c,e=a.translateY_+a.bBox_.height*c,f=d+", "+e,g=1-c;a.setAttribute("transform","translate("+f+") scale("+g+")");var h=function(){Blockly.BlockSvg.disposeUiStep_(a)};window.setTimeout(h,10)}},Blockly.BlockSvg.prototype.connectionUiEffect=function(){Blockly.playAudio("click");var a=Blockly.getSvgXY_(this.svgGroup_);this.block_.outputConnection?(a.x+=Blockly.RTL?3:-3,a.y+=13):this.block_.previousConnection&&(a.x+=Blockly.RTL?-23:23,a.y+=3);var b=Blockly.createSvgElement("circle",{cx:a.x,cy:a.y,r:0,fill:"none",stroke:"#888","stroke-width":10},Blockly.svg);b.startDate_=new Date,Blockly.BlockSvg.connectionUiStep_(b)},Blockly.BlockSvg.connectionUiStep_=function(a){var b=new Date-a.startDate_,c=b/150;if(c>1)Ext.removeNode(a);else{a.setAttribute("r",25*c),a.style.opacity=1-c;var d=function(){Blockly.BlockSvg.connectionUiStep_(a)};window.setTimeout(d,10)}},Blockly.BlockSvg.prototype.updateColour=function(){if(!this.block_.disabled){var a=Blockly.makeColour(this.block_.getColour()),b=Ext.draw.Color.fromString(a),c=b.getLighter(.1),d=b.getDarker(.1);this.svgPathLight_.setAttribute("stroke",c.toString()),this.svgPathDark_.setAttribute("fill",d.toString()),this.svgPath_.setAttribute("fill",a)}},Blockly.BlockSvg.prototype.updateDisabled=function(){this.block_.disabled||this.block_.getInheritedDisabled()?(Blockly.addClass_(this.svgGroup_,"blocklyDisabled"),this.svgPath_.setAttribute("fill","url(#blocklyDisabledPattern)")):(Blockly.removeClass_(this.svgGroup_,"blocklyDisabled"),this.updateColour());for(var a,b=this.block_.getChildren(),c=0;a=b[c];c++)a.svg_.updateDisabled()},Blockly.BlockSvg.prototype.addSelect=function(){Blockly.addClass_(this.svgGroup_,"blocklySelected"),this.svgGroup_.parentNode.appendChild(this.svgGroup_)},Blockly.BlockSvg.prototype.removeSelect=function(){Blockly.removeClass_(this.svgGroup_,"blocklySelected")},Blockly.BlockSvg.prototype.addDragging=function(){Blockly.addClass_(this.svgGroup_,"blocklyDragging")},Blockly.BlockSvg.prototype.removeDragging=function(){Blockly.removeClass_(this.svgGroup_,"blocklyDragging")},Blockly.BlockSvg.prototype.render=function(){this.block_.rendered=!0;var a=Blockly.BlockSvg.SEP_SPACE_X;Blockly.RTL&&(a=-a);for(var b=this.block_.getIcons(),c=0;c<b.length;c++)a=b[c].renderIcon(a);a+=Blockly.RTL?Blockly.BlockSvg.SEP_SPACE_X:-Blockly.BlockSvg.SEP_SPACE_X;var d=this.renderCompute_(a);this.renderDraw_(a,d);var e=this.block_.getParent();e?e.render():Blockly.fireUiEvent(window,"resize")},Blockly.BlockSvg.prototype.renderFields_=function(a,b,c){Blockly.RTL&&(b=-b);for(var d,e=0;d=a[e];e++)Blockly.RTL?(b-=d.renderSep+d.renderWidth,d.getRootElement().setAttribute("transform","translate("+b+", "+c+")"),d.renderWidth&&(b-=Blockly.BlockSvg.SEP_SPACE_X)):(d.getRootElement().setAttribute("transform","translate("+(b+d.renderSep)+", "+c+")"),d.renderWidth&&(b+=d.renderSep+d.renderWidth+Blockly.BlockSvg.SEP_SPACE_X));return Blockly.RTL?-b:b},Blockly.BlockSvg.prototype.renderCompute_=function(a){var b=this.block_.inputList,c=[];c.rightEdge=a+2*Blockly.BlockSvg.SEP_SPACE_X,(this.block_.previousConnection||this.block_.nextConnection)&&(c.rightEdge=Math.max(c.rightEdge,Blockly.BlockSvg.NOTCH_WIDTH+Blockly.BlockSvg.SEP_SPACE_X));for(var d,e=0,f=0,g=!1,h=!1,i=!1,j=void 0,k=this.block_.inputsInline&&!this.block_.isCollapsed(),l=0;d=b[l];l++)if(d.isVisible()){var m;if(k&&j&&j!=Blockly.NEXT_STATEMENT&&d.type!=Blockly.NEXT_STATEMENT?m=c[c.length-1]:(j=d.type,m=[],m.type=k&&d.type!=Blockly.NEXT_STATEMENT?Blockly.BlockSvg.INLINE:d.type,m.height=0,c.push(m)),m.push(d),d.renderHeight=Blockly.BlockSvg.MIN_BLOCK_Y,d.renderWidth=k&&d.type==Blockly.INPUT_VALUE?Blockly.BlockSvg.TAB_WIDTH+1.25*Blockly.BlockSvg.SEP_SPACE_X:0,d.connection&&d.connection.targetConnection){var n=d.connection.targetBlock(),o=n.getHeightWidth();d.renderHeight=Math.max(d.renderHeight,o.height),d.renderWidth=Math.max(d.renderWidth,o.width)}l==b.length-1&&d.renderHeight--,m.height=Math.max(m.height,d.renderHeight),d.fieldWidth=0,1==c.length&&(d.fieldWidth+=Blockly.RTL?-a:a);for(var p,q=!1,r=0;p=d.fieldRow[r];r++){0!=r&&(d.fieldWidth+=Blockly.BlockSvg.SEP_SPACE_X);var s=p.getSize();p.renderWidth=s.width,p.renderSep=q&&p.EDITABLE?Blockly.BlockSvg.SEP_SPACE_X:0,d.fieldWidth+=p.renderWidth+p.renderSep,m.height=Math.max(m.height,s.height),q=p.EDITABLE}m.type!=Blockly.BlockSvg.INLINE&&(m.type==Blockly.NEXT_STATEMENT?(h=!0,f=Math.max(f,d.fieldWidth)):(m.type==Blockly.INPUT_VALUE?g=!0:m.type==Blockly.DUMMY_INPUT&&(i=!0),e=Math.max(e,d.fieldWidth)))}for(var m,t=0;m=c[t];t++)if(m.thicker=!1,m.type==Blockly.BlockSvg.INLINE)for(var d,u=0;d=m[u];u++)if(d.type==Blockly.INPUT_VALUE){m.height+=2*Blockly.BlockSvg.INLINE_PADDING_Y,m.thicker=!0;break}return c.statementEdge=2*Blockly.BlockSvg.SEP_SPACE_X+f,h&&(c.rightEdge=Math.max(c.rightEdge,c.statementEdge+Blockly.BlockSvg.NOTCH_WIDTH)),g?c.rightEdge=Math.max(c.rightEdge,e+2*Blockly.BlockSvg.SEP_SPACE_X+Blockly.BlockSvg.TAB_WIDTH):i&&(c.rightEdge=Math.max(c.rightEdge,e+2*Blockly.BlockSvg.SEP_SPACE_X)),c.hasValue=g,c.hasStatement=h,c.hasDummy=i,c},Blockly.BlockSvg.prototype.renderDraw_=function(a,b){if(this.block_.outputConnection)this.squareTopLeftCorner_=!0,this.squareBottomLeftCorner_=!0;else{if(this.squareTopLeftCorner_=!1,this.squareBottomLeftCorner_=!1,this.block_.previousConnection){var c=this.block_.previousConnection.targetBlock();c&&c.nextConnection&&c.nextConnection.targetConnection==this.block_.previousConnection&&(this.squareTopLeftCorner_=!0)}if(this.block_.nextConnection){var d=this.block_.nextConnection.targetBlock();d&&d.previousConnection&&d.previousConnection.targetConnection==this.block_.nextConnection&&(this.squareBottomLeftCorner_=!0)}}var e=this.block_.getRelativeToSurfaceXY(),f=[],g=[],h=[],i=[];this.renderDrawTop_(f,h,e,b.rightEdge);var j=this.renderDrawRight_(f,h,g,i,e,b,a);this.renderDrawBottom_(f,h,e,j),this.renderDrawLeft_(f,h,e,j);var k=f.join(" ")+"\n"+g.join(" ");this.svgPath_.setAttribute("d",k),this.svgPathDark_.setAttribute("d",k),k=h.join(" ")+"\n"+i.join(" "),this.svgPathLight_.setAttribute("d",k),Blockly.RTL&&(this.svgPath_.setAttribute("transform","scale(-1 1)"),this.svgPathLight_.setAttribute("transform","scale(-1 1)"),this.svgPathDark_.setAttribute("transform","translate(1,1) scale(-1 1)"))},Blockly.BlockSvg.prototype.renderDrawTop_=function(a,b,c,d){if(this.squareTopLeftCorner_?(a.push("m 0,0"),b.push("m 1,1")):(a.push(Blockly.BlockSvg.TOP_LEFT_CORNER_START),b.push(Blockly.RTL?Blockly.BlockSvg.TOP_LEFT_CORNER_START_HIGHLIGHT_RTL:Blockly.BlockSvg.TOP_LEFT_CORNER_START_HIGHLIGHT_LTR),a.push(Blockly.BlockSvg.TOP_LEFT_CORNER),b.push(Blockly.BlockSvg.TOP_LEFT_CORNER_HIGHLIGHT)),this.block_.previousConnection){a.push("H",Blockly.BlockSvg.NOTCH_WIDTH-15),b.push("H",Blockly.BlockSvg.NOTCH_WIDTH-15),a.push(Blockly.BlockSvg.NOTCH_PATH_LEFT),b.push(Blockly.BlockSvg.NOTCH_PATH_LEFT_HIGHLIGHT);var e=c.x+(Blockly.RTL?-Blockly.BlockSvg.NOTCH_WIDTH:Blockly.BlockSvg.NOTCH_WIDTH),f=c.y;this.block_.previousConnection.moveTo(e,f)}a.push("H",d),b.push("H",d+(Blockly.RTL?-1:0)),this.width=d},Blockly.BlockSvg.prototype.renderDrawRight_=function(a,b,c,d,e,f,g){for(var h,i,j,k,l=0,m=0;k=f[m];m++){if(h=Blockly.BlockSvg.SEP_SPACE_X,0==m&&(h+=Blockly.RTL?-g:g),b.push("M",f.rightEdge-1+","+(l+1)),this.block_.isCollapsed()){var n=k[0],o=h,p=l+Blockly.BlockSvg.FIELD_HEIGHT;this.renderFields_(n.fieldRow,o,p),a.push(Blockly.BlockSvg.JAGGED_TEETH),b.push(Blockly.RTL?"l 8,0 0,3.8 7,3.2 m -14.5,9 l 8,4":"h 8");var q=k.height-Blockly.BlockSvg.JAGGED_TEETH_HEIGHT;a.push("v",q),Blockly.RTL&&b.push("v",q-2),this.width+=Blockly.BlockSvg.JAGGED_TEETH_WIDTH}else if(k.type==Blockly.BlockSvg.INLINE){for(var n,r=0;n=k[r];r++){var o=h,p=l+Blockly.BlockSvg.FIELD_HEIGHT;k.thicker&&(p+=Blockly.BlockSvg.INLINE_PADDING_Y),h=this.renderFields_(n.fieldRow,o,p),n.type!=Blockly.DUMMY_INPUT&&(h+=n.renderWidth+Blockly.BlockSvg.SEP_SPACE_X),n.type==Blockly.INPUT_VALUE&&(c.push("M",h-Blockly.BlockSvg.SEP_SPACE_X+","+(l+Blockly.BlockSvg.INLINE_PADDING_Y)),c.push("h",Blockly.BlockSvg.TAB_WIDTH-2-n.renderWidth),c.push(Blockly.BlockSvg.TAB_PATH_DOWN),c.push("v",n.renderHeight+1-Blockly.BlockSvg.TAB_HEIGHT),c.push("h",n.renderWidth+2-Blockly.BlockSvg.TAB_WIDTH),c.push("z"),Blockly.RTL?(d.push("M",h-Blockly.BlockSvg.SEP_SPACE_X-3+Blockly.BlockSvg.TAB_WIDTH-n.renderWidth+","+(l+Blockly.BlockSvg.INLINE_PADDING_Y+1)),d.push(Blockly.BlockSvg.TAB_PATH_DOWN_HIGHLIGHT_RTL),d.push("v",n.renderHeight-Blockly.BlockSvg.TAB_HEIGHT+3),d.push("h",n.renderWidth-Blockly.BlockSvg.TAB_WIDTH+1)):(d.push("M",h-Blockly.BlockSvg.SEP_SPACE_X+1+","+(l+Blockly.BlockSvg.INLINE_PADDING_Y+1)),d.push("v",n.renderHeight+1),d.push("h",Blockly.BlockSvg.TAB_WIDTH-2-n.renderWidth),d.push("M",h-n.renderWidth-Blockly.BlockSvg.SEP_SPACE_X+.8+","+(l+Blockly.BlockSvg.INLINE_PADDING_Y+Blockly.BlockSvg.TAB_HEIGHT-.4)),d.push("l",.42*Blockly.BlockSvg.TAB_WIDTH+",-1.8")),i=Blockly.RTL?e.x-h-Blockly.BlockSvg.TAB_WIDTH+Blockly.BlockSvg.SEP_SPACE_X+n.renderWidth+1:e.x+h+Blockly.BlockSvg.TAB_WIDTH-Blockly.BlockSvg.SEP_SPACE_X-n.renderWidth-1,j=e.y+l+Blockly.BlockSvg.INLINE_PADDING_Y+1,n.connection.moveTo(i,j),n.connection.targetConnection&&n.connection.tighten_())}h=Math.max(h,f.rightEdge),this.width=Math.max(this.width,h),a.push("H",h),b.push("H",h+(Blockly.RTL?-1:0)),a.push("v",k.height),Blockly.RTL&&b.push("v",k.height-2)}else if(k.type==Blockly.INPUT_VALUE){var n=k[0],o=h,p=l+Blockly.BlockSvg.FIELD_HEIGHT;if(n.align!=Blockly.ALIGN_LEFT){var s=f.rightEdge-n.fieldWidth-Blockly.BlockSvg.TAB_WIDTH-2*Blockly.BlockSvg.SEP_SPACE_X;n.align==Blockly.ALIGN_RIGHT?o+=s:n.align==Blockly.ALIGN_CENTRE&&(o+=(s+o)/2)}this.renderFields_(n.fieldRow,o,p),a.push(Blockly.BlockSvg.TAB_PATH_DOWN);var t=k.height-Blockly.BlockSvg.TAB_HEIGHT;a.push("v",t),Blockly.RTL?(b.push(Blockly.BlockSvg.TAB_PATH_DOWN_HIGHLIGHT_RTL),b.push("v",t)):(b.push("M",f.rightEdge-4.2+","+(l+Blockly.BlockSvg.TAB_HEIGHT-.4)),b.push("l",.42*Blockly.BlockSvg.TAB_WIDTH+",-1.8")),i=e.x+(Blockly.RTL?-f.rightEdge-1:f.rightEdge+1),j=e.y+l,n.connection.moveTo(i,j),n.connection.targetConnection&&(n.connection.tighten_(),this.width=Math.max(this.width,f.rightEdge+n.connection.targetBlock().getHeightWidth().width-Blockly.BlockSvg.TAB_WIDTH+1))}else if(k.type==Blockly.DUMMY_INPUT){var n=k[0],o=h,p=l+Blockly.BlockSvg.FIELD_HEIGHT;if(n.align!=Blockly.ALIGN_LEFT){var s=f.rightEdge-n.fieldWidth-2*Blockly.BlockSvg.SEP_SPACE_X;f.hasValue&&(s-=Blockly.BlockSvg.TAB_WIDTH),n.align==Blockly.ALIGN_RIGHT?o+=s:n.align==Blockly.ALIGN_CENTRE&&(o+=(s+o)/2)}this.renderFields_(n.fieldRow,o,p),a.push("v",k.height),Blockly.RTL&&b.push("v",k.height-2)}else if(k.type==Blockly.NEXT_STATEMENT){var n=k[0];0==m&&(a.push("v",Blockly.BlockSvg.SEP_SPACE_Y),Blockly.RTL&&b.push("v",Blockly.BlockSvg.SEP_SPACE_Y-1),l+=Blockly.BlockSvg.SEP_SPACE_Y);var o=h,p=l+Blockly.BlockSvg.FIELD_HEIGHT;if(n.align!=Blockly.ALIGN_LEFT){var s=f.statementEdge-n.fieldWidth-2*Blockly.BlockSvg.SEP_SPACE_X;n.align==Blockly.ALIGN_RIGHT?o+=s:n.align==Blockly.ALIGN_CENTRE&&(o+=(s+o)/2)}this.renderFields_(n.fieldRow,o,p),h=f.statementEdge+Blockly.BlockSvg.NOTCH_WIDTH,a.push("H",h),a.push(Blockly.BlockSvg.INNER_TOP_LEFT_CORNER),a.push("v",k.height-2*Blockly.BlockSvg.CORNER_RADIUS),a.push(Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER),a.push("H",f.rightEdge),Blockly.RTL?(b.push("M",h-Blockly.BlockSvg.NOTCH_WIDTH+Blockly.BlockSvg.DISTANCE_45_OUTSIDE+","+(l+Blockly.BlockSvg.DISTANCE_45_OUTSIDE)),b.push(Blockly.BlockSvg.INNER_TOP_LEFT_CORNER_HIGHLIGHT_RTL),b.push("v",k.height-2*Blockly.BlockSvg.CORNER_RADIUS),b.push(Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER_HIGHLIGHT_RTL),b.push("H",f.rightEdge-1)):(b.push("M",h-Blockly.BlockSvg.NOTCH_WIDTH+Blockly.BlockSvg.DISTANCE_45_OUTSIDE+","+(l+k.height-Blockly.BlockSvg.DISTANCE_45_OUTSIDE)),b.push(Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER_HIGHLIGHT_LTR),b.push("H",f.rightEdge)),i=e.x+(Blockly.RTL?-h:h),j=e.y+l+1,n.connection.moveTo(i,j),n.connection.targetConnection&&(n.connection.tighten_(),this.width=Math.max(this.width,f.statementEdge+n.connection.targetBlock().getHeightWidth().width)),(m==f.length-1||f[m+1].type==Blockly.NEXT_STATEMENT)&&(a.push("v",Blockly.BlockSvg.SEP_SPACE_Y),Blockly.RTL&&b.push("v",Blockly.BlockSvg.SEP_SPACE_Y-1),l+=Blockly.BlockSvg.SEP_SPACE_Y)}l+=k.height}return f.length||(l=Blockly.BlockSvg.MIN_BLOCK_Y,a.push("V",l),Blockly.RTL&&b.push("V",l-1)),l},Blockly.BlockSvg.prototype.renderDrawBottom_=function(a,b,c,d){if(this.height=d+1,this.block_.nextConnection){a.push("H",Blockly.BlockSvg.NOTCH_WIDTH+" "+Blockly.BlockSvg.NOTCH_PATH_RIGHT);var e;e=Blockly.RTL?c.x-Blockly.BlockSvg.NOTCH_WIDTH:c.x+Blockly.BlockSvg.NOTCH_WIDTH;var f=c.y+d+1;this.block_.nextConnection.moveTo(e,f),this.block_.nextConnection.targetConnection&&this.block_.nextConnection.tighten_(),this.height+=4}this.squareBottomLeftCorner_?(a.push("H 0"),Blockly.RTL||b.push("M","1,"+d)):(a.push("H",Blockly.BlockSvg.CORNER_RADIUS),a.push("a",Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+" 0 0,1 -"+Blockly.BlockSvg.CORNER_RADIUS+",-"+Blockly.BlockSvg.CORNER_RADIUS),Blockly.RTL||(b.push("M",Blockly.BlockSvg.DISTANCE_45_INSIDE+","+(d-Blockly.BlockSvg.DISTANCE_45_INSIDE)),b.push("A",Blockly.BlockSvg.CORNER_RADIUS-1+","+(Blockly.BlockSvg.CORNER_RADIUS-1)+" 0 0,1 1,"+(d-Blockly.BlockSvg.CORNER_RADIUS))))},Blockly.BlockSvg.prototype.renderDrawLeft_=function(a,b,c){this.block_.outputConnection?(this.block_.outputConnection.moveTo(c.x,c.y),a.push("V",Blockly.BlockSvg.TAB_HEIGHT),a.push("c 0,-10 -"+Blockly.BlockSvg.TAB_WIDTH+",8 -"+Blockly.BlockSvg.TAB_WIDTH+",-7.5 s "+Blockly.BlockSvg.TAB_WIDTH+",2.5 "+Blockly.BlockSvg.TAB_WIDTH+",-7.5"),Blockly.RTL?(b.push("M",Blockly.BlockSvg.TAB_WIDTH*-.3+",8.9"),b.push("l",Blockly.BlockSvg.TAB_WIDTH*-.45+",-2.1")):(b.push("V",Blockly.BlockSvg.TAB_HEIGHT-1),b.push("m",Blockly.BlockSvg.TAB_WIDTH*-.92+",-1 q "+Blockly.BlockSvg.TAB_WIDTH*-.19+",-5.5 0,-11"),b.push("m",.92*Blockly.BlockSvg.TAB_WIDTH+",1 V 1 H 2")),this.width+=Blockly.BlockSvg.TAB_WIDTH):Blockly.RTL||(this.squareTopLeftCorner_?b.push("V",1):b.push("V",Blockly.BlockSvg.CORNER_RADIUS)),a.push("z")},Blockly.Blocks={},Blockly.Blocks.addTemplate=function(a){a.blockName&&console.log("Error"),Blockly.Blocks[a.blockName]&&console.log("Blockly.Blocks already has a field named ",a.blockName),a.message&&console.log("Error"),a.colour&&"number"==typeof a.colour&&a.colour>=0&&a.colour<360&&console.log("details.colour must be a number from 0 to 360 (exclusive)"),"undefined"!=a.output&&(a.previousStatement||console.log("When details.output is defined, details.previousStatement must not be true."),a.nextStatement||console.log("When details.output is defined, details.nextStatement must not be true."));var b={};b.init=function(){var b=this;this.setColour(a.colour),this.setHelpUrl(a.helpUrl),"string"==typeof a.tooltip?this.setTooltip(a.tooltip):"function"==typeof a.tooltip&&this.setTooltip(function(){return a.tooltip(b)}),"undefined"!=a.output?this.setOutput(!0,a.output):(this.setPreviousStatement("undefined"==typeof a.previousStatement?!0:a.previousStatement),this.setNextStatement("undefined"==typeof a.nextStatement?!0:a.nextStatement));var c=[];c.push(a.text),a.args&&a.args.forEach(function(a){a.name&&console.log("Error"),"undefined"!=a.check&&console.log("Error"),"undefined"==a.type||a.type==Blockly.INPUT_VALUE?c.push([a.name,a.check,"undefined"==typeof a.align?Blockly.ALIGN_RIGHT:a.align]):console.log("addTemplate() can only handle value inputs.")}),c.push(Blockly.ALIGN_RIGHT),a.inline&&this.setInlineInputs(a.inline),Blockly.Block.prototype.interpolateMsg.apply(this,c)},b.mutationToDom=a.switchable?function(){var b=a.mutationToDomFunc?a.mutatationToDomFunc():document.createElement("mutation");return b.setAttribute("is_statement",this.isStatement||!1),b}:a.mutationToDomFunc,Blockly.Blocks[a.blockName]=b},Blockly.Icon={},Blockly.Icon=function(a){this.block_=a},Blockly.Icon.RADIUS=8,Blockly.Icon.prototype.bubble_=null,Blockly.Icon.prototype.iconX_=0,Blockly.Icon.prototype.iconY_=0,Blockly.Icon.prototype.createIcon_=function(){this.iconGroup_=Blockly.createSvgElement("g",{},null),this.block_.getSvgRoot().appendChild(this.iconGroup_),Blockly.bindEvent_(this.iconGroup_,"mouseup",this,this.iconClick_),this.updateEditable()},Blockly.Icon.prototype.dispose=function(){Ext.removeNode(this.iconGroup_),this.iconGroup_=null,this.setVisible(!1),this.block_=null},Blockly.Icon.prototype.updateEditable=function(){this.block_.isInFlyout?Blockly.removeClass_(this.iconGroup_,"blocklyIconGroup"):Blockly.addClass_(this.iconGroup_,"blocklyIconGroup")},Blockly.Icon.prototype.isVisible=function(){return!!this.bubble_},Blockly.Icon.prototype.iconClick_=function(){this.block_.isInFlyout||this.setVisible(!this.isVisible())},Blockly.Icon.prototype.updateColour=function(){if(this.isVisible()){var a=Blockly.makeColour(this.block_.getColour());this.bubble_.setColour(a)}},Blockly.Icon.prototype.renderIcon=function(a){if(this.block_.isCollapsed())return this.iconGroup_.setAttribute("display","none"),a;this.iconGroup_.setAttribute("display","block");var b=5,c=2*Blockly.Icon.RADIUS;return Blockly.RTL&&(a-=c),this.iconGroup_.setAttribute("transform","translate("+a+", "+b+")"),this.computeIconLocation(),Blockly.RTL?a-=Blockly.BlockSvg.SEP_SPACE_X:a+=c+Blockly.BlockSvg.SEP_SPACE_X,a},Blockly.Icon.prototype.setIconLocation=function(a,b){this.iconX_=a,this.iconY_=b,this.isVisible()&&this.bubble_.setAnchorLocation(a,b)},Blockly.Icon.prototype.computeIconLocation=function(){var a=this.block_.getRelativeToSurfaceXY(),b=Blockly.getRelativeXY_(this.iconGroup_),c=a.x+b.x+Blockly.Icon.RADIUS,d=a.y+b.y+Blockly.Icon.RADIUS;(c!==this.iconX_||d!==this.iconY_)&&this.setIconLocation(c,d)},Blockly.Icon.prototype.getIconLocation=function(){return{x:this.iconX_,y:this.iconY_}},Blockly.Bubble=function(a,b,c,d,e,f,g){var h=Blockly.Bubble.ARROW_ANGLE;Blockly.RTL&&(h=-h),this.arrow_radians_=h/360*Math.PI*2,this.workspace_=a,this.content_=b,this.shape_=c;var i=a.getBubbleCanvas();if(i.appendChild(this.createDom_(b,!(!f||!g))),this.setAnchorLocation(d,e),!f||!g){var j=this.content_.getBBox();f=j.width+2*Blockly.Bubble.BORDER_WIDTH,g=j.height+2*Blockly.Bubble.BORDER_WIDTH}this.setBubbleSize(f,g),this.positionBubble_(),this.renderArrow_(),this.rendered_=!0,Blockly.readOnly||(Blockly.bindEvent_(this.bubbleBack_,"mousedown",this,this.bubbleMouseDown_),this.resizeGroup_&&Blockly.bindEvent_(this.resizeGroup_,"mousedown",this,this.resizeMouseDown_))},Blockly.Bubble.BORDER_WIDTH=6,Blockly.Bubble.ARROW_THICKNESS=10,Blockly.Bubble.ARROW_ANGLE=20,Blockly.Bubble.ARROW_BEND=4,Blockly.Bubble.ANCHOR_RADIUS=8,Blockly.Bubble.onMouseUpWrapper_=null,Blockly.Bubble.onMouseMoveWrapper_=null,Blockly.Bubble.unbindDragEvents_=function(){Blockly.Bubble.onMouseUpWrapper_&&(Blockly.unbindEvent_(Blockly.Bubble.onMouseUpWrapper_),Blockly.Bubble.onMouseUpWrapper_=null),Blockly.Bubble.onMouseMoveWrapper_&&(Blockly.unbindEvent_(Blockly.Bubble.onMouseMoveWrapper_),Blockly.Bubble.onMouseMoveWrapper_=null)},Blockly.Bubble.prototype.rendered_=!1,Blockly.Bubble.prototype.anchorX_=0,Blockly.Bubble.prototype.anchorY_=0,Blockly.Bubble.prototype.relativeLeft_=0,Blockly.Bubble.prototype.relativeTop_=0,Blockly.Bubble.prototype.width_=0,Blockly.Bubble.prototype.height_=0,Blockly.Bubble.prototype.autoLayout_=!0,Blockly.Bubble.prototype.createDom_=function(a,b){this.bubbleGroup_=Blockly.createSvgElement("g",{},null);var c=Blockly.createSvgElement("g",{filter:"url(#blocklyEmboss)"},this.bubbleGroup_);if(this.bubbleArrow_=Blockly.createSvgElement("path",{},c),this.bubbleBack_=Blockly.createSvgElement("rect",{"class":"blocklyDraggable",x:0,y:0,rx:Blockly.Bubble.BORDER_WIDTH,ry:Blockly.Bubble.BORDER_WIDTH},c),b){this.resizeGroup_=Blockly.createSvgElement("g",{"class":Blockly.RTL?"blocklyResizeSW":"blocklyResizeSE"},this.bubbleGroup_);var d=2*Blockly.Bubble.BORDER_WIDTH;Blockly.createSvgElement("polygon",{points:"0,x x,x x,0".replace(/x/g,d.toString())},this.resizeGroup_),Blockly.createSvgElement("line",{"class":"blocklyResizeLine",x1:d/3,y1:d-1,x2:d-1,y2:d/3},this.resizeGroup_),Blockly.createSvgElement("line",{"class":"blocklyResizeLine",x1:2*d/3,y1:d-1,x2:d-1,y2:2*d/3},this.resizeGroup_)}else this.resizeGroup_=null;return this.bubbleGroup_.appendChild(a),this.bubbleGroup_},Blockly.Bubble.prototype.bubbleMouseDown_=function(a){this.promote_(),Blockly.Bubble.unbindDragEvents_(),Blockly.isRightButton(a)||Blockly.isTargetInput_(a)||(Blockly.setCursorHand_(!0),this.dragDeltaX=Blockly.RTL?this.relativeLeft_+a.clientX:this.relativeLeft_-a.clientX,this.dragDeltaY=this.relativeTop_-a.clientY,Blockly.Bubble.onMouseUpWrapper_=Blockly.bindEvent_(document,"mouseup",this,Blockly.Bubble.unbindDragEvents_),Blockly.Bubble.onMouseMoveWrapper_=Blockly.bindEvent_(document,"mousemove",this,this.bubbleMouseMove_),Blockly.hideChaff(),a.stopPropagation())},Blockly.Bubble.prototype.bubbleMouseMove_=function(a){this.autoLayout_=!1,this.relativeLeft_=Blockly.RTL?this.dragDeltaX-a.clientX:this.dragDeltaX+a.clientX,this.relativeTop_=this.dragDeltaY+a.clientY,this.positionBubble_(),this.renderArrow_()},Blockly.Bubble.prototype.resizeMouseDown_=function(a){this.promote_(),Blockly.Bubble.unbindDragEvents_(),Blockly.isRightButton(a)||(Blockly.setCursorHand_(!0),this.resizeDeltaWidth=Blockly.RTL?this.width_+a.clientX:this.width_-a.clientX,this.resizeDeltaHeight=this.height_-a.clientY,Blockly.Bubble.onMouseUpWrapper_=Blockly.bindEvent_(document,"mouseup",this,Blockly.Bubble.unbindDragEvents_),Blockly.Bubble.onMouseMoveWrapper_=Blockly.bindEvent_(document,"mousemove",this,this.resizeMouseMove_),Blockly.hideChaff(),a.stopPropagation())},Blockly.Bubble.prototype.resizeMouseMove_=function(a){this.autoLayout_=!1;var b=this.resizeDeltaWidth,c=this.resizeDeltaHeight+a.clientY;Blockly.RTL?b-=a.clientX:b+=a.clientX,this.setBubbleSize(b,c),Blockly.RTL&&this.positionBubble_()},Blockly.Bubble.prototype.registerResizeEvent=function(a,b){Blockly.bindEvent_(this.bubbleGroup_,"resize",a,b)},Blockly.Bubble.prototype.promote_=function(){var a=this.bubbleGroup_.parentNode;a.appendChild(this.bubbleGroup_)},Blockly.Bubble.prototype.setAnchorLocation=function(a,b){this.anchorX_=a,this.anchorY_=b,this.rendered_&&this.positionBubble_()},Blockly.Bubble.prototype.layoutBubble_=function(){var a=-this.width_/4,b=-this.height_-Blockly.BlockSvg.MIN_BLOCK_Y,c=this.workspace_.getMetrics();if(Blockly.RTL?this.anchorX_-c.viewLeft-a-this.width_<Blockly.Scrollbar.scrollbarThickness?a=this.anchorX_-c.viewLeft-this.width_-Blockly.Scrollbar.scrollbarThickness:this.anchorX_-c.viewLeft-a>c.viewWidth&&(a=this.anchorX_-c.viewLeft-c.viewWidth):this.anchorX_+a<c.viewLeft?a=c.viewLeft-this.anchorX_:c.viewLeft+c.viewWidth<this.anchorX_+a+this.width_+Blockly.BlockSvg.SEP_SPACE_X+Blockly.Scrollbar.scrollbarThickness&&(a=c.viewLeft+c.viewWidth-this.anchorX_-this.width_-Blockly.Scrollbar.scrollbarThickness),this.anchorY_+b<c.viewTop){var d=this.shape_.getBBox();b=d.height}this.relativeLeft_=a,this.relativeTop_=b},Blockly.Bubble.prototype.positionBubble_=function(){var a;a=Blockly.RTL?this.anchorX_-this.relativeLeft_-this.width_:this.anchorX_+this.relativeLeft_;var b=this.relativeTop_+this.anchorY_;this.bubbleGroup_.setAttribute("transform","translate("+a+", "+b+")")},Blockly.Bubble.prototype.getBubbleSize=function(){return{width:this.width_,height:this.height_}},Blockly.Bubble.prototype.setBubbleSize=function(a,b){var c=2*Blockly.Bubble.BORDER_WIDTH;if(a=Math.max(a,c+45),b=Math.max(b,c+Blockly.BlockSvg.FIELD_HEIGHT),this.width_=a,this.height_=b,this.bubbleBack_.setAttribute("width",a),this.bubbleBack_.setAttribute("height",b),this.resizeGroup_)if(Blockly.RTL){var d=2*Blockly.Bubble.BORDER_WIDTH;this.resizeGroup_.setAttribute("transform","translate("+d+", "+(b-c)+") scale(-1 1)")}else this.resizeGroup_.setAttribute("transform","translate("+(a-c)+", "+(b-c)+")");this.rendered_&&(this.autoLayout_&&this.layoutBubble_(),this.positionBubble_(),this.renderArrow_()),Blockly.fireUiEvent(this.bubbleGroup_,"resize")},Blockly.Bubble.prototype.renderArrow_=function(){var a=[],b=this.width_/2,c=this.height_/2,d=-this.relativeLeft_,e=-this.relativeTop_;if(b==d&&c==e)a.push("M "+b+","+c);else{var f=e-c,g=d-b;Blockly.RTL&&(g*=-1);var h=Math.sqrt(f*f+g*g),i=Math.acos(g/h);0>f&&(i=2*Math.PI-i);var j=i+Math.PI/2;j>2*Math.PI&&(j-=2*Math.PI);var k=Math.sin(j),l=Math.cos(j),m=this.getBubbleSize(),n=(m.width+m.height)/Blockly.Bubble.ARROW_THICKNESS;n=Math.min(n,m.width,m.height)/2;var o=1-Blockly.Bubble.ANCHOR_RADIUS/h;d=b+o*g,e=c+o*f;var p=b+n*l,q=c+n*k,r=b-n*l,s=c-n*k,t=i+this.arrow_radians_;t>2*Math.PI&&(t-=2*Math.PI);var u=Math.sin(t)*h/Blockly.Bubble.ARROW_BEND,v=Math.cos(t)*h/Blockly.Bubble.ARROW_BEND;a.push("M"+p+","+q),a.push("C"+(p+v)+","+(q+u)+" "+d+","+e+" "+d+","+e),a.push("C"+d+","+e+" "+(r+v)+","+(s+u)+" "+r+","+s)}a.push("z"),this.bubbleArrow_.setAttribute("d",a.join(" "))},Blockly.Bubble.prototype.setColour=function(a){this.bubbleBack_.setAttribute("fill",a),this.bubbleArrow_.setAttribute("fill",a)},Blockly.Bubble.prototype.dispose=function(){Blockly.Bubble.unbindDragEvents_(),Ext.removeNode(this.bubbleGroup_),this.bubbleGroup_=null,this.workspace_=null,this.content_=null,this.shape_=null},Blockly.Comment=function(a){Blockly.Comment.superClass_.constructor.call(this,a),this.createIcon_()},Blockly.inherits(Blockly.Comment,Blockly.Icon),Blockly.Comment.prototype.text_="",Blockly.Comment.prototype.width_=160,Blockly.Comment.prototype.height_=80,Blockly.Comment.prototype.createIcon_=function(){Blockly.Icon.prototype.createIcon_.call(this);Blockly.createSvgElement("circle",{"class":"blocklyIconShield",r:Blockly.Icon.RADIUS,cx:Blockly.Icon.RADIUS,cy:Blockly.Icon.RADIUS},this.iconGroup_);this.iconMark_=Blockly.createSvgElement("text",{"class":"blocklyIconMark",x:Blockly.Icon.RADIUS,y:2*Blockly.Icon.RADIUS-3},this.iconGroup_),this.iconMark_.appendChild(document.createTextNode("?"))},Blockly.Comment.prototype.createEditor_=function(){this.foreignObject_=Blockly.createSvgElement("foreignObject",{x:Blockly.Bubble.BORDER_WIDTH,y:Blockly.Bubble.BORDER_WIDTH},null);var a=document.createElementNS(Blockly.HTML_NS,"body");return a.setAttribute("xmlns",Blockly.HTML_NS),a.className="blocklyMinimalBody",this.textarea_=document.createElementNS(Blockly.HTML_NS,"textarea"),this.textarea_.className="blocklyCommentTextarea",this.textarea_.setAttribute("dir",Blockly.RTL?"RTL":"LTR"),this.updateEditable(),a.appendChild(this.textarea_),this.foreignObject_.appendChild(a),Blockly.bindEvent_(this.textarea_,"mouseup",this,this.textareaFocus_),this.foreignObject_},Blockly.Comment.prototype.updateEditable=function(){this.textarea_&&(this.block_.isEditable()?(this.textarea_.removeAttribute("disabled"),this.textarea_.removeAttribute("readonly")):(this.textarea_.setAttribute("disabled","disabled"),this.textarea_.setAttribute("readonly","readonly"))),Blockly.Icon.prototype.updateEditable.call(this)},Blockly.Comment.prototype.resizeBubble_=function(){var a=this.bubble_.getBubbleSize(),b=2*Blockly.Bubble.BORDER_WIDTH;this.foreignObject_.setAttribute("width",a.width-b),this.foreignObject_.setAttribute("height",a.height-b),this.textarea_.style.width=a.width-b-4+"px",this.textarea_.style.height=a.height-b-4+"px"},Blockly.Comment.prototype.setVisible=function(a){if(a!=this.isVisible()){var b=this.getText(),c=this.getBubbleSize();a?(this.bubble_=new Blockly.Bubble(this.block_.workspace,this.createEditor_(),this.block_.svg_.svgGroup_,this.iconX_,this.iconY_,this.width_,this.height_),this.bubble_.registerResizeEvent(this,this.resizeBubble_),this.updateColour(),this.text_=null):(this.bubble_.dispose(),this.bubble_=null,this.textarea_=null,this.foreignObject_=null),this.setText(b),this.setBubbleSize(c.width,c.height)}},Blockly.Comment.prototype.textareaFocus_=function(){this.bubble_.promote_(),this.textarea_.focus()},Blockly.Comment.prototype.getBubbleSize=function(){return this.isVisible()?this.bubble_.getBubbleSize():{width:this.width_,height:this.height_}},Blockly.Comment.prototype.setBubbleSize=function(a,b){this.isVisible()?this.bubble_.setBubbleSize(a,b):(this.width_=a,this.height_=b)},Blockly.Comment.prototype.getText=function(){return this.isVisible()?this.textarea_.value:this.text_},Blockly.Comment.prototype.setText=function(a){this.isVisible()?this.textarea_.value=a:this.text_=a},Blockly.Comment.prototype.dispose=function(){this.block_.comment=null,Blockly.Icon.prototype.dispose.call(this)},Blockly.Connection=function(a,b){this.sourceBlock_=a,this.targetConnection=null,this.type=b,this.x_=0,this.y_=0,this.inDB_=!1,this.dbList_=this.sourceBlock_.workspace.connectionDBList},Blockly.Connection.prototype.dispose=function(){if(this.targetConnection)throw"Disconnect connection before disposing of it.";this.inDB_&&this.dbList_[this.type].removeConnection_(this),this.inDB_=!1,Blockly.highlightedConnection_==this&&(Blockly.highlightedConnection_=null),Blockly.localConnection_==this&&(Blockly.localConnection_=null)},Blockly.Connection.prototype.isSuperior=function(){return this.type==Blockly.INPUT_VALUE||this.type==Blockly.NEXT_STATEMENT},Blockly.Connection.prototype.connect=function(a){if(this.sourceBlock_==a.sourceBlock_)throw"Attempted to connect a block to itself.";if(this.sourceBlock_.workspace!==a.sourceBlock_.workspace)throw"Blocks are on different workspaces.";if(Blockly.OPPOSITE_TYPE[this.type]!=a.type)throw"Attempt to connect incompatible types.";if(this.type==Blockly.INPUT_VALUE||this.type==Blockly.OUTPUT_VALUE){if(this.targetConnection)throw"Source connection already connected (value).";if(a.targetConnection){var b=a.targetBlock();if(b.setParent(null),!b.outputConnection)throw"Orphan block does not have an output connection.";for(var c,d=this.sourceBlock_;c=Blockly.Connection.singleConnection_(d,b);){if(!c.targetBlock()){c.connect(b.outputConnection),b=null;break}d=c.targetBlock()}b&&window.setTimeout(function(){b.outputConnection.bumpAwayFrom_(a)},Blockly.BUMP_DELAY)}}else{if(this.targetConnection)throw"Source connection already connected (block).";if(a.targetConnection){if(this.type!=Blockly.PREVIOUS_STATEMENT)throw"Can only do a mid-stack connection with the top of a block.";var b=a.targetBlock();if(b.setParent(null),!b.previousConnection)throw"Orphan block does not have a previous connection.";for(var d=this.sourceBlock_;d.nextConnection;){if(!d.nextConnection.targetConnection){d.nextConnection.connect(b.previousConnection),b=null;break}d=d.nextConnection.targetBlock()}b&&window.setTimeout(function(){b.previousConnection.bumpAwayFrom_(a)},Blockly.BUMP_DELAY)}}var e,f;this.isSuperior()?(e=this.sourceBlock_,f=a.sourceBlock_):(e=a.sourceBlock_,f=this.sourceBlock_),this.targetConnection=a,a.targetConnection=this,f.setParent(e),e.rendered&&e.svg_.updateDisabled(),f.rendered&&f.svg_.updateDisabled(),e.rendered&&f.rendered&&(this.type==Blockly.NEXT_STATEMENT||this.type==Blockly.PREVIOUS_STATEMENT?f.render():e.render())},Blockly.Connection.singleConnection_=function(a,b){for(var c=!1,d=0;d<a.inputList.length;d++){var e=a.inputList[d].connection;if(e&&e.type==Blockly.INPUT_VALUE&&b.outputConnection.checkType_(e)){if(c)return null;c=e}}return c},Blockly.Connection.prototype.disconnect=function(){var a=this.targetConnection;if(!a)throw"Source connection not connected.";if(a.targetConnection!=this)throw"Target connection not connected to source connection.";a.targetConnection=null,this.targetConnection=null;var b,c;this.isSuperior()?(b=this.sourceBlock_,c=a.sourceBlock_):(b=a.sourceBlock_,c=this.sourceBlock_),b.rendered&&b.render(),c.rendered&&(c.svg_.updateDisabled(),c.render())
},Blockly.Connection.prototype.targetBlock=function(){return this.targetConnection?this.targetConnection.sourceBlock_:null},Blockly.Connection.prototype.bumpAwayFrom_=function(a){if(0==Blockly.Block.dragMode_){var b=this.sourceBlock_.getRootBlock();if(!b.isInFlyout){var c=!1;if(!b.isMovable()){if(b=a.sourceBlock_.getRootBlock(),!b.isMovable())return;a=this,c=!0}b.getSvgRoot().parentNode.appendChild(b.getSvgRoot());var d=a.x_+Blockly.SNAP_RADIUS-this.x_,e=a.y_+Blockly.SNAP_RADIUS-this.y_;c&&(e=-e),Blockly.RTL&&(d=-d),b.moveBy(d,e)}}},Blockly.Connection.prototype.moveTo=function(a,b){this.inDB_&&this.dbList_[this.type].removeConnection_(this),this.x_=a,this.y_=b,this.dbList_[this.type].addConnection_(this)},Blockly.Connection.prototype.moveBy=function(a,b){this.moveTo(this.x_+a,this.y_+b)},Blockly.Connection.prototype.highlight=function(){var a;if(this.type==Blockly.INPUT_VALUE||this.type==Blockly.OUTPUT_VALUE){var b=Blockly.RTL?-Blockly.BlockSvg.TAB_WIDTH:Blockly.BlockSvg.TAB_WIDTH;a="m 0,0 v 5 c 0,10 "+-b+",-8 "+-b+",7.5 s "+b+",-2.5 "+b+",7.5 v 5"}else a=Blockly.RTL?"m 20,0 h -5 l -6,4 -3,0 -6,-4 h -5":"m -20,0 h 5 l 6,4 3,0 6,-4 h 5";var c=this.sourceBlock_.getRelativeToSurfaceXY(),d=this.x_-c.x,e=this.y_-c.y;Blockly.Connection.highlightedPath_=Blockly.createSvgElement("path",{"class":"blocklyHighlightedConnectionPath",d:a,transform:"translate("+d+", "+e+")"},this.sourceBlock_.getSvgRoot())},Blockly.Connection.prototype.unhighlight=function(){Ext.removeNode(Blockly.Connection.highlightedPath_),delete Blockly.Connection.highlightedPath_},Blockly.Connection.prototype.tighten_=function(){var a=Math.round(this.targetConnection.x_-this.x_),b=Math.round(this.targetConnection.y_-this.y_);if(0!=a||0!=b){var c=this.targetBlock(),d=c.getSvgRoot();if(!d)throw"block is not rendered.";var e=Blockly.getRelativeXY_(d);c.getSvgRoot().setAttribute("transform","translate("+(e.x-a)+", "+(e.y-b)+")"),c.moveConnections_(-a,-b)}},Blockly.Connection.prototype.closest=function(a,b,c){function d(b){var c=f[b];if((c.type==Blockly.OUTPUT_VALUE||c.type==Blockly.PREVIOUS_STATEMENT)&&c.targetConnection)return!0;if(c.type==Blockly.INPUT_VALUE&&c.targetConnection&&!c.targetBlock().isMovable())return!0;if(!n.checkType_(c))return!0;var d=c.sourceBlock_;do{if(m==d)return!0;d=d.getParent()}while(d);var e=g-f[b].x_,i=h-f[b].y_,j=Math.sqrt(e*e+i*i);return a>=j&&(l=f[b],a=j),a>i}if(this.targetConnection)return{connection:null,radius:a};for(var e=Blockly.OPPOSITE_TYPE[this.type],f=this.dbList_[e],g=this.x_+b,h=this.y_+c,i=0,j=f.length-2,k=j;k>i;)f[k].y_<h?i=k:j=k,k=Math.floor((i+j)/2);i=k,j=k;var l=null,m=this.sourceBlock_,n=this;if(f.length){for(;i>=0&&d(i);)i--;do j++;while(j<f.length&&d(j))}return{connection:l,radius:a}},Blockly.Connection.prototype.checkType_=function(a){if(!this.check_||!a.check_)return console.log("checkType: promiscuous"),!0;for(var b=0;b<this.check_.length;b++)if(-1!=a.check_.indexOf(this.check_[b]))return console.log("checkType: Yes"),!0;return console.log("checkType: Nope"),!1},Blockly.Connection.prototype.setCheck=function(a){return a?(Ext.isArray(a)||(a=[a]),this.check_=a,this.targetConnection&&!this.checkType_(this.targetConnection)&&(this.isSuperior()?this.targetBlock().setParent(null):this.sourceBlock_.setParent(null),this.sourceBlock_.bumpNeighbours_())):this.check_=null,this},Blockly.Connection.prototype.neighbours_=function(a){function b(b){var c=e-d[b].x_,g=f-d[b].y_,h=Math.sqrt(c*c+g*g);return a>=h&&j.push(d[b]),a>g}for(var c=Blockly.OPPOSITE_TYPE[this.type],d=this.dbList_[c],e=this.x_,f=this.y_,g=0,h=d.length-2,i=h;i>g;)d[i].y_<f?g=i:h=i,i=Math.floor((g+h)/2);g=i,h=i;{var j=[];this.sourceBlock_}if(d.length){for(;g>=0&&b(g);)g--;do h++;while(h<d.length&&b(h))}return j},Blockly.Connection.prototype.hideAll=function(){if(this.inDB_&&this.dbList_[this.type].removeConnection_(this),this.targetConnection)for(var a=this.targetBlock().getDescendants(),b=0;b<a.length;b++){for(var c=a[b],d=c.getConnections_(!0),e=0;e<d.length;e++){var f=d[e];f.inDB_&&this.dbList_[f.type].removeConnection_(f)}for(var g=c.getIcons(),h=0;h<g.length;h++)g[h].setVisible(!1)}},Blockly.Connection.prototype.unhideAll=function(){this.inDB_||this.dbList_[this.type].addConnection_(this);var a=[];if(this.type!=Blockly.INPUT_VALUE&&this.type!=Blockly.NEXT_STATEMENT)return a;var b=this.targetBlock();if(b){var c;b.isCollapsed()?(c=[],b.outputConnection&&c.push(b.outputConnection),b.nextConnection&&c.push(b.nextConnection),b.previousConnection&&c.push(b.previousConnection)):c=b.getConnections_(!0);for(var d=0;d<c.length;d++)a=a.concat(c[d].unhideAll());0==a.length&&(a[0]=b)}return a},Blockly.ConnectionDB=function(){},Blockly.ConnectionDB.prototype=new Array,Blockly.ConnectionDB.constructor=Blockly.ConnectionDB,Blockly.ConnectionDB.prototype.addConnection_=function(a){if(a.inDB_)throw"Connection already in database.";for(var b=0,c=this.length;c>b;){var d=Math.floor((b+c)/2);if(this[d].y_<a.y_)b=d+1;else{if(!(this[d].y_>a.y_)){b=d;break}c=d}}this.splice(b,0,a),a.inDB_=!0},Blockly.ConnectionDB.prototype.removeConnection_=function(a){if(!a.inDB_)throw"Connection not in database.";a.inDB_=!1;for(var b=0,c=this.length-2,d=c;d>b;)this[d].y_<a.y_?b=d:c=d,d=Math.floor((b+c)/2);for(b=d,c=d;b>=0&&this[b].y_==a.y_;){if(this[b]==a)return void this.splice(b,1);b--}do{if(this[c]==a)return void this.splice(c,1);c++}while(c<this.length&&this[c].y_==a.y_);throw"Unable to find connection in connectionDB."},Blockly.ConnectionDB.init=function(a){var b=[];b[Blockly.INPUT_VALUE]=new Blockly.ConnectionDB,b[Blockly.OUTPUT_VALUE]=new Blockly.ConnectionDB,b[Blockly.NEXT_STATEMENT]=new Blockly.ConnectionDB,b[Blockly.PREVIOUS_STATEMENT]=new Blockly.ConnectionDB,a.connectionDBList=b},Blockly.ContextMenu={},Blockly.ContextMenu.currentBlock=null,Blockly.ContextMenu.show=function(a,b){if(null!=Blockly.openMenu&&(Ext.destroy(Blockly.openMenu),Blockly.openMenu=null),Blockly.WidgetDiv.show(Blockly.ContextMenu,null),!b.length)return void Blockly.ContextMenu.hide();for(var c,d={renderTo:document.body,floating:!0,items:[],shrinkWrap:3,minWidth:30,listeners:{hide:function(a){Ext.destroy(a),Blockly.openMenu=null}}},e=0;c=b[e];e++){var f={};f.text=c.text,f.disabled=!c.enabled,c.enabled&&(f.handler=c.callback),d.items.push(f)}Blockly.openMenu=new Ext.menu.Menu(d);var g={};g.x=0,g.y=0;var e=a.clientX+g.x,h=a.clientY+g.y;Blockly.openMenu.showAt(e,h),Blockly.ContextMenu.currentBlock=null},Blockly.ContextMenu.hide=function(){Blockly.WidgetDiv.hideIfOwner(Blockly.ContextMenu),Blockly.ContextMenu.currentBlock=null},Blockly.ContextMenu.callbackFactory=function(a,b){return function(){var c=Blockly.Json.domToBlock(a.workspace,b),d=a.getRelativeToSurfaceXY();Blockly.RTL?d.x-=Blockly.SNAP_RADIUS:d.x+=Blockly.SNAP_RADIUS,d.y+=2*Blockly.SNAP_RADIUS,c.moveBy(d.x,d.y),c.select()}},Blockly.Css={},Blockly.Css.inject=function(){var a=Blockly.Css.CONTENT.join("\n"),b=Blockly.pathToBlockly.replace(/[\\\/]$/,"");a=a.replace(/<<<PATH>>>/g,b);var c=document.createElement("style");c.type="text/css";var d=document.getElementsByTagName("head")[0];if(d.appendChild(c),c.styleSheet)c.styleSheet.cssText=a;else{var e=document.createTextNode(a);c.appendChild(e)}},Blockly.Css.CONTENT=[".blocklySvg {","  background-color: #fff;","  border: 1px solid #ddd;","  overflow: hidden;","}",".blocklyWidgetDiv {","  position: absolute;","  display: none;","  z-index: 999;","}",".blocklyDraggable {","  cursor: url(<<<PATH>>>/media/handopen.cur) 8 5, auto;","}",".blocklyResizeSE {","  fill: #aaa;","  cursor: se-resize;","}",".blocklyResizeSW {","  fill: #aaa;","  cursor: sw-resize;","}",".blocklyResizeLine {","  stroke-width: 1;","  stroke: #888;","}",".blocklyHighlightedConnectionPath {","  stroke-width: 4px;","  stroke: #fc3;","  fill: none;","}",".blocklyPathLight {","  fill: none;","  stroke-width: 2;","  stroke-linecap: round;","}",".blocklySelected>.blocklyPath {","  stroke-width: 3px;","  stroke: #fc3;","}",".blocklySelected>.blocklyPathLight {","  display: none;","}",".blocklyDragging>.blocklyPath,",".blocklyDragging>.blocklyPathLight {","  fill-opacity: .8;","  stroke-opacity: .8;","}",".blocklyDragging>.blocklyPathDark {","  display: none;","}",".blocklyDisabled>.blocklyPath {","  fill-opacity: .5;","  stroke-opacity: .5;","}",".blocklyDisabled>.blocklyPathLight,",".blocklyDisabled>.blocklyPathDark {","  display: none;","}",".blocklyText {","  cursor: default;","  font-family: tahoma,arial,verdana,sans-serif;","  font-size: 9pt;","  fill: #fff;","}",".blocklyNonEditableText>text {","  pointer-events: none;","}",".blocklyNonEditableText>rect,",".blocklyEditableText>rect {","  fill: #fff;","  fill-opacity: .6;","}",".blocklyNonEditableText>text,",".blocklyEditableText>text {","  fill: #000;","}",".blocklyEditableText:hover>rect {","  stroke-width: 2;","  stroke: #fff;","}",".blocklySvg text {","  -moz-user-select: none;","  -webkit-user-select: none;","  user-select: none;","  cursor: inherit;","}",".blocklyHidden {","  display: none;","}",".blocklyFieldDropdown:not(.blocklyHidden) {","  display: block;","}",".blocklyTooltipBackground {","  fill: #ffffc7;","  stroke-width: 1px;","  stroke: #d8d8d8;","}",".blocklyTooltipShadow,",".blocklyDropdownMenuShadow {","  fill: #bbb;","  filter: url(#blocklyShadowFilter);","}",".blocklyTooltipText {","  font-family: sans-serif;","  font-size: 9pt;","  fill: #000;","}",".blocklyIconShield {","  cursor: default;","  fill: #00c;","  stroke-width: 1px;","  stroke: #ccc;","}",".blocklyIconGroup:hover>.blocklyIconShield {","  fill: #00f;","  stroke: #fff;","}",".blocklyIconGroup:hover>.blocklyIconMark {","  fill: #fff;","}",".blocklyIconMark {","  cursor: default !important;","  font-family: sans-serif;","  font-size: 9pt;","  font-weight: bold;","  fill: #ccc;","  text-anchor: middle;","}",".blocklyWarningBody {","}",".blocklyMinimalBody {","  margin: 0;","  padding: 0;","}",".blocklyCommentTextarea {","  margin: 0;","  padding: 2px;","  border: 0;","  resize: none;","  background-color: #ffc;","}",".blocklyHtmlInput {","  font-family: sans-serif;","  font-size: 11pt;","  border: none;","  outline: none;","  width: 100%","}",".blocklyMutatorBackground {","  fill: #fff;","  stroke-width: 1;","  stroke: #ddd;","}",".blocklyFlyoutBackground {","  fill: #ddd;","  fill-opacity: .8;","}",".blocklyColourBackground {","  fill: #666;","}",".blocklyScrollbarBackground {","  fill: #fff;","  stroke-width: 1;","  stroke: #e4e4e4;","}",".blocklyScrollbarKnob {","  fill: #ccc;","}",".blocklyScrollbarBackground:hover+.blocklyScrollbarKnob,",".blocklyScrollbarKnob:hover {","  fill: #bbb;","}",".blocklyInvalidInput {","  background: #faa;","}",".blocklyAngleCircle {","  stroke: #444;","  stroke-width: 1;","  fill: #ddd;","  fill-opacity: .8;","}",".blocklyAngleMarks {","  stroke: #444;","  stroke-width: 1;","}",".blocklyAngleGauge {","  fill: #f88;","  fill-opacity: .8;  ","}",".blocklyAngleLine {","  stroke: #f00;","  stroke-width: 2;","  stroke-linecap: round;","}",""],Blockly.Field=function(a){this.sourceBlock_=null,this.fieldGroup_=Blockly.createSvgElement("g",{},null),this.borderRect_=Blockly.createSvgElement("rect",{rx:4,ry:4,x:-Blockly.BlockSvg.SEP_SPACE_X/2,y:-12,height:16},this.fieldGroup_),this.textElement_=Blockly.createSvgElement("text",{"class":"blocklyText"},this.fieldGroup_),this.size_={height:25,width:0},this.setText(a),this.visible_=!0},Blockly.Field.prototype.clone=function(){console.log("There should never be an instance of Field, only its derived classes.")},Blockly.Field.NBSP="",Blockly.Field.prototype.EDITABLE=!0,Blockly.Field.prototype.init=function(a){if(this.sourceBlock_)throw"Field has already been initialized once.";this.sourceBlock_=a,this.updateEditable(),a.getSvgRoot().appendChild(this.fieldGroup_),this.mouseUpWrapper_=Blockly.bindEvent_(this.fieldGroup_,"mouseup",this,this.onMouseUp_),this.setText(null)},Blockly.Field.prototype.dispose=function(){this.mouseUpWrapper_&&(Blockly.unbindEvent_(this.mouseUpWrapper_),this.mouseUpWrapper_=null),this.sourceBlock_=null,Ext.removeNode(this.fieldGroup_),this.fieldGroup_=null,this.textElement_=null,this.borderRect_=null},Blockly.Field.prototype.updateEditable=function(){this.EDITABLE&&(this.sourceBlock_.isEditable()?(Blockly.addClass_(this.fieldGroup_,"blocklyEditableText"),Blockly.removeClass_(this.fieldGroup_,"blocklyNoNEditableText"),this.fieldGroup_.style.cursor=this.CURSOR):(Blockly.addClass_(this.fieldGroup_,"blocklyNonEditableText"),Blockly.removeClass_(this.fieldGroup_,"blocklyEditableText"),this.fieldGroup_.style.cursor=""))},Blockly.Field.prototype.isVisible=function(){return this.visible_},Blockly.Field.prototype.setVisible=function(a){this.visible_=a,this.getRootElement().style.display=a?"block":"none"},Blockly.Field.prototype.getRootElement=function(){return this.fieldGroup_},Blockly.Field.prototype.render_=function(){var a=this.textElement_.getComputedTextLength();this.borderRect_&&this.borderRect_.setAttribute("width",a+Blockly.BlockSvg.SEP_SPACE_X),this.size_.width=a},Blockly.Field.prototype.getSize=function(){return this.size_.width||this.render_(),this.size_},Blockly.Field.prototype.getText=function(){return this.text_},Blockly.Field.prototype.setText=function(a){null!==a&&a!==this.text_&&(this.text_=a,this.updateTextNode_(),this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours_(),this.sourceBlock_.workspace.fireChangeEvent()))},Blockly.Field.prototype.updateTextNode_=function(){var a=this.text_;Blockly.removeChildren(this.textElement_),a=a.replace(/\s/g,Blockly.Field.NBSP),Blockly.RTL&&a&&(a=""+a+""),a||(a=Blockly.Field.NBSP);var b=document.createTextNode(a);this.textElement_.appendChild(b),this.size_.width=0,this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours_(),this.sourceBlock_.workspace.fireChangeEvent())},Blockly.Field.prototype.getValue=function(){return this.getText()},Blockly.Field.prototype.setValue=function(a){this.setText(a)},Blockly.Field.prototype.onMouseUp_=function(a){Blockly.isRightButton(a)||2!=Blockly.Block.dragMode_&&this.sourceBlock_.isEditable()&&this.showEditor_()},Blockly.Field.prototype.setTooltip=function(){},Blockly.FieldTextInput=function(a,b){Blockly.FieldTextInput.superClass_.constructor.call(this,a),this.changeHandler_=b},Blockly.inherits(Blockly.FieldTextInput,Blockly.Field),Blockly.FieldTextInput.prototype.clone=function(){return new Blockly.FieldTextInput(this.getText(),this.changeHandler_)},Blockly.FieldTextInput.prototype.CURSOR="text",Blockly.FieldTextInput.prototype.dispose=function(){Blockly.WidgetDiv.hideIfOwner(this),Blockly.FieldTextInput.superClass_.dispose.call(this)},Blockly.FieldTextInput.prototype.setText=function(a){if(null!==a){if(this.changeHandler_){var b=this.changeHandler_(a);null!==b&&void 0!==b&&(a=b)}Blockly.Field.prototype.setText.call(this,a)}},Blockly.FieldTextInput.prototype.showEditor_=function(){Blockly.FieldTextInput.htmlInput_=Ext.create("Ext.form.field.Text",{block:this,border:!1,cls:"blocklyHtmlInput",floating:!0,value:this.text_,enableKeyEvents:!0,listeners:{keypress:function(a,b){this.block.onHtmlInputChange_(b)},keyup:function(a,b){this.block.onHtmlInputChange_(b)}}}),Blockly.WidgetDiv.show(this,this.widgetDispose_());this.resizeEditor_();Blockly.FieldTextInput.htmlInput_.show();var a=this.sourceBlock_.workspace.getCanvas();return void(Blockly.FieldTextInput.htmlInput_.onWorkspaceChangeWrapper_=Blockly.bindEvent_(a,"blocklyWorkspaceChange",this,this.resizeEditor_))},Blockly.FieldTextInput.prototype.onHtmlInputChange_=function(a){var b=Blockly.FieldTextInput.htmlInput_;if(13==a.keyCode)Blockly.WidgetDiv.hide();else if(27==a.keyCode)this.setText(b.defaultValue),Blockly.WidgetDiv.hide();else{var c=b.getValue();c!==b.oldValue_?(b.oldValue_=c,this.setText(c),this.validate_()):Ext.isWebKit&&this.sourceBlock_.render()}},Blockly.FieldTextInput.prototype.validate_=function(){var a=!0;"object"!=typeof Blockly.FieldTextInput.htmlInput_&&console.log("Error");var b=Blockly.FieldTextInput.htmlInput_;this.changeHandler_&&(a=this.changeHandler_(b.getValue())),null===a?b.addCls("blocklyInvalidInput"):b.removeCls("blocklyInvalidInput")},Blockly.FieldTextInput.prototype.resizeEditor_=function(){var a=Blockly.FieldTextInput.htmlInput_;if(null!=a){var b=this.fieldGroup_.getBBox(),c=Blockly.getAbsoluteXY_(this.borderRect_);c.x-=1,c.y+=1,Ext.isWebKit&&(c.y-=3),a.setPosition(c.x,c.y),a.setSize(b.width+2,b.height+2)}},Blockly.FieldTextInput.prototype.widgetDispose_=function(){var a=this;return function(){var b=Blockly.FieldTextInput.htmlInput_,c=b.getValue();a.changeHandler_&&(c=a.changeHandler_(c),null===c&&(c=b.defaultValue)),a.setText(c),Blockly.unbindEvent_(b.onWorkspaceChangeWrapper_),null!=b&&b.destroy(),Blockly.FieldTextInput.htmlInput_=null}},Blockly.FieldTextInput.numberValidator=function(a){a=a.replace(/O/gi,"0"),a=a.replace(/,/g,"");var b=parseFloat(a||0);return isNaN(b)?null:String(b)},Blockly.FieldTextInput.nonnegativeIntegerValidator=function(a){var b=Blockly.FieldTextInput.numberValidator(a);return b&&(b=String(Math.max(0,Math.floor(b)))),b},Blockly.FieldAngle=function(a,b){var c;if(b){var d=this;c=function(a){return a=Blockly.FieldAngle.angleValidator.call(d,a),null!==a&&b.call(d,a),a}}else c=Blockly.FieldAngle.angleValidator;this.symbol_=Blockly.createSvgElement("tspan",{},null),this.symbol_.appendChild(document.createTextNode("")),Blockly.FieldAngle.superClass_.constructor.call(this,a,c)},Blockly.inherits(Blockly.FieldAngle,Blockly.FieldTextInput),Blockly.FieldAngle.prototype.clone=function(){return new Blockly.FieldAngle(this.getText(),this.changeHandler_)},Blockly.FieldAngle.ROUND=15,Blockly.FieldAngle.HALF=50,Blockly.FieldAngle.RADIUS=Blockly.FieldAngle.HALF-1,Blockly.FieldAngle.prototype.dispose_=function(){var a=this;return function(){Blockly.FieldAngle.superClass_.dispose_.call(a)(),a.gauge_=null,a.clickWrapper_&&Blockly.unbindEvent_(a.clickWrapper_),a.moveWrapper1_&&Blockly.unbindEvent_(a.moveWrapper1_),a.moveWrapper2_&&Blockly.unbindEvent_(a.moveWrapper2_)}},Blockly.FieldAngle.prototype.showEditor_=function(){Blockly.FieldAngle.superClass_.showEditor_.call(this);var a=Blockly.WidgetDiv.DIV;if(a.firstChild){var b=Blockly.createSvgElement("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:html":"http://www.w3.org/1999/xhtml","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",height:2*Blockly.FieldAngle.HALF+"px",width:2*Blockly.FieldAngle.HALF+"px"},a),c=Blockly.createSvgElement("circle",{cx:Blockly.FieldAngle.HALF,cy:Blockly.FieldAngle.HALF,r:Blockly.FieldAngle.RADIUS,"class":"blocklyAngleCircle"},b);this.gauge_=Blockly.createSvgElement("path",{"class":"blocklyAngleGauge"},b),this.line_=Blockly.createSvgElement("line",{x1:Blockly.FieldAngle.HALF,y1:Blockly.FieldAngle.HALF,"class":"blocklyAngleLine"},b);for(var d=0;360>d;d+=15)Blockly.createSvgElement("line",{x1:Blockly.FieldAngle.HALF+Blockly.FieldAngle.RADIUS,y1:Blockly.FieldAngle.HALF,x2:Blockly.FieldAngle.HALF+Blockly.FieldAngle.RADIUS-(d%45==0?10:5),y2:Blockly.FieldAngle.HALF,"class":"blocklyAngleMarks",transform:"rotate("+d+", "+Blockly.FieldAngle.HALF+", "+Blockly.FieldAngle.HALF+")"},b);b.style.marginLeft="-35px",this.clickWrapper_=Blockly.bindEvent_(b,"click",this,Blockly.WidgetDiv.hide),this.moveWrapper1_=Blockly.bindEvent_(c,"mousemove",this,this.onMouseMove),this.moveWrapper2_=Blockly.bindEvent_(this.gauge_,"mousemove",this,this.onMouseMove),this.updateGraph_()}},Blockly.FieldAngle.prototype.onMouseMove=function(a){var b=this.gauge_.ownerSVGElement.getBoundingClientRect(),c=a.clientX-b.left-Blockly.FieldAngle.HALF,d=a.clientY-b.top-Blockly.FieldAngle.HALF,e=Math.atan(-d/c);isNaN(e)||(e=e/Math.PI*180,0>c?e+=180:d>0&&(e+=360),Blockly.FieldAngle.ROUND&&(e=Math.round(e/Blockly.FieldAngle.ROUND)*Blockly.FieldAngle.ROUND),e>=360&&(e-=360),e=String(e),Blockly.FieldTextInput.htmlInput_.value=e,this.setText(e))},Blockly.FieldAngle.prototype.setText=function(a){Blockly.FieldAngle.superClass_.setText.call(this,a),this.updateGraph_(),Blockly.RTL?this.textElement_.insertBefore(this.symbol_,this.textElement_.firstChild):this.textElement_.appendChild(this.symbol_),this.size_.width=0},Blockly.FieldAngle.prototype.updateGraph_=function(){if(this.gauge_){var a=Number(this.getText())/180*Math.PI;if(isNaN(a))this.gauge_.setAttribute("d","M "+Blockly.FieldAngle.HALF+", "+Blockly.FieldAngle.HALF),this.line_.setAttribute("x2",Blockly.FieldAngle.HALF),this.line_.setAttribute("y2",Blockly.FieldAngle.HALF);else{var b=Blockly.FieldAngle.HALF+Math.cos(a)*Blockly.FieldAngle.RADIUS,c=Blockly.FieldAngle.HALF+Math.sin(a)*-Blockly.FieldAngle.RADIUS,d=a>Math.PI?1:0;this.gauge_.setAttribute("d","M "+Blockly.FieldAngle.HALF+", "+Blockly.FieldAngle.HALF+" h "+Blockly.FieldAngle.RADIUS+" A "+Blockly.FieldAngle.RADIUS+","+Blockly.FieldAngle.RADIUS+" 0 "+d+" 0 "+b+","+c+" z"),this.line_.setAttribute("x2",b),this.line_.setAttribute("y2",c)}}},Blockly.FieldAngle.angleValidator=function(a){var b=Blockly.FieldTextInput.numberValidator(a);return null!==b&&(b%=360,0>b&&(b+=360),b=String(b)),b},Blockly.FieldCheckbox=function(a,b){Blockly.FieldCheckbox.superClass_.constructor.call(this,""),this.changeHandler_=b,this.checkElement_=Blockly.createSvgElement("text",{"class":"blocklyText",x:-3},this.fieldGroup_);var c=document.createTextNode("");this.checkElement_.appendChild(c),this.setValue(a)},Blockly.inherits(Blockly.FieldCheckbox,Blockly.Field),Blockly.FieldCheckbox.prototype.clone=function(){return new Blockly.FieldCheckbox(this.getValue(),this.changeHandler_)},Blockly.FieldCheckbox.prototype.CURSOR="default",Blockly.FieldCheckbox.prototype.getValue=function(){return String(this.state_).toUpperCase()},Blockly.FieldCheckbox.prototype.setValue=function(a){var b="TRUE"==a;this.state_!==b&&(this.state_=b,this.checkElement_.style.display=b?"block":"none",this.sourceBlock_&&this.sourceBlock_.rendered&&this.sourceBlock_.workspace.fireChangeEvent())},Blockly.FieldCheckbox.prototype.showEditor_=function(){var a=!this.state_;if(this.changeHandler_){var b=this.changeHandler_(a);void 0!==b&&(a=b)}null!==a&&this.setValue(String(a).toUpperCase())},Blockly.FieldColour=function(a,b){Blockly.FieldColour.superClass_.constructor.call(this,""),this.changeHandler_=b,this.borderRect_.style.fillOpacity=1,this.setValue(a)},Blockly.inherits(Blockly.FieldColour,Blockly.Field),Blockly.FieldColour.prototype.clone=function(){return new Blockly.FieldColour(this.getValue(),this.changeHandler_)},Blockly.FieldColour.prototype.CURSOR="default",Blockly.FieldColour.prototype.dispose=function(){Blockly.WidgetDiv.hideIfOwner(this),Blockly.FieldColour.superClass_.dispose.call(this)},Blockly.FieldColour.prototype.getValue=function(){return this.colour_},Blockly.FieldColour.prototype.setValue=function(a){this.colour_=a,this.borderRect_.style.fill=a,this.sourceBlock_&&this.sourceBlock_.rendered&&(Blockly.Realtime.blockChanged(this.sourceBlock_),this.sourceBlock_.workspace.fireChangeEvent())},Blockly.FieldColour.COLOURS=[],Blockly.FieldColour.COLUMNS=7,Blockly.FieldColour.prototype.showEditor_=function(){Blockly.WidgetDiv.show(this,Blockly.FieldColour.widgetDispose_);var a=new goog.ui.ColorPicker;a.setSize(Blockly.FieldColour.COLUMNS),a.setColors(Blockly.FieldColour.COLOURS);var b=goog.dom.getViewportSize(),c=goog.style.getViewportPageOffset(document),d=Blockly.getAbsoluteXY_(this.borderRect_),e=this.borderRect_.getBBox(),f=Blockly.WidgetDiv.DIV;a.render(f),a.setSelectedColor(this.getValue());var g=goog.style.getSize(a.getElement());d.y+g.height+e.height>=b.height+c.y?d.y-=g.height-1:d.y+=e.height-1,Blockly.RTL?(d.x+=e.width,d.x-=g.width,d.x<c.x&&(d.x=c.x)):d.x>b.width+c.x-g.width&&(d.x=b.width+c.x-g.width),Blockly.WidgetDiv.position(d.x,d.y,b,c);var h=this;Blockly.FieldColour.changeEventKey_=goog.events.listen(a,goog.ui.ColorPicker.EventType.CHANGE,function(a){var b=a.target.getSelectedColor()||"#000000";if(Blockly.WidgetDiv.hide(),h.changeHandler_){var c=h.changeHandler_(b);void 0!==c&&(b=c)}null!==b&&h.setValue(b)})},Blockly.FieldColour.widgetDispose_=function(){Blockly.FieldColour.changeEventKey_&&goog.events.unlistenByKey(Blockly.FieldColour.changeEventKey_)},Blockly.FieldDropdown=function(a,b){this.menuGenerator_=a,this.changeHandler_=b,this.trimOptions_();var c=this.getOptions_()[0];this.value_=c[1];var d=Ext.is.Android?"":"";this.arrow_=Blockly.createSvgElement("tspan",{},null),this.arrow_.appendChild(document.createTextNode(Blockly.RTL?d+" ":" "+d)),Blockly.FieldDropdown.superClass_.constructor.call(this,c[0])},Blockly.inherits(Blockly.FieldDropdown,Blockly.Field),Blockly.FieldDropdown.CHECKMARK_OVERHANG=25,Blockly.FieldDropdown.prototype.clone=function(){return new Blockly.FieldDropdown(this.menuGenerator_,this.changeHandler_)},Blockly.FieldDropdown.prototype.CURSOR="default",Blockly.FieldDropdown.prototype.showEditor_=function(){null!=Blockly.openMenu&&(Ext.destroy(Blockly.openMenu),Blockly.openMenu=null),Blockly.WidgetDiv.show(this,null);for(var a=this,b=function(b){if(null!=b){var c=b.getId();a.changeHandler_?a.changeHandler_(c):null!==c&&a.setValue(c)}},c={renderTo:document.body,floating:!0,items:[],shrinkWrap:3,minWidth:30,listeners:{hide:function(a){Ext.destroy(a),Blockly.openMenu=null}}},d=this.getOptions_(),e=0;e<d.length;e++){var f={};f.id=d[e][1],f.text=d[e][0],f.handler=b,f.id==this.value_&&(f.iconCls="x-menu-item-arrow"),c.items.push(f)}var g=Blockly.getAbsoluteXY_(this.borderRect_),h=this.borderRect_.getBBox();Blockly.openMenu=new Ext.menu.Menu(c),Blockly.openMenu.showAt(g.x,g.y+h.height)},Blockly.FieldDropdown.prototype.trimOptions_=function(){this.prefixField=null,this.suffixField=null;var a=this.menuGenerator_;if(Ext.isArray(a)&&!(a.length<2)){var b=a.map(function(a){return a[0]}),c=Blockly.shortestStringLength(b),d=Blockly.commonWordPrefix(b,c),e=Blockly.commonWordSuffix(b,c);if((d||e)&&!(d+e>=c)){d&&(this.prefixField=b[0].substring(0,d-1)),e&&(this.suffixField=b[0].substr(1-e));for(var f=[],g=0;g<a.length;g++){var h=a[g][0],i=a[g][1];h=h.substring(d,h.length-e),f[g]=[h,i]}this.menuGenerator_=f}}},Blockly.FieldDropdown.prototype.getOptions_=function(){return Ext.isFunction(this.menuGenerator_)?this.menuGenerator_.call(this):this.menuGenerator_},Blockly.FieldDropdown.prototype.getValue=function(){return this.value_},Blockly.FieldDropdown.prototype.setValue=function(a){this.value_=a;for(var b=this.getOptions_(),c=0;c<b.length;c++)if(b[c][1]==a)return void this.setText(b[c][0]);this.setText(a)},Blockly.FieldDropdown.prototype.setText=function(a){this.sourceBlock_&&(this.arrow_.style.fill=Blockly.makeColour(this.sourceBlock_.getColour())),null!==a&&a!==this.text_&&(this.text_=a,this.updateTextNode_(),Blockly.RTL?this.textElement_.insertBefore(this.arrow_,this.textElement_.firstChild):this.textElement_.appendChild(this.arrow_),this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours_(),this.sourceBlock_.workspace.fireChangeEvent()))},Blockly.FieldDropdown.prototype.dispose=function(){Blockly.WidgetDiv.hideIfOwner(this),Blockly.FieldDropdown.superClass_.dispose.call(this)},Blockly.FieldImage=function(a,b,c,d){this.sourceBlock_=null,this.height_=Number(c),this.width_=Number(b),this.size_={height:this.height_+10,width:this.width_},this.text_=d||"";var e=6-Blockly.BlockSvg.FIELD_HEIGHT;this.fieldGroup_=Blockly.createSvgElement("g",{},null),this.imageElement_=Blockly.createSvgElement("image",{height:this.height_+"px",width:this.width_+"px",y:e},this.fieldGroup_),this.setValue(a),Ext.isGecko&&(this.rectElement_=Blockly.createSvgElement("rect",{height:this.height_+"px",width:this.width_+"px",y:e,"fill-opacity":0},this.fieldGroup_))},Blockly.inherits(Blockly.FieldImage,Blockly.Field),Blockly.FieldImage.prototype.clone=function(){return new Blockly.FieldImage(this.getSrc(),this.width_,this.height_,this.getText())},Blockly.FieldImage.prototype.rectElement_=null,Blockly.FieldImage.prototype.EDITABLE=!1,Blockly.FieldImage.prototype.init=function(a){if(this.sourceBlock_)throw"Image has already been initialized once.";this.sourceBlock_=a,a.getSvgRoot().appendChild(this.fieldGroup_);var b=this.rectElement_||this.imageElement_;b.tooltip=this.sourceBlock_,Blockly.Tooltip.bindMouseEvents(b)},Blockly.FieldImage.prototype.dispose=function(){Ext.removeNode(this.fieldGroup_),this.fieldGroup_=null,this.imageElement_=null,this.rectElement_=null},Blockly.FieldImage.prototype.setTooltip=function(a){var b=this.rectElement_||this.imageElement_;b.tooltip=a},Blockly.FieldImage.prototype.getValue=function(){return this.src_},Blockly.FieldImage.prototype.setValue=function(a){null!==a&&(this.src_=a,this.imageElement_.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","string"==typeof a?a:""))},Blockly.FieldImage.prototype.setText=function(a){null!==a&&(this.text_=a)},Blockly.FieldLabel=function(a){this.sourceBlock_=null,this.textElement_=Blockly.createSvgElement("text",{"class":"blocklyText"},null),this.size_={height:25,width:0},this.setText(a)},Blockly.inherits(Blockly.FieldLabel,Blockly.Field),Blockly.FieldLabel.prototype.clone=function(){return new Blockly.FieldLabel(this.getText())},Blockly.FieldLabel.prototype.EDITABLE=!1,Blockly.FieldLabel.prototype.init=function(a){if(this.sourceBlock_)throw"Text has already been initialized once.";this.sourceBlock_=a,a.getSvgRoot().appendChild(this.textElement_),this.textElement_.tooltip=this.sourceBlock_,Blockly.Tooltip.bindMouseEvents(this.textElement_)},Blockly.FieldLabel.prototype.dispose=function(){Ext.removeNode(this.textElement_),this.textElement_=null},Blockly.FieldLabel.prototype.getRootElement=function(){return this.textElement_},Blockly.FieldLabel.prototype.setTooltip=function(a){this.textElement_.tooltip=a},Blockly.FieldVariable=function(a,b){var c;if(b){var d=this;c=function(a){var c,e=Blockly.FieldVariable.dropdownChange.call(d,a);return c=void 0===e?a:null===e?d.getValue():e,b.call(d,c),e}}else c=Blockly.FieldVariable.dropdownChange;Blockly.FieldVariable.superClass_.constructor.call(this,Blockly.FieldVariable.dropdownCreate,c),this.setValue(a?a:Blockly.Variables.generateUniqueName())},Blockly.inherits(Blockly.FieldVariable,Blockly.FieldDropdown),Blockly.FieldVariable.prototype.clone=function(){return new Blockly.FieldVariable(this.getValue(),this.changeHandler_)},Blockly.FieldVariable.prototype.getValue=function(){return this.getText()},Blockly.FieldVariable.prototype.setValue=function(a){this.value_=a,this.setText(a)},Blockly.FieldVariable.dropdownCreate=function(){var a=Blockly.Variables.allVariables(this.name),b=this.getText();b&&-1==a.indexOf(b)&&a.push(b),a.sort(Blockly.caseInsensitiveCompare),a.push(Blockly.Msg.RENAME_VARIABLE),a.push(Blockly.Msg.NEW_VARIABLE);for(var c=[],d=0;d<a.length;d++)c[d]=[a[d],a[d]];return c},Blockly.FieldVariable.dropdownChange=function(a){Blockly.hideChaff();var b="";if(a==Blockly.Msg.RENAME_VARIABLE)b=this.getText();else if(a!=Blockly.Msg.NEW_VARIABLE)return void this.setText(a);var c=this,d=Ext.widget("form",{layout:{type:"vbox",align:"stretch"},border:!1,bodyPadding:10,fieldDefaults:{labelAlign:"top",labelWidth:100,labelStyle:"font-weight:bold"},defaults:{margins:"0 0 10 0"},items:[{margin:"0 0 0 0",xtype:"textfield",fieldLabel:a,itemId:"variable",name:"variable",value:b}],buttons:[{text:"Cancel",handler:function(){this.up("window").destroy()}},{text:"Ok",handler:function(){if(this.up("form").getForm().isValid()){var a=d.getForm().findField("variable").getSubmitValue();a&&a.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,""),Blockly.Variables.renameVariable(c.name,b,a),c.setText(a),this.up("window").destroy()}}}]}),e=Ext.widget("window",{title:a,closeAction:"destroy",width:225,resizable:!1,draggable:!1,modal:!0,layout:{type:"vbox",align:"stretch"},items:[d]});e.show()},Blockly.Flyout=function(){var a=this;this.workspace_=new Blockly.Workspace(function(){return a.getMetrics_()},function(b){return a.setMetrics_(b)}),this.workspace_.isFlyout=!0,this.changeWrapper_=null,this.width_=0,this.height_=0,this.buttons_=[],this.listeners_=[]
},Blockly.Flyout.prototype.autoClose=!0,Blockly.Flyout.prototype.CORNER_RADIUS=8,Blockly.Flyout.prototype.onResizeWrapper_=null,Blockly.Flyout.prototype.createDom=function(){return this.svgGroup_=Blockly.createSvgElement("g",{},null),this.svgBackground_=Blockly.createSvgElement("path",{"class":"blocklyFlyoutBackground"},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.svgGroup_},Blockly.Flyout.prototype.dispose=function(){this.hide(),this.onResizeWrapper_&&(Blockly.unbindEvent_(this.onResizeWrapper_),this.onResizeWrapper_=null),this.changeWrapper_&&(Blockly.unbindEvent_(this.changeWrapper_),this.changeWrapper_=null),this.scrollbar_&&(this.scrollbar_.dispose(),this.scrollbar_=null),this.workspace_=null,this.svgGroup_&&(Ext.removeNode(this.svgGroup_),this.svgGroup_=null),this.svgBackground_=null,this.targetWorkspace_=null},Blockly.Flyout.prototype.getMetrics_=function(){if(!this.isVisible())return null;var a=this.height_-2*this.CORNER_RADIUS,b=this.width_;try{var c=this.workspace_.getCanvas().getBBox()}catch(d){var c={height:0,y:0}}return{viewHeight:a,viewWidth:b,contentHeight:c.height+c.y,viewTop:-this.workspace_.scrollY,contentTop:0,absoluteTop:this.CORNER_RADIUS,absoluteLeft:0}},Blockly.Flyout.prototype.setMetrics_=function(a){var b=this.getMetrics_();if(b){Ext.isNumber(a.y)&&(this.workspace_.scrollY=-b.contentHeight*a.y-b.contentTop);var c=this.workspace_.scrollY+b.absoluteTop;this.workspace_.getCanvas().setAttribute("transform","translate(0,"+c+")"),this.workspace_.getCanvas().setAttribute("transform","translate(0,"+c+")")}},Blockly.Flyout.prototype.init=function(a,b){this.targetWorkspace_=a;var c=this;b&&(this.scrollbar_=new Blockly.Scrollbar(c.workspace_,!1,!1)),this.hide(),console.log("this.onResizeWrapper_ = Blockly.bindEvent_(window, goog.events.EventType.RESIZE, this, this.position_);"),this.position_(),this.changeWrapper_=Blockly.bindEvent_(this.targetWorkspace_.getCanvas(),"blocklyWorkspaceChange",this,this.filterForCapacity_)},Blockly.Flyout.prototype.position_=function(){if(this.isVisible()){var a=this.targetWorkspace_.getMetrics();if(a){var b=this.width_-this.CORNER_RADIUS;Blockly.RTL&&(b*=-1);var c=["M "+(Blockly.RTL?this.width_:0)+",0"];c.push("h",b),c.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,Blockly.RTL?0:1,Blockly.RTL?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS),c.push("v",Math.max(0,a.viewHeight-2*this.CORNER_RADIUS)),c.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,Blockly.RTL?0:1,Blockly.RTL?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS),c.push("h",-b),c.push("z"),this.svgBackground_.setAttribute("d",c.join(" "));var d=a.absoluteLeft;Blockly.RTL&&(d+=a.viewWidth,d-=this.width_),this.svgGroup_.setAttribute("transform","translate("+d+","+a.absoluteTop+")"),this.height_=a.viewHeight,this.scrollbar_&&this.scrollbar_.resize()}}},Blockly.Flyout.prototype.isVisible=function(){return"block"==this.svgGroup_.style.display},Blockly.Flyout.prototype.hide=function(){if(this.isVisible()){this.svgGroup_.style.display="none";for(var a,b=0;a=this.listeners_[b];b++)Blockly.unbindEvent_(a);this.listeners_.splice(0),this.reflowWrapper_&&(Blockly.unbindEvent_(this.reflowWrapper_),this.reflowWrapper_=null);for(var c,d=this.workspace_.getTopBlocks(!1),b=0;c=d[b];b++)c.workspace==this.workspace_&&c.dispose(!1,!1);for(var e,b=0;e=this.buttons_[b];b++)Ext.removeNode(e);this.buttons_.splice(0)}},Blockly.Flyout.prototype.show=function(a){this.hide();var b=this.CORNER_RADIUS;this.svgGroup_.style.display="block";var c=[],d=[];if(a==Blockly.Variables.NAME_TYPE)Blockly.Variables.flyoutCategory(c,d,b,this.workspace_);else if(a==Blockly.Procedures.NAME_TYPE)Blockly.Procedures.flyoutCategory(c,d,b,this.workspace_);else for(var e,f=0;e=a[f];f++)if(e.tagName&&"BLOCK"==e.tagName.toUpperCase()){var g=Blockly.Xml.domToBlock(this.workspace_,e);c.push(g),d.push(3*b)}for(var g,h=b,f=0;g=c[f];f++){for(var i,j=g.getDescendants(),k=0;i=j[k];k++)i.isInFlyout=!0,i.setCommentText(null);g.render();var l=g.getSvgRoot(),m=g.getHeightWidth(),n=Blockly.RTL?0:b+Blockly.BlockSvg.TAB_WIDTH;g.moveBy(n,h),h+=m.height+d[f];var o=Blockly.createSvgElement("rect",{"fill-opacity":0},null);this.workspace_.getCanvas().insertBefore(o,g.getSvgRoot()),g.flyoutRect_=o,this.buttons_[f]=o,this.listeners_.push(this.autoClose?Blockly.bindEvent_(l,"mousedown",null,this.createBlockFunc_(g)):Blockly.bindEvent_(l,"mousedown",null,this.blockMouseDown_(g))),this.listeners_.push(Blockly.bindEvent_(l,"mouseover",g.svg_,g.svg_.addSelect)),this.listeners_.push(Blockly.bindEvent_(l,"mouseout",g.svg_,g.svg_.removeSelect)),this.listeners_.push(Blockly.bindEvent_(o,"mousedown",null,this.createBlockFunc_(g))),this.listeners_.push(Blockly.bindEvent_(o,"mouseover",g.svg_,g.svg_.addSelect)),this.listeners_.push(Blockly.bindEvent_(o,"mouseout",g.svg_,g.svg_.removeSelect))}var p=function(){for(var a,b=this.workspace_.getTopBlocks(!1),c=0;a=b[c];c++)a.svg_.removeSelect()};this.listeners_.push(Blockly.bindEvent_(this.svgBackground_,"mouseover",this,p)),this.width_=0,this.reflow(),this.filterForCapacity_(),Blockly.fireUiEventNow(window,"resize"),this.reflowWrapper_=Blockly.bindEvent_(this.workspace_.getCanvas(),"blocklyWorkspaceChange",this,this.reflow),this.workspace_.fireChangeEvent()},Blockly.Flyout.prototype.reflow=function(){for(var a,b=0,c=this.CORNER_RADIUS,d=this.workspace_.getTopBlocks(!1),e=0;a=d[e];e++){var f=(a.getSvgRoot(),a.getHeightWidth());b=Math.max(b,f.width)}if(b+=c+Blockly.BlockSvg.TAB_WIDTH+c/2+Blockly.Scrollbar.scrollbarThickness,this.width_!=b){for(var a,e=0;a=d[e];e++){var f=a.getHeightWidth(),g=a.getRelativeToSurfaceXY();if(Blockly.RTL){var h=b-c-Blockly.BlockSvg.TAB_WIDTH-g.x;a.moveBy(h,0),g.x+=h}a.flyoutRect_&&(a.flyoutRect_.setAttribute("width",f.width),a.flyoutRect_.setAttribute("height",f.height),a.flyoutRect_.setAttribute("x",Blockly.RTL?g.x-f.width:g.x),a.flyoutRect_.setAttribute("y",g.y))}this.width_=b,Blockly.fireUiEvent(window,"resize")}},Blockly.Block.prototype.moveTo=function(a,b){var c=this.getRelativeToSurfaceXY();this.svg_.getRootElement().setAttribute("transform","translate("+a+", "+b+")"),this.moveConnections_(a-c.x,b-c.y)},Blockly.Flyout.prototype.blockMouseDown_=function(a){var b=this;return function(c){Blockly.terminateDrag_(),Blockly.hideChaff(),Blockly.isRightButton(c)?a.showContextMenu_(c):(Blockly.removeAllRanges(),Blockly.setCursorHand_(!0),Blockly.Flyout.startDownEvent_=c,Blockly.Flyout.startBlock_=a,Blockly.Flyout.startFlyout_=b,Blockly.Flyout.onMouseUpWrapper_=Blockly.bindEvent_(document,"mouseup",this,Blockly.terminateDrag_),Blockly.Flyout.onMouseMoveWrapper_=Blockly.bindEvent_(document,"mousemove",this,b.onMouseMove_)),c.stopPropagation()}},Blockly.Flyout.prototype.onMouseMove_=function(a){if("mousemove"==a.type&&a.clientX<=1&&0==a.clientY&&0==a.button)return void a.stopPropagation();Blockly.removeAllRanges();var b=a.clientX-Blockly.Flyout.startDownEvent_.clientX,c=a.clientY-Blockly.Flyout.startDownEvent_.clientY,d=Math.sqrt(Math.pow(b,2)+Math.pow(c,2));d>Blockly.DRAG_RADIUS&&Blockly.Flyout.startFlyout_.createBlockFunc_(Blockly.Flyout.startBlock_)(Blockly.Flyout.startDownEvent_)},Blockly.Flyout.prototype.createBlockFunc_=function(a){var b=this;return function(c){if(!Blockly.isRightButton(c)&&!a.disabled){var d=Blockly.Xml.blockToDom_(a),e=Blockly.Xml.domToBlock(b.targetWorkspace_,d),f=a.getSvgRoot();if(!f)throw"originBlock is not rendered.";var g=Blockly.getSvgXY_(f),h=e.getSvgRoot();if(!h)throw"block is not rendered.";var i=Blockly.getSvgXY_(h);e.moveBy(g.x-i.x,g.y-i.y),b.autoClose?b.hide():b.filterForCapacity_(),e.onMouseDown_(c)}}},Blockly.Flyout.prototype.filterForCapacity_=function(){for(var a,b=this.targetWorkspace_.remainingCapacity(),c=this.workspace_.getTopBlocks(!1),d=0;a=c[d];d++){var e=a.getDescendants(),f=e.length>b;a.setDisabled(f)}},Blockly.Flyout.terminateDrag_=function(){Blockly.Flyout.onMouseUpWrapper_&&(Blockly.unbindEvent_(Blockly.Flyout.onMouseUpWrapper_),Blockly.Flyout.onMouseUpWrapper_=null),Blockly.Flyout.onMouseMoveWrapper_&&(Blockly.unbindEvent_(Blockly.Flyout.onMouseMoveWrapper_),Blockly.Flyout.onMouseMoveWrapper_=null),Blockly.Flyout.startDownEvent_=null,Blockly.Flyout.startBlock_=null,Blockly.Flyout.startFlyout_=null},Blockly.Generator=function(a){this.name_=a,this.RESERVED_WORDS_=""},Blockly.Generator.NAME_TYPE="generated_function",Blockly.Generator.prototype.workspaceToCode=function(){var a=[];this.init();for(var b,c=Blockly.mainWorkspace.getTopBlocks(!0),d=0;b=c[d];d++){var e=this.blockToCode(b);Ext.isArray(e)&&(e=e[0]),e&&(b.outputConnection&&this.scrubNakedValue&&(e=this.scrubNakedValue(e)),a.push(e))}return a=a.join("\n"),a=this.finish(a),a=a.replace(/^\s+\n/,""),a=a.replace(/\n\s+$/,"\n"),a=a.replace(/[ \t]+\n/g,"\n")},Blockly.Generator.prototype.prefixLines=function(a,b){return b+a.replace(/\n(.)/g,"\n"+b+"$1")},Blockly.Generator.prototype.allNestedComments=function(a){for(var b=[],c=a.getDescendants(),d=0;d<c.length;d++){var e=c[d].getCommentText();e&&b.push(e)}return b.length&&b.push(""),b.join("\n")},Blockly.Generator.prototype.blockToCode=function(a){if(!a)return"";if(a.disabled){var b=a.nextConnection&&a.nextConnection.targetBlock();return this.blockToCode(b)}var c=this[a.type];if(!c)throw'Language "'+this.name_+'" does not know how to generate code for block type "'+a.type+'".';var d=c.call(a,a);return Ext.isArray(d)?[this.scrub_(a,d[0]),d[1]]:this.scrub_(a,d)},Blockly.Generator.prototype.valueToCode=function(a,b,c){if(isNaN(c))throw'Expecting valid order from block "'+a.type+'".';var d=a.getInputTargetBlock(b);if(!d)return"";var e=this.blockToCode(d);if(""===e)return"";if(!Ext.isArray(e))throw'Expecting tuple from value block "'+d.type+'".';var f=e[0],g=e[1];if(isNaN(g))throw'Expecting valid order from value block "'+d.type+'".';return f&&g>=c&&(c==g||0==c||99==c||(f="("+f+")")),f},Blockly.Generator.prototype.statementToCode=function(a,b){var c=a.getInputTargetBlock(b),d=this.blockToCode(c);if(!Ext.isString(d))throw'Expecting code from statement block "'+c.type+'".';return d&&(d=this.prefixLines(d,"  ")),d},Blockly.Generator.prototype.addReservedWords=function(a){this.RESERVED_WORDS_+=a+","},Blockly.Generator.prototype.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",Blockly.Generator.prototype.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(Blockly.Generator.prototype.FUNCTION_NAME_PLACEHOLDER_,"g"),Blockly.Generator.prototype.provideFunction_=function(a,b){if(!this.definitions_[a]){var c=this.variableDB_.getDistinctName(a,this.NAME_TYPE);this.functionNames_[a]=c,this.definitions_[a]=b.join("\n").replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,c)}return this.functionNames_[a]},Blockly.inject=function(a,b){if(null==Ext.getDom(a))throw"Error: container is not in current document.";Blockly.DIV=a,b&&Blockly.mixin(Blockly,Blockly.parseOptions_(b));var c=function(){Blockly.createDom_(a),Blockly.init_()};c()},Blockly.parseOptions_=function(a){var b=!!a.readOnly;if(b)var c=!1,d=!1,e=null;else{var c=a.trashcan;void 0===c&&(c=!1);var d=a.collapse;void 0===d&&(d=!1)}var f=a.scrollbars;return void 0===f&&(f=!0),{RTL:!!a.rtl,collapse:d,readOnly:b,maxBlocks:a.maxBlocks||1/0,pathToBlockly:a.path||"./",hasScrollbars:f,hasTrashcan:c,languageTree:e}},Blockly.createDom_=function(a){a.setAttribute("dir","LTR"),Blockly.Css.inject();var b,c,d,e,f=Blockly.createSvgElement("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:html":"http://www.w3.org/1999/xhtml","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1","class":"blocklySvg"},null),g=Blockly.createSvgElement("defs",{},f);if(b=Blockly.createSvgElement("filter",{id:"blocklyEmboss"},g),Blockly.createSvgElement("feGaussianBlur",{"in":"SourceAlpha",stdDeviation:1,result:"blur"},b),c=Blockly.createSvgElement("feSpecularLighting",{"in":"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},b),Blockly.createSvgElement("fePointLight",{x:-5e3,y:-1e4,z:2e4},c),Blockly.createSvgElement("feComposite",{"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},b),Blockly.createSvgElement("feComposite",{"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},b),b=Blockly.createSvgElement("filter",{id:"blocklyTrashcanShadowFilter"},g),Blockly.createSvgElement("feGaussianBlur",{"in":"SourceAlpha",stdDeviation:2,result:"blur"},b),Blockly.createSvgElement("feOffset",{"in":"blur",dx:1,dy:1,result:"offsetBlur"},b),d=Blockly.createSvgElement("feMerge",{},b),Blockly.createSvgElement("feMergeNode",{"in":"offsetBlur"},d),Blockly.createSvgElement("feMergeNode",{"in":"SourceGraphic"},d),b=Blockly.createSvgElement("filter",{id:"blocklyShadowFilter"},g),Blockly.createSvgElement("feGaussianBlur",{stdDeviation:2},b),e=Blockly.createSvgElement("pattern",{id:"blocklyDisabledPattern",patternUnits:"userSpaceOnUse",width:10,height:10},g),Blockly.createSvgElement("rect",{width:10,height:10,fill:"#aaa"},e),Blockly.createSvgElement("path",{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},e),Blockly.mainWorkspace=new Blockly.Workspace(Blockly.getMainWorkspaceMetrics_,Blockly.setMainWorkspaceMetrics_),f.appendChild(Blockly.mainWorkspace.createDom()),Blockly.mainWorkspace.maxBlocks=Blockly.maxBlocks,!Blockly.readOnly){Blockly.mainWorkspace.flyout_=new Blockly.Flyout;var h=Blockly.mainWorkspace.flyout_,i=h.createDom();h.init(Blockly.mainWorkspace,!0),h.autoClose=!1,Ext.DomHelper.insertBefore(Blockly.mainWorkspace.svgGroup_,i);var j=function(){if(0==Blockly.Block.dragMode_){var a=Blockly.mainWorkspace.getMetrics();if(a.contentTop<0||a.contentTop+a.contentHeight>a.viewHeight+a.viewTop||a.contentLeft<(Blockly.RTL?a.viewLeft:0)||a.contentLeft+a.contentWidth>a.viewWidth+(Blockly.RTL?2:1)*a.viewLeft)for(var b,c=25,d=Blockly.mainWorkspace.getTopBlocks(!1),e=0;b=d[e];e++){var f=b.getRelativeToSurfaceXY(),g=b.getHeightWidth(),h=a.viewTop+c-g.height-f.y;h>0&&b.moveBy(0,h);var h=a.viewTop+a.viewHeight-c-f.y;0>h&&b.moveBy(0,h);var h=c+a.viewLeft-f.x-(Blockly.RTL?0:g.width);h>0&&b.moveBy(h,0);var h=a.viewLeft+a.viewWidth-c-f.x+(Blockly.RTL?g.width:0);0>h&&b.moveBy(h,0)}}};Blockly.addChangeListener(j)}f.appendChild(Blockly.Tooltip.createDom()),a.appendChild(f),Blockly.svg=f,Blockly.svgResize()},Blockly.init_=function(){if(Blockly.bindEvent_(Blockly.svg,"mousedown",null,Blockly.onMouseDown_),Blockly.bindEvent_(Blockly.svg,"mousemove",null,Blockly.onMouseMove_),Blockly.documentEventsBound_||(Blockly.bindEvent_(document,"keydown",null,Blockly.onKeyDown_),document.addEventListener("mouseup",Blockly.onMouseUp_,!1),Ext.is.Tablet&&Blockly.bindEvent_(window,"orientationchange",document,function(){Blockly.fireUiEvent(window,"resize")}),Blockly.documentEventsBound_=!0),Blockly.languageTree){Blockly.mainWorkspace.flyout_.init(Blockly.mainWorkspace,!0),Blockly.mainWorkspace.flyout_.show(Blockly.languageTree.childNodes),Blockly.mainWorkspace.scrollX=Blockly.mainWorkspace.flyout_.width_;var a="translate("+Blockly.mainWorkspace.scrollX+", 0)";Blockly.mainWorkspace.getCanvas().setAttribute("transform",a),Blockly.mainWorkspace.getBubbleCanvas().setAttribute("transform",a)}Blockly.hasScrollbars&&(Blockly.mainWorkspace.scrollbar=new Blockly.ScrollbarPair(Blockly.mainWorkspace),Blockly.mainWorkspace.scrollbar.resize()),Blockly.mainWorkspace.addTrashcan(),Blockly.loadAudio_(["media/click.mp3","media/click.wav","media/click.ogg"],"click"),Blockly.loadAudio_(["media/delete.mp3","media/delete.ogg","media/delete.wav"],"delete")},Blockly.Input=function(a,b,c,d){this.type=a,this.name=b,this.sourceBlock_=c,this.connection=d,this.fieldRow=[],this.align=Blockly.ALIGN_LEFT,this.visible_=!0},Blockly.Input.prototype.appendField=function(a,b){return a||b?(Ext.isString(a)&&(a=new Blockly.FieldLabel(a)),this.sourceBlock_.svg_&&a.init(this.sourceBlock_),a.name=b,a.prefixField&&this.appendField(a.prefixField),this.fieldRow.push(a),a.suffixField&&this.appendField(a.suffixField),this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours_()),this):this},Blockly.Input.prototype.appendTitle=function(a,b){return console.log("Deprecated call to appendTitle, use appendField instead."),this.appendField(a,b)},Blockly.Input.prototype.removeField=function(a){for(var b,c=0;b=this.fieldRow[c];c++)if(b.name===a)return b.dispose(),this.fieldRow.splice(c,1),void(this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours_()));console.log('Field "%s" not found.',a)},Blockly.Input.prototype.isVisible=function(){return this.visible_},Blockly.Input.prototype.setVisible=function(a){var b=[];if(this.visible_==a)return b;this.visible_=a;for(var c,d=a?"block":"none",e=0;c=this.fieldRow[e];e++)c.setVisible(a);if(this.connection){a?b=this.connection.unhideAll():this.connection.hideAll();var f=this.connection.targetBlock();f&&(f.svg_.getRootElement().style.display=d,a||(f.rendered=!1))}return b},Blockly.Input.prototype.setCheck=function(a){if(!this.connection)throw"This input does not have a connection.";return this.connection.setCheck(a),this},Blockly.Input.prototype.setAlign=function(a){return this.align=a,this.sourceBlock_.rendered&&this.sourceBlock_.render(),this},Blockly.Input.prototype.init=function(){for(var a=0;a<this.fieldRow.length;a++)this.fieldRow[a].init(this.sourceBlock_)},Blockly.Input.prototype.dispose=function(){for(var a,b=0;a=this.fieldRow[b];b++)a.dispose();this.connection&&this.connection.dispose(),this.sourceBlock_=null},Blockly.Msg={},Blockly.Mutator=function(a){Blockly.Mutator.superClass_.constructor.call(this,null),this.quarkXml_=[];for(var b=0;b<a.length;b++){var c=Ext.DomHelper.createDom({tag:"block",type:a[b]});this.quarkXml_[b]=c}},Blockly.inherits(Blockly.Mutator,Blockly.Icon),Blockly.Mutator.prototype.workspaceWidth_=0,Blockly.Mutator.prototype.workspaceHeight_=0,Blockly.Mutator.prototype.createIcon=function(){Blockly.Icon.prototype.createIcon_.call(this);{var a=Blockly.Icon.RADIUS/2;Blockly.createSvgElement("rect",{"class":"blocklyIconShield",width:4*a,height:4*a,rx:a,ry:a},this.iconGroup_)}this.iconMark_=Blockly.createSvgElement("text",{"class":"blocklyIconMark",x:Blockly.Icon.RADIUS,y:2*Blockly.Icon.RADIUS-4},this.iconGroup_),this.iconMark_.appendChild(document.createTextNode(""))},Blockly.Mutator.prototype.iconClick_=function(a){this.block_.isEditable()&&Blockly.Icon.prototype.iconClick_.call(this,a)},Blockly.Mutator.prototype.createEditor_=function(){this.svgDialog_=Blockly.createSvgElement("svg",{x:Blockly.Bubble.BORDER_WIDTH,y:Blockly.Bubble.BORDER_WIDTH},null),Blockly.createSvgElement("rect",{"class":"blocklyMutatorBackground",height:"100%",width:"100%"},this.svgDialog_);var a=this;return this.workspace_=new Blockly.Workspace(function(){return a.getFlyoutMetrics_()},null),this.flyout_=new Blockly.Flyout,this.flyout_.autoClose=!1,this.svgDialog_.appendChild(this.flyout_.createDom()),this.svgDialog_.appendChild(this.workspace_.createDom()),this.svgDialog_},Blockly.Mutator.prototype.updateEditable=function(){this.block_.isEditable()?Blockly.Icon.prototype.updateEditable.call(this):(this.setVisible(!1),Blockly.removeClass_(this.iconGroup_,"blocklyIconGroup"))},Blockly.Mutator.prototype.resizeBubble_=function(){var a,b=2*Blockly.Bubble.BORDER_WIDTH,c=this.workspace_.getCanvas().getBBox(),d=this.flyout_.getMetrics_();a=Blockly.RTL?-c.x:c.width+c.x;var e=Math.max(c.height+3*b,d.contentHeight+20);if(a+=3*b,(Math.abs(this.workspaceWidth_-a)>b||Math.abs(this.workspaceHeight_-e)>b)&&(this.workspaceWidth_=a,this.workspaceHeight_=e,this.bubble_.setBubbleSize(a+b,e+b),this.svgDialog_.setAttribute("width",this.workspaceWidth_),this.svgDialog_.setAttribute("height",this.workspaceHeight_)),Blockly.RTL){var f="translate("+this.workspaceWidth_+",0)";this.workspace_.getCanvas().setAttribute("transform",f)}},Blockly.Mutator.prototype.setVisible=function(a){if(a!=this.isVisible())if(a){this.bubble_=new Blockly.Bubble(this.block_.workspace,this.createEditor_(),this.block_.svg_.svgGroup_,this.iconX_,this.iconY_,null,null);var b=this;this.flyout_.init(this.workspace_,!1),this.flyout_.show(this.quarkXml_),this.rootBlock_=this.block_.decompose(this.workspace_);for(var c,d=this.rootBlock_.getDescendants(),e=0;c=d[e];e++)c.render();this.rootBlock_.setMovable(!1),this.rootBlock_.setDeletable(!1);var f=2*this.flyout_.CORNER_RADIUS,g=this.flyout_.width_+f;Blockly.RTL&&(g=-g),this.rootBlock_.moveBy(g,f),this.block_.saveConnections&&(this.block_.saveConnections(this.rootBlock_),this.sourceListener_=Blockly.bindEvent_(this.block_.workspace.getCanvas(),"blocklyWorkspaceChange",this.block_,function(){b.block_.saveConnections(b.rootBlock_)})),this.resizeBubble_(),Blockly.bindEvent_(this.workspace_.getCanvas(),"blocklyWorkspaceChange",this.block_,function(){b.workspaceChanged_()}),this.updateColour()}else this.svgDialog_=null,this.flyout_.dispose(),this.flyout_=null,this.workspace_.dispose(),this.workspace_=null,this.rootBlock_=null,this.bubble_.dispose(),this.bubble_=null,this.workspaceWidth_=0,this.workspaceHeight_=0,this.sourceListener_&&(Blockly.unbindEvent_(this.sourceListener_),this.sourceListener_=null)},Blockly.Mutator.prototype.workspaceChanged_=function(){if(0==Blockly.Block.dragMode_)for(var a,b=this.workspace_.getTopBlocks(!1),c=20,d=0;a=b[d];d++){var e=a.getRelativeToSurfaceXY(),f=a.getHeightWidth();(Blockly.RTL?e.x>-this.flyout_.width_+c:e.x<this.flyout_.width_-c)?a.dispose(!1,!0):e.y+f.height<c&&a.moveBy(0,c-f.height-e.y)}if(this.rootBlock_.workspace==this.workspace_){var g=this.block_.rendered;this.block_.rendered=!1,this.block_.compose(this.rootBlock_),this.block_.rendered=g,this.block_.rendered&&this.block_.render(),this.resizeBubble_(),this.block_.workspace.fireChangeEvent()}},Blockly.Mutator.prototype.getFlyoutMetrics_=function(){var a=0;return Blockly.RTL&&(a+=this.workspaceWidth_),{viewHeight:this.workspaceHeight_,viewWidth:0,absoluteTop:0,absoluteLeft:a}},Blockly.Mutator.prototype.dispose=function(){this.block_.mutator=null,Blockly.Icon.prototype.dispose.call(this)},Blockly.Names=function(a){if(this.reservedDict_=Object.create(null),a)for(var b=a.split(","),c=0;c<b.length;c++)this.reservedDict_[b[c]]=!0;this.reset()},Blockly.Names.prototype.reset=function(){this.db_=Object.create(null),this.dbReverse_=Object.create(null)},Blockly.Names.prototype.getName=function(a,b){var c=a.toLowerCase()+"_"+b;if(c in this.db_)return this.db_[c];var d=this.getDistinctName(a,b);return this.db_[c]=d,d},Blockly.Names.prototype.getDistinctName=function(a){for(var b=this.safeName_(a),c="";this.dbReverse_[b+c]||b+c in this.reservedDict_;)c=c?c+1:2;return b+=c,this.dbReverse_[b]=!0,b},Blockly.Names.prototype.safeName_=function(a){return a?(a=encodeURI(a.replace(/ /g,"_")).replace(/[^\w]/g,"_"),-1!="0123456789".indexOf(a[0])&&(a="my_"+a)):a="unnamed",a},Blockly.Names.equals=function(a,b){return null==a||null==b?!1:a.toLowerCase()==b.toLowerCase()},Blockly.Procedures={},Blockly.Procedures.NAME_TYPE="PROCEDURE",Blockly.Procedures.allProcedures=function(){for(var a=Blockly.mainWorkspace.getAllBlocks(),b=[],c=[],d=0;d<a.length;d++){var e=a[d].getProcedureDef;if(e){var f=e.call(a[d]);f&&(f[2]?b.push(f):c.push(f))}}return c.sort(Blockly.Procedures.procTupleComparator_),b.sort(Blockly.Procedures.procTupleComparator_),[c,b]},Blockly.Procedures.procTupleComparator_=function(a,b){var c=a[0].toLowerCase(),d=b[0].toLowerCase();return c>d?1:d>c?-1:0},Blockly.Procedures.findLegalName=function(a,b){if(b.isInFlyout)return a;for(;!Blockly.Procedures.isLegalName(a,b.workspace,b);){var c=a.match(/^(.*?)(\d+)$/);c?a=c[1]+(parseInt(c[2],10)+1):a+="2"}return a},Blockly.Procedures.isLegalName=function(a,b,c){for(var d=b.getAllBlocks(),e=0;e<d.length;e++)if(d[e]!=c){var f=d[e].getProcedureDef;if(f){var g=f.call(d[e]);if(Blockly.Names.equals(g[0],a))return!1}}return!0},Blockly.Procedures.rename=function(a){a=a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,""),a=Blockly.Procedures.findLegalName(a,this.sourceBlock_);for(var b=this.sourceBlock_.workspace.getAllBlocks(),c=0;c<b.length;c++){var d=b[c].renameProcedure;d&&d.call(b[c],this.text_,a)}return a},Blockly.Procedures.flyoutCategory=function(a,b,c,d){function e(e,f){for(var g=0;g<e.length;g++){var h=Blockly.Block.obtain(d,f);h.setFieldValue(e[g][0],"NAME");for(var i=[],j=0;j<e[g][1].length;j++)i[j]="ARG"+j;h.setProcedureParameters(e[g][1],i),h.initSvg(),a.push(h),b.push(2*c)}}if(Blockly.Blocks.procedures_defnoreturn){var f=Blockly.Block.obtain(d,"procedures_defnoreturn");f.initSvg(),a.push(f),b.push(2*c)}if(Blockly.Blocks.procedures_defreturn){var f=Blockly.Block.obtain(d,"procedures_defreturn");f.initSvg(),a.push(f),b.push(2*c)}if(Blockly.Blocks.procedures_ifreturn){var f=Blockly.Block.obtain(d,"procedures_ifreturn");f.initSvg(),a.push(f),b.push(2*c)}b.length&&(b[b.length-1]=3*c);var g=Blockly.Procedures.allProcedures();e(g[0],"procedures_callnoreturn"),e(g[1],"procedures_callreturn")},Blockly.Procedures.getCallers=function(a,b){for(var c=[],d=b.getAllBlocks(),e=0;e<d.length;e++){var f=d[e].getProcedureCall;if(f){var g=f.call(d[e]);g&&Blockly.Names.equals(g,a)&&c.push(d[e])}}return c},Blockly.Procedures.disposeCallers=function(a,b){for(var c=Blockly.Procedures.getCallers(a,b),d=0;d<c.length;d++)c[d].dispose(!0,!1)},Blockly.Procedures.mutateCallers=function(a,b,c,d){for(var e=Blockly.Procedures.getCallers(a,b),f=0;f<e.length;f++)e[f].setProcedureParameters(c,d)},Blockly.Procedures.getDefinition=function(a,b){for(var c=b.getAllBlocks(),d=0;d<c.length;d++){var e=c[d].getProcedureDef;if(e){var f=e.call(c[d]);if(f&&Blockly.Names.equals(f[0],a))return c[d]}}return null},Blockly.ScrollbarPair=function(a){this.workspace_=a,this.oldHostMetrics_=null,this.hScroll=new Blockly.Scrollbar(a,!0,!0),this.vScroll=new Blockly.Scrollbar(a,!1,!0),this.corner_=Blockly.createSvgElement("rect",{height:Blockly.Scrollbar.scrollbarThickness,width:Blockly.Scrollbar.scrollbarThickness,style:"fill: #fff"},null),Blockly.Scrollbar.insertAfter_(this.corner_,a.getBubbleCanvas())},Blockly.ScrollbarPair.prototype.dispose=function(){Blockly.unbindEvent_(this.onResizeWrapper_),this.onResizeWrapper_=null,Ext.removeNode(this.corner_),this.corner_=null,this.workspace_=null,this.oldHostMetrics_=null,this.hScroll.dispose(),this.hScroll=null,this.vScroll.dispose(),this.vScroll=null},Blockly.ScrollbarPair.prototype.resize=function(){var a=this.workspace_.getMetrics();if(a){var b=!1,c=!1;this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth==a.viewWidth&&this.oldHostMetrics_.viewHeight==a.viewHeight&&this.oldHostMetrics_.absoluteTop==a.absoluteTop&&this.oldHostMetrics_.absoluteLeft==a.absoluteLeft?(this.oldHostMetrics_&&this.oldHostMetrics_.contentWidth==a.contentWidth&&this.oldHostMetrics_.viewLeft==a.viewLeft&&this.oldHostMetrics_.contentLeft==a.contentLeft||(b=!0),this.oldHostMetrics_&&this.oldHostMetrics_.contentHeight==a.contentHeight&&this.oldHostMetrics_.viewTop==a.viewTop&&this.oldHostMetrics_.contentTop==a.contentTop||(c=!0)):(b=!0,c=!0),b&&this.hScroll.resize(a),c&&this.vScroll.resize(a),this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth==a.viewWidth&&this.oldHostMetrics_.absoluteLeft==a.absoluteLeft||this.corner_.setAttribute("x",this.vScroll.xCoordinate),this.oldHostMetrics_&&this.oldHostMetrics_.viewHeight==a.viewHeight&&this.oldHostMetrics_.absoluteTop==a.absoluteTop||this.corner_.setAttribute("y",this.hScroll.yCoordinate),this.oldHostMetrics_=a}},Blockly.ScrollbarPair.prototype.set=function(a,b){if(Blockly.Scrollbar===Blockly.ScrollbarNative){this.hScroll.set(a,!1),this.vScroll.set(b,!1);var c={};c.x=this.hScroll.outerDiv_.scrollLeft/this.hScroll.innerImg_.offsetWidth||0,c.y=this.vScroll.outerDiv_.scrollTop/this.vScroll.innerImg_.offsetHeight||0,this.workspace_.setMetrics(c)}else this.hScroll.set(a,!0),this.vScroll.set(b,!0)},Blockly.Scrollbar=function(a,b,c){this.workspace_=a,this.pair_=c||!1,this.horizontal_=b,this.createDom_(),b?(this.svgBackground_.setAttribute("height",Blockly.Scrollbar.scrollbarThickness),this.svgKnob_.setAttribute("height",Blockly.Scrollbar.scrollbarThickness-6),this.svgKnob_.setAttribute("y",3)):(this.svgBackground_.setAttribute("width",Blockly.Scrollbar.scrollbarThickness),this.svgKnob_.setAttribute("width",Blockly.Scrollbar.scrollbarThickness-6),this.svgKnob_.setAttribute("x",3));var d=this;this.onMouseDownBarWrapper_=Blockly.bindEvent_(this.svgBackground_,"mousedown",d,d.onMouseDownBar_),this.onMouseDownKnobWrapper_=Blockly.bindEvent_(this.svgKnob_,"mousedown",d,d.onMouseDownKnob_)},Blockly.Scrollbar.scrollbarThickness=15,Blockly.Scrollbar.prototype.dispose=function(){this.onMouseUpKnob_(),this.onResizeWrapper_&&(Blockly.unbindEvent_(this.onResizeWrapper_),this.onResizeWrapper_=null),Blockly.unbindEvent_(this.onMouseDownBarWrapper_),this.onMouseDownBarWrapper_=null,Blockly.unbindEvent_(this.onMouseDownKnobWrapper_),this.onMouseDownKnobWrapper_=null,Ext.removeNode(this.svgGroup_),this.svgGroup_=null,this.svgBackground_=null,this.svgKnob_=null,this.workspace_=null},Blockly.Scrollbar.prototype.resize=function(a){var b=a;if(b||(b=this.workspace_.getMetrics())){if(this.horizontal_){var c=b.viewWidth;this.pair_?c-=Blockly.Scrollbar.scrollbarThickness:this.setVisible(c<b.contentHeight),this.ratio_=c/b.contentWidth,(this.ratio_===-1/0||1/0===this.ratio_||isNaN(this.ratio_))&&(this.ratio_=0);var d=b.viewWidth*this.ratio_,e=(b.viewLeft-b.contentLeft)*this.ratio_;this.svgKnob_.setAttribute("width",Math.max(0,d)),this.xCoordinate=b.absoluteLeft,this.pair_&&Blockly.RTL&&(this.xCoordinate+=b.absoluteLeft+Blockly.Scrollbar.scrollbarThickness),this.yCoordinate=b.absoluteTop+b.viewHeight-Blockly.Scrollbar.scrollbarThickness,this.svgGroup_.setAttribute("transform","translate("+this.xCoordinate+", "+this.yCoordinate+")"),this.svgBackground_.setAttribute("width",Math.max(0,c)),this.svgKnob_.setAttribute("x",this.constrainKnob_(e))}else{var c=b.viewHeight;this.pair_?c-=Blockly.Scrollbar.scrollbarThickness:this.setVisible(c<b.contentHeight),this.ratio_=c/b.contentHeight,(this.ratio_===-1/0||1/0===this.ratio_||isNaN(this.ratio_))&&(this.ratio_=0);var d=b.viewHeight*this.ratio_,e=(b.viewTop-b.contentTop)*this.ratio_;this.svgKnob_.setAttribute("height",Math.max(0,d)),this.xCoordinate=b.absoluteLeft,Blockly.RTL||(this.xCoordinate+=b.viewWidth-Blockly.Scrollbar.scrollbarThickness),this.yCoordinate=b.absoluteTop,this.svgGroup_.setAttribute("transform","translate("+this.xCoordinate+", "+this.yCoordinate+")"),this.svgBackground_.setAttribute("height",Math.max(0,c)),this.svgKnob_.setAttribute("y",this.constrainKnob_(e))}this.onScroll_()}},Blockly.Scrollbar.prototype.createDom_=function(){this.svgGroup_=Blockly.createSvgElement("g",{},null),this.svgBackground_=Blockly.createSvgElement("rect",{"class":"blocklyScrollbarBackground"},this.svgGroup_);var a=Math.floor((Blockly.Scrollbar.scrollbarThickness-6)/2);this.svgKnob_=Blockly.createSvgElement("rect",{"class":"blocklyScrollbarKnob",rx:a,ry:a},this.svgGroup_),Blockly.Scrollbar.insertAfter_(this.svgGroup_,this.workspace_.getBubbleCanvas())},Blockly.Scrollbar.prototype.isVisible=function(){return"none"!=this.svgGroup_.getAttribute("display")},Blockly.Scrollbar.prototype.setVisible=function(a){if(a!=this.isVisible()){if(this.pair_)throw"Unable to toggle visibility of paired scrollbars.";a?this.svgGroup_.setAttribute("display","block"):(this.workspace_.setMetrics({x:0,y:0}),this.svgGroup_.setAttribute("display","none"))}},Blockly.Scrollbar.prototype.onMouseDownBar_=function(a){if(this.onMouseUpKnob_(),Blockly.isRightButton(a))return void a.stopPropagation();var b=Blockly.mouseToSvg(a),c=this.horizontal_?b.x:b.y,d=Blockly.getSvgXY_(this.svgKnob_),e=this.horizontal_?d.x:d.y,f=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"width":"height")),g=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"x":"y")),h=.95*f;e>=c?g-=h:c>=e+f&&(g+=h),this.svgKnob_.setAttribute(this.horizontal_?"x":"y",this.constrainKnob_(g)),this.onScroll_(),a.stopPropagation()},Blockly.Scrollbar.prototype.onMouseDownKnob_=function(a){return this.onMouseUpKnob_(),Blockly.isRightButton(a)?void a.stopPropagation():(this.startDragKnob=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"x":"y")),this.startDragMouse=this.horizontal_?a.clientX:a.clientY,Blockly.Scrollbar.onMouseUpWrapper_=Blockly.bindEvent_(document,"mouseup",this,this.onMouseUpKnob_),Blockly.Scrollbar.onMouseMoveWrapper_=Blockly.bindEvent_(document,"mousemove",this,this.onMouseMoveKnob_),void a.stopPropagation())
},Blockly.Scrollbar.prototype.onMouseMoveKnob_=function(a){var b=this.horizontal_?a.clientX:a.clientY,c=b-this.startDragMouse,d=this.startDragKnob+c;this.svgKnob_.setAttribute(this.horizontal_?"x":"y",this.constrainKnob_(d)),this.onScroll_()},Blockly.Scrollbar.prototype.onMouseUpKnob_=function(){Blockly.removeAllRanges(),Blockly.hideChaff(!0),Blockly.Scrollbar.onMouseUpWrapper_&&(Blockly.unbindEvent_(Blockly.Scrollbar.onMouseUpWrapper_),Blockly.Scrollbar.onMouseUpWrapper_=null),Blockly.Scrollbar.onMouseMoveWrapper_&&(Blockly.unbindEvent_(Blockly.Scrollbar.onMouseMoveWrapper_),Blockly.Scrollbar.onMouseMoveWrapper_=null)},Blockly.Scrollbar.prototype.constrainKnob_=function(a){if(0>=a||isNaN(a))a=0;else{var b=this.horizontal_?"width":"height",c=parseFloat(this.svgBackground_.getAttribute(b)),d=parseFloat(this.svgKnob_.getAttribute(b));a=Math.min(a,c-d)}return a},Blockly.Scrollbar.prototype.onScroll_=function(){var a=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"x":"y")),b=parseFloat(this.svgBackground_.getAttribute(this.horizontal_?"width":"height")),c=a/b;isNaN(c)&&(c=0);var d={};this.horizontal_?d.x=c:d.y=c,this.workspace_.setMetrics(d)},Blockly.Scrollbar.prototype.set=function(a,b){this.svgKnob_.setAttribute(this.horizontal_?"x":"y",a*this.ratio_),b&&this.onScroll_()},Blockly.Scrollbar.insertAfter_=function(a,b){var c=b.nextSibling,d=b.parentNode;if(!d)throw"Reference node has no parent.";c?d.insertBefore(a,c):d.appendChild(a)},Blockly.Tooltip={},Blockly.Tooltip.visible=!1,Blockly.Tooltip.LIMIT=50,Blockly.Tooltip.mouseOutPid_=0,Blockly.Tooltip.showPid_=0,Blockly.Tooltip.lastXY_={x:0,y:0},Blockly.Tooltip.element_=null,Blockly.Tooltip.poisonedElement_=null,Blockly.Tooltip.svgGroup_=null,Blockly.Tooltip.svgText_=null,Blockly.Tooltip.svgBackground_=null,Blockly.Tooltip.svgShadow_=null,Blockly.Tooltip.OFFSET_X=0,Blockly.Tooltip.OFFSET_Y=10,Blockly.Tooltip.RADIUS_OK=10,Blockly.Tooltip.HOVER_MS=1e3,Blockly.Tooltip.MARGINS=5,Blockly.Tooltip.createDom=function(){var a=Blockly.createSvgElement("g",{"class":"blocklyHidden"},null);return Blockly.Tooltip.svgGroup_=a,Blockly.Tooltip.svgShadow_=Blockly.createSvgElement("rect",{"class":"blocklyTooltipShadow",x:2,y:2},a),Blockly.Tooltip.svgBackground_=Blockly.createSvgElement("rect",{"class":"blocklyTooltipBackground"},a),Blockly.Tooltip.svgText_=Blockly.createSvgElement("text",{"class":"blocklyTooltipText"},a),a},Blockly.Tooltip.bindMouseEvents=function(a){Blockly.bindEvent_(a,"mouseover",null,Blockly.Tooltip.onMouseOver_),Blockly.bindEvent_(a,"mouseout",null,Blockly.Tooltip.onMouseOut_),Blockly.bindEvent_(a,"mousemove",null,Blockly.Tooltip.onMouseMove_)},Blockly.Tooltip.onMouseOver_=function(a){for(var b=a.target;!Ext.isString(b.tooltip)&&!Ext.isFunction(b.tooltip);)b=b.tooltip;Blockly.Tooltip.element_!=b&&(Blockly.Tooltip.hide(),Blockly.Tooltip.poisonedElement_=null,Blockly.Tooltip.element_=b),window.clearTimeout(Blockly.Tooltip.mouseOutPid_)},Blockly.Tooltip.onMouseOut_=function(){Blockly.Tooltip.mouseOutPid_=window.setTimeout(function(){Blockly.Tooltip.element_=null,Blockly.Tooltip.poisonedElement_=null,Blockly.Tooltip.hide()},1),window.clearTimeout(Blockly.Tooltip.showPid_)},Blockly.Tooltip.onMouseMove_=function(a){if(Blockly.Tooltip.element_&&Blockly.Tooltip.element_.tooltip&&0==Blockly.Block.dragMode_&&!Blockly.WidgetDiv.isVisible())if(Blockly.Tooltip.visible){var b=Blockly.mouseToSvg(a),c=Blockly.Tooltip.lastXY_.x-b.x,d=Blockly.Tooltip.lastXY_.y-b.y,e=Math.sqrt(Math.pow(c,2)+Math.pow(d,2));e>Blockly.Tooltip.RADIUS_OK&&Blockly.Tooltip.hide()}else Blockly.Tooltip.poisonedElement_!=Blockly.Tooltip.element_&&(window.clearTimeout(Blockly.Tooltip.showPid_),Blockly.Tooltip.lastXY_=Blockly.mouseToSvg(a),Blockly.Tooltip.showPid_=window.setTimeout(Blockly.Tooltip.show_,Blockly.Tooltip.HOVER_MS))},Blockly.Tooltip.hide=function(){Blockly.Tooltip.visible&&(Blockly.Tooltip.visible=!1,Blockly.Tooltip.svgGroup_&&(Blockly.Tooltip.svgGroup_.style.display="none")),window.clearTimeout(Blockly.Tooltip.showPid_)},Blockly.Tooltip.show_=function(){if(Blockly.Tooltip.poisonedElement_=Blockly.Tooltip.element_,Blockly.Tooltip.svgGroup_){Blockly.removeChildren(Blockly.Tooltip.svgText_);var a=Blockly.Tooltip.element_.tooltip;Ext.isFunction(a)&&(a=a()),a=Blockly.Tooltip.wrap_(a,Blockly.Tooltip.LIMIT);for(var b=a.split("\n"),c=0;c<b.length;c++){var d=Blockly.createSvgElement("tspan",{dy:"1em",x:Blockly.Tooltip.MARGINS},Blockly.Tooltip.svgText_),e=document.createTextNode(b[c]);d.appendChild(e)}Blockly.Tooltip.visible=!0,Blockly.Tooltip.svgGroup_.style.display="block";var f=Blockly.Tooltip.svgText_.getBBox(),g=2*Blockly.Tooltip.MARGINS+f.width,h=f.height;if(Blockly.Tooltip.svgBackground_.setAttribute("width",g),Blockly.Tooltip.svgBackground_.setAttribute("height",h),Blockly.Tooltip.svgShadow_.setAttribute("width",g),Blockly.Tooltip.svgShadow_.setAttribute("height",h),Blockly.RTL)for(var i,j=f.width,k=0;i=Blockly.Tooltip.svgText_.childNodes[k];k++)i.setAttribute("text-anchor","end"),i.setAttribute("x",j+Blockly.Tooltip.MARGINS);var l=Blockly.Tooltip.lastXY_.x;Blockly.RTL?l-=Blockly.Tooltip.OFFSET_X+g:l+=Blockly.Tooltip.OFFSET_X;var m=Blockly.Tooltip.lastXY_.y+Blockly.Tooltip.OFFSET_Y,n=Blockly.svgSize();m+f.height>n.height&&(m-=f.height+2*Blockly.Tooltip.OFFSET_Y),Blockly.RTL?l=Math.max(Blockly.Tooltip.MARGINS,l):l+f.width>n.width-2*Blockly.Tooltip.MARGINS&&(l=n.width-f.width-2*Blockly.Tooltip.MARGINS),Blockly.Tooltip.svgGroup_.setAttribute("transform","translate("+l+","+m+")")}},Blockly.Tooltip.wrap_=function(a,b){if(a.length<=b)return a;for(var c=a.trim().split(/\s+/),d=0;d<c.length;d++)c[d].length>b&&(b=c[d].length);var e,f,g=-1/0,h=1;do{e=g,f=a;for(var i=[],j=c.length/h,k=1,d=0;d<c.length-1;d++)(d+1.5)/j>k?(k++,i[d]=!0):i[d]=!1;i=Blockly.Tooltip.wrapMutate_(c,i,b),g=Blockly.Tooltip.wrapScore_(c,i,b),a=Blockly.Tooltip.wrapToText_(c,i),h++}while(g>e);return f},Blockly.Tooltip.wrapScore_=function(a,b,c){for(var d=[0],e=[],f=0;f<a.length;f++)d[d.length-1]+=a[f].length,b[f]===!0?(d.push(0),e.push(a[f].charAt(a[f].length-1))):b[f]===!1&&d[d.length-1]++;for(var g=Math.max.apply(Math,d),h=0,f=0;f<d.length;f++)h-=2*Math.pow(Math.abs(c-d[f]),1.5),h-=Math.pow(g-d[f],1.5),-1!=".?!".indexOf(e[f])?h+=c/3:-1!=",;)]}".indexOf(e[f])&&(h+=c/4);return d.length>1&&d[d.length-1]<=d[d.length-2]&&(h+=.5),h},Blockly.Tooltip.wrapMutate_=function(a,b,c){for(var d,e=Blockly.Tooltip.wrapScore_(a,b,c),f=0;f<b.length-1;f++)if(b[f]!=b[f+1]){var g=[].concat(b);g[f]=!g[f],g[f+1]=!g[f+1];var h=Blockly.Tooltip.wrapScore_(a,g,c);h>e&&(e=h,d=g)}return d?Blockly.Tooltip.wrapMutate_(a,d,c):b},Blockly.Tooltip.wrapToText_=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]),void 0!==b[d]&&c.push(b[d]?"\n":" ");return c.join("")},Blockly.Trashcan=function(a){this.workspace_=a},Blockly.Trashcan.prototype.BODY_URL_="media/trashbody.png",Blockly.Trashcan.prototype.LID_URL_="media/trashlid.png",Blockly.Trashcan.prototype.WIDTH_=47,Blockly.Trashcan.prototype.BODY_HEIGHT_=45,Blockly.Trashcan.prototype.LID_HEIGHT_=15,Blockly.Trashcan.prototype.MARGIN_BOTTOM_=35,Blockly.Trashcan.prototype.MARGIN_SIDE_=35,Blockly.Trashcan.prototype.MARGIN_HOTSPOT_=25,Blockly.Trashcan.prototype.isOpen=!1,Blockly.Trashcan.prototype.svgGroup_=null,Blockly.Trashcan.prototype.svgBody_=null,Blockly.Trashcan.prototype.svgLid_=null,Blockly.Trashcan.prototype.lidTask_=0,Blockly.Trashcan.prototype.lidAngle_=0,Blockly.Trashcan.prototype.left_=0,Blockly.Trashcan.prototype.top_=0,Blockly.Trashcan.prototype.createDom=function(){return this.svgGroup_=Blockly.createSvgElement("g",{filter:"url(#blocklyTrashcanShadowFilter)"},null),this.svgBody_=Blockly.createSvgElement("image",{width:this.WIDTH_,height:this.BODY_HEIGHT_},this.svgGroup_),this.svgBody_.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",Blockly.pathToBlockly+this.BODY_URL_),this.svgBody_.setAttribute("y",this.LID_HEIGHT_),this.svgLid_=Blockly.createSvgElement("image",{width:this.WIDTH_,height:this.LID_HEIGHT_},this.svgGroup_),this.svgLid_.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",Blockly.pathToBlockly+this.LID_URL_),this.svgGroup_},Blockly.Trashcan.prototype.init=function(){this.setOpen_(!1),this.position_()},Blockly.Trashcan.prototype.dispose=function(){this.svgGroup_&&(Ext.removeNode(this.svgGroup_),this.svgGroup_=null),this.svgBody_=null,this.svgLid_=null,this.workspace_=null,0!=this.lidTask_&&(this.lidTask_.cancel(),this.lidTask_=0)},Blockly.Trashcan.prototype.position_=function(){var a=this.workspace_.getMetrics();a&&(this.left_=Blockly.RTL?this.MARGIN_SIDE_:a.viewWidth+a.absoluteLeft-this.WIDTH_-this.MARGIN_SIDE_,this.top_=a.viewHeight+a.absoluteTop-(this.BODY_HEIGHT_+this.LID_HEIGHT_)-this.MARGIN_BOTTOM_,this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")"))},Blockly.Trashcan.prototype.onMouseMove=function(a){if(this.svgGroup_){var b=Blockly.mouseToSvg(a),c=Blockly.getSvgXY_(this.svgGroup_),d=b.x>c.x-this.MARGIN_HOTSPOT_&&b.x<c.x+this.WIDTH_+this.MARGIN_HOTSPOT_&&b.y>c.y-this.MARGIN_HOTSPOT_&&b.y<c.y+this.BODY_HEIGHT_+this.LID_HEIGHT_+this.MARGIN_HOTSPOT_;this.isOpen!=d&&this.setOpen_(d)}},Blockly.Trashcan.prototype.setOpen_=function(a){this.isOpen!=a&&(0!=this.lidTask_&&(this.lidTask_.cancel(),this.lidTask_=0),this.isOpen=a,this.animateLid_())},Blockly.Trashcan.prototype.animateLid_=function(){this.lidAngle_+=this.isOpen?10:-10,this.lidAngle_=Math.max(0,this.lidAngle_),this.svgLid_.setAttribute("transform","rotate("+(Blockly.RTL?-this.lidAngle_:this.lidAngle_)+", "+(Blockly.RTL?4:this.WIDTH_-4)+", "+(this.LID_HEIGHT_-2)+")"),(this.isOpen?this.lidAngle_<45:this.lidAngle_>0)&&(this.lidTask_=new Ext.util.DelayedTask(this.animateLid_,this),this.lidTask_.delay(5))},Blockly.Trashcan.prototype.close=function(){this.setOpen_(!1)},Blockly.addClass_=function(a,b){var c=a.getAttribute("class")||"";-1==(" "+c+" ").indexOf(" "+b+" ")&&(c&&(c+=" "),a.setAttribute("class",c+b))},Blockly.removeClass_=function(a,b){var c=a.getAttribute("class");if(-1!=(" "+c+" ").indexOf(" "+b+" ")){for(var d=c.split(/\s+/),e=0;e<d.length;e++)d[e]&&d[e]!=b||(d.splice(e,1),e--);d.length?a.setAttribute("class",d.join(" ")):a.removeAttribute("class")}},Blockly.bindEvent_=function(a,b,c,d){var e=function(){d.apply(c,arguments)};a.addEventListener(b,e,!1);var f=[[a,b,e]];return b in Blockly.bindEvent_.TOUCH_MAP&&(e=function(a){if(1==a.changedTouches.length){var b=a.changedTouches[0];a.clientX=b.clientX,a.clientY=b.clientY}d.apply(c,arguments),a.preventDefault()},a.addEventListener(Blockly.bindEvent_.TOUCH_MAP[b],e,!1),f.push([a,Blockly.bindEvent_.TOUCH_MAP[b],e])),f},Blockly.bindEvent_.TOUCH_MAP={},"ontouchstart"in document.documentElement&&(Blockly.bindEvent_.TOUCH_MAP={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"}),Blockly.unbindEvent_=function(a){for(;a.length;){var b=a.pop(),c=b[0],d=b[1],e=b[2];c.removeEventListener(d,e,!1)}return e},Blockly.fireUiEventNow=function(a,b){var c=document;if(c.createEvent){var d=c.createEvent("UIEvents");d.initEvent(b,!0,!0),a.dispatchEvent(d)}else{if(!c.createEventObject)throw"FireEvent: No event creation mechanism.";var d=c.createEventObject();a.fireEvent("on"+b,d)}},Blockly.fireUiEvent=function(a,b){var c=function(){Blockly.fireUiEventNow(a,b)};setTimeout(c,0)},Blockly.noEvent=function(a){a.preventDefault(),a.stopPropagation()},Blockly.getRelativeXY_=function(a){var b={x:0,y:0},c=a.getAttribute("x");c&&(b.x=parseInt(c,10));var d=a.getAttribute("y");d&&(b.y=parseInt(d,10));var e=a.getAttribute("transform"),f=e&&e.match(/translate\(\s*([-\d.]+)([ ,]\s*([-\d.]+)\s*\))?/);return f&&(b.x+=parseInt(f[1],10),f[3]&&(b.y+=parseInt(f[3],10))),b},Blockly.getSvgXY_=function(a){var b=0,c=0;do{var d=Blockly.getRelativeXY_(a);b+=d.x,c+=d.y,a=a.parentNode}while(a&&a!=Blockly.svg);return{x:b,y:c}},Blockly.getAbsoluteXY_=function(a){var b=Blockly.getSvgXY_(a);return Blockly.convertCoordinates(b.x,b.y,!1)},Blockly.createSvgElement=function(a,b,c){var d=document.createElementNS(Blockly.SVG_NS,a);for(var e in b)d.setAttribute(e,b[e]);return document.body.runtimeStyle&&(d.runtimeStyle=d.currentStyle=d.style),c&&c.appendChild(d),d},Blockly.isRightButton=function(a){return 2==a.button||a.ctrlKey},Blockly.convertCoordinates=function(a,b,c){c&&(a-=window.scrollX||window.pageXOffset,b-=window.scrollY||window.pageYOffset);var d=Blockly.svg.createSVGPoint();d.x=a,d.y=b;var e=Blockly.svg.getScreenCTM();c&&(e=e.inverse());var f=d.matrixTransform(e);return c||(f.x+=window.scrollX||window.pageXOffset,f.y+=window.scrollY||window.pageYOffset),f},Blockly.mouseToSvg=function(a){var b=window.scrollX||window.pageXOffset,c=window.scrollY||window.pageYOffset;return Blockly.convertCoordinates(a.clientX+b,a.clientY+c,!0)},Blockly.shortestStringLength=function(a){if(!a.length)return 0;for(var b=a[0].length,c=1;c<a.length;c++)b=Math.min(b,a[c].length);return b},Blockly.commonWordPrefix=function(a,b){if(!a.length)return 0;if(1==a.length)return a[0].length;for(var c=0,d=b||Blockly.shortestStringLength(a),e=0;d>e;e++){for(var f=a[0][e],g=1;g<a.length;g++)if(f!=a[g][e])return c;" "==f&&(c=e+1)}for(var g=1;g<a.length;g++){var f=a[g][e];if(f&&" "!=f)return c}return d},Blockly.commonWordSuffix=function(a,b){if(!a.length)return 0;if(1==a.length)return a[0].length;for(var c=0,d=b||Blockly.shortestStringLength(a),e=0;d>e;e++){for(var f=a[0].substr(-e-1,1),g=1;g<a.length;g++)if(f!=a[g].substr(-e-1,1))return c;" "==f&&(c=e+1)}for(var g=1;g<a.length;g++){var f=a[g].charAt(a[g].length-e-1);if(f&&" "!=f)return c}return d},Blockly.isNumber=function(a){return!!a.match(/^\s*-?\d+(\.\d+)?\s*$/)},Blockly.Variables={},Blockly.Variables.NAME_TYPE="VARIABLE",Blockly.Variables.allVariables=function(a,b){var c;c=b?b.getDescendants():Blockly.mainWorkspace.getAllBlocks();for(var d=Object.create(null),e=0;e<c.length;e++){var f=c[e].getVars;if(f)for(var g=f.call(c[e],a),h=0;h<g.length;h++){var i=g[h];i&&(d[i.toLowerCase()]=i)}}var j=[];for(var k in d)j.push(d[k]);return j},Blockly.Variables.renameVariable=function(a,b,c){for(var d=Blockly.mainWorkspace.getAllBlocks(),e=0;e<d.length;e++){var f=d[e].renameVar;f&&f.call(d[e],a,b,c)}},Blockly.Variables.flyoutCategory=function(a,b,c,d){var e=Blockly.Variables.allVariables(this.name);e.sort(Blockly.caseInsensitiveCompare),e.unshift(null);for(var f=void 0,g=0;g<e.length;g++)if(e[g]!==f){var h=Blockly.Blocks.variables_get?Blockly.Block.obtain(d,"variables_get"):null;h&&h.initSvg();var i=Blockly.Blocks.variables_set?Blockly.Block.obtain(d,"variables_set"):null;i&&i.initSvg(),null===e[g]?f=(h||i).getVars()[0]:(h&&h.setFieldValue(e[g],"VAR"),i&&i.setFieldValue(e[g],"VAR")),i&&a.push(i),h&&a.push(h),h&&i?b.push(c,3*c):b.push(2*c)}},Blockly.Variables.generateUniqueName=function(){var a=Blockly.Variables.allVariables(this.name),b="";if(a.length){a.sort(Blockly.caseInsensitiveCompare);for(var c=0,d="i",e=0,f=!1;!b;){for(e=0,f=!1;e<a.length&&!f;)a[e].toLowerCase()==d&&(f=!0),e++;f?("z"===d[0]?(c++,d="a"):(d=String.fromCharCode(d.charCodeAt(0)+1),"l"==d[0]&&(d=String.fromCharCode(d.charCodeAt(0)+1))),c>0&&(d+=c)):b=d}}else b="i";return b},Blockly.Warning=function(a){Blockly.Warning.superClass_.constructor.call(this,a),this.createIcon_()},Blockly.inherits(Blockly.Warning,Blockly.Icon),Blockly.Warning.prototype.text_="",Blockly.Warning.prototype.createIcon_=function(){Blockly.Icon.prototype.createIcon_.call(this);Blockly.createSvgElement("path",{"class":"blocklyIconShield",d:"M 2,15 Q -1,15 0.5,12 L 6.5,1.7 Q 8,-1 9.5,1.7 L 15.5,12 Q 17,15 14,15 z"},this.iconGroup_);this.iconMark_=Blockly.createSvgElement("text",{"class":"blocklyIconMark",x:Blockly.Icon.RADIUS,y:2*Blockly.Icon.RADIUS-3},this.iconGroup_),this.iconMark_.appendChild(document.createTextNode("!"))},Blockly.Warning.prototype.textToDom_=function(a){for(var b=Blockly.createSvgElement("text",{"class":"blocklyText",y:Blockly.Bubble.BORDER_WIDTH},null),c=a.split("\n"),d=0;d<c.length;d++){var e=Blockly.createSvgElement("tspan",{dy:"1em",x:Blockly.Bubble.BORDER_WIDTH},b),f=document.createTextNode(c[d]);e.appendChild(f)}return b},Blockly.Warning.prototype.setVisible=function(a){if(a!=this.isVisible())if(a){var b=this.textToDom_(this.text_);if(this.bubble_=new Blockly.Bubble(this.block_.workspace,b,this.block_.svg_.svgGroup_,this.iconX_,this.iconY_,null,null),Blockly.RTL)for(var c,d=b.getBBox().width,e=0;c=b.childNodes[e];e++)c.setAttribute("text-anchor","end"),c.setAttribute("x",d+Blockly.Bubble.BORDER_WIDTH);this.updateColour();var f=this.bubble_.getBubbleSize();this.bubble_.setBubbleSize(f.width,f.height)}else this.bubble_.dispose(),this.bubble_=null,this.body_=null,this.foreignObject_=null},Blockly.Warning.prototype.bodyFocus_=function(){this.bubble_.promote_()},Blockly.Warning.prototype.setText=function(a){this.text_=a,this.isVisible()&&(this.setVisible(!1),this.setVisible(!0))},Blockly.Warning.prototype.dispose=function(){this.block_.warning=null,Blockly.Icon.prototype.dispose.call(this)},Blockly.WidgetDiv={},Blockly.WidgetDiv.DIV=null,Blockly.WidgetDiv.owner_=null,Blockly.WidgetDiv.dispose_=null,Blockly.WidgetDiv.show=function(a,b){Blockly.WidgetDiv.hide(),Blockly.WidgetDiv.owner_=a,Blockly.WidgetDiv.dispose_=b},Blockly.WidgetDiv.hide=function(){Blockly.WidgetDiv.owner_&&(Blockly.WidgetDiv.dispose_&&Blockly.WidgetDiv.dispose_(),Blockly.WidgetDiv.owner_=null,Blockly.WidgetDiv.dispose_=null)},Blockly.WidgetDiv.isVisible=function(){return!!Blockly.WidgetDiv.owner_},Blockly.WidgetDiv.hideIfOwner=function(a){Blockly.WidgetDiv.owner_==a&&Blockly.WidgetDiv.hide()},Blockly.WidgetDiv.position=function(a,b,c,d){b<d.y&&(b=d.y),Blockly.RTL?a>c.width+d.x&&(a=c.width+d.x):a<d.x&&(a=d.x),Blockly.WidgetDiv.DIV.style.left=a+"px",Blockly.WidgetDiv.DIV.style.top=b+"px"},Blockly.Workspace=function(a,b){this.getMetrics=a,this.setMetrics=b,this.isFlyout=!1,this.topBlocks_=[],this.maxBlocks=1/0,Blockly.ConnectionDB.init(this)},Blockly.Workspace.SCAN_ANGLE=3,Blockly.Workspace.prototype.dragMode=!1,Blockly.Workspace.prototype.scrollX=0,Blockly.Workspace.prototype.scrollY=0,Blockly.Workspace.prototype.trashcan=null,Blockly.Workspace.prototype.fireChangeEventPid_=null,Blockly.Workspace.prototype.scrollbar=null,Blockly.Workspace.prototype.createDom=function(){return this.svgGroup_=Blockly.createSvgElement("g",{},null),this.svgBlockCanvas_=Blockly.createSvgElement("g",{},this.svgGroup_),this.svgBubbleCanvas_=Blockly.createSvgElement("g",{},this.svgGroup_),this.fireChangeEvent(),this.svgGroup_},Blockly.Workspace.prototype.dispose=function(){this.svgGroup_&&(Ext.removeNode(this.svgGroup_),this.svgGroup_=null),this.svgBlockCanvas_=null,this.svgBubbleCanvas_=null,this.trashcan&&(this.trashcan.dispose(),this.trashcan=null)},Blockly.Workspace.prototype.addTrashcan=function(){if(Blockly.hasTrashcan&&!Blockly.readOnly){this.trashcan=new Blockly.Trashcan(this);var a=this.trashcan.createDom();this.svgGroup_.insertBefore(a,this.svgBlockCanvas_),this.trashcan.init()}},Blockly.Workspace.prototype.getCanvas=function(){return this.svgBlockCanvas_},Blockly.Workspace.prototype.getBubbleCanvas=function(){return this.svgBubbleCanvas_},Blockly.Workspace.prototype.addTopBlock=function(a){this.topBlocks_.push(a),this.fireChangeEvent()},Blockly.Workspace.prototype.removeTopBlock=function(a){for(var b,c=!1,d=0;b=this.topBlocks_[d];d++)if(b==a){this.topBlocks_.splice(d,1),c=!0;break}if(!c)throw"Block not present in workspace's list of top-most blocks.";this.fireChangeEvent()},Blockly.Workspace.prototype.getTopBlocks=function(a){var b=[].concat(this.topBlocks_);if(a&&b.length>1){var c=Math.sin(Blockly.Workspace.SCAN_ANGLE/180*Math.PI);Blockly.RTL&&(c*=-1),b.sort(function(a,b){var d=a.getRelativeToSurfaceXY(),e=b.getRelativeToSurfaceXY();return d.y+c*d.x-(e.y+c*e.x)})}return b},Blockly.Workspace.prototype.getAllBlocks=function(){for(var a=this.getTopBlocks(!1),b=0;b<a.length;b++)a=a.concat(a[b].getChildren());return a},Blockly.Workspace.prototype.clear=function(){for(Blockly.hideChaff();this.topBlocks_.length;)this.topBlocks_[0].dispose()},Blockly.Workspace.prototype.render=function(){for(var a,b=this.getAllBlocks(),c=0;a=b[c];c++)a.getChildren().length||a.render()},Blockly.Workspace.prototype.getBlockById=function(a){for(var b,c=this.getAllBlocks(),d=0;b=c[d];d++)if(b.id==a)return b;return null},Blockly.Workspace.prototype.traceOn=function(a){this.traceOn_=a,this.traceWrapper_&&(Blockly.unbindEvent_(this.traceWrapper_),this.traceWrapper_=null),a&&(this.traceWrapper_=Blockly.bindEvent_(this.svgBlockCanvas_,"blocklySelectChange",this,function(){this.traceOn_=!1}))},Blockly.Workspace.prototype.highlightBlock=function(a){if(this.traceOn_&&0!=Blockly.Block.dragMode_&&this.traceOn(!1),this.traceOn_){var b=null;(!a||(b=this.getBlockById(a)))&&(this.traceOn(!1),b?b.select():Blockly.selected&&Blockly.selected.unselect(),this.traceOn(!0))}},Blockly.Workspace.prototype.fireChangeEvent=function(){this.fireChangeEventPid_&&window.clearTimeout(this.fireChangeEventPid_);var a=this.svgBlockCanvas_;a&&(this.fireChangeEventPid_=window.setTimeout(function(){Blockly.fireUiEvent(a,"blocklyWorkspaceChange")},0))},Blockly.Workspace.prototype.paste=function(a){if(!(a.getElementsByTagName("block").length>=this.remainingCapacity())){var b=Blockly.Json.domToBlock(this,a),c=parseInt(a.getAttribute("x"),10),d=parseInt(a.getAttribute("y"),10);if(!isNaN(c)&&!isNaN(d)){Blockly.RTL&&(c=-c);do for(var e,f=!1,g=this.getAllBlocks(),h=0;e=g[h];h++){var i=e.getRelativeToSurfaceXY();Math.abs(c-i.x)<=1&&Math.abs(d-i.y)<=1&&(Blockly.RTL?c-=Blockly.SNAP_RADIUS:c+=Blockly.SNAP_RADIUS,d+=2*Blockly.SNAP_RADIUS,f=!0)}while(f);b.moveBy(c,d)}b.select()}},Blockly.Workspace.prototype.remainingCapacity=function(){return 1/0==this.maxBlocks?1/0:this.maxBlocks-this.getAllBlocks().length},Blockly.Json={},Blockly.Json.getWorkspace=function(a){var b=Blockly.svgSize().width,c={};c.block=[];for(var d,e=a.getTopBlocks(!0),f=0;d=e[f];f++){var g=Blockly.Json.blockToDom_(d),h=d.getRelativeToSurfaceXY();g.x=Blockly.RTL?b-h.x:h.x,g.y=h.y,c.block.push(g)}return c},Blockly.Json.blockToDom_=function(a){function b(a){if(a.name&&a.EDITABLE){var b={};b.name=a.name,b.value=a.getValue(),null==c.fields&&(c.fields=[]),c.fields.push(b)}}var c={};if(c.type=a.type,c.id=a.id,a.mutationToDom){var d=a.mutationToDom();d&&(c.mutation=d)}for(var e,f=0;e=a.inputList[f];f++)for(var g,h=0;g=e.fieldRow[h];h++)b(g);if(a.comment){var i={};i.text=a.comment.getText(),i.pinned=a.comment.isVisible();var j=a.comment.getBubbleSize();i.h=j.height,i.w=j.width,c.comment=i}for(var e,k=!1,l=0;e=a.inputList[l];l++){var m={};if(e.type!=Blockly.DUMMY_INPUT){var n=e.connection.targetBlock();e.type==Blockly.INPUT_VALUE?(m.type="value",k=!0):e.type==Blockly.NEXT_STATEMENT&&(m.type="statement"),n&&(null==c.children&&(c.children=[]),m.name=e.name,m.block=Blockly.Json.blockToDom_(n),c.children.push(m))}}if(k&&(c.inline=a.inputsInline),a.isCollapsed()&&(c.collapsed=!0),a.disabled&&(c.disabled=!0),a.isDeletable()||(c.deletable=!1),a.isMovable()||(c.movable=!1),a.isEditable()||(c.editable=!1),a.nextConnection){var o=a.nextConnection.targetBlock();o&&(c.next=Blockly.Json.blockToDom_(o))}return c},Blockly.Json.setWorkspace=function(a,b){var c=Blockly.svgSize().width;if(null!=b&&null!=b.block)for(var d=[].concat(b.block),e=0;e<d.length;e++){var f=d[e],g=Blockly.Json.domToBlock(a,f),h=parseInt(g.x,10),i=parseInt(g.y,10);isNaN(h)||isNaN(i)||g.moveBy(Blockly.RTL?c-h:h,i)}},Blockly.Json.domToBlock=function(a,b,c){var d=null,e=b.type;if(!e)return console.log("Block type unspecified"),null;var f=b.id;if(c&&f){if(d=Blockly.Block.getById(f,a),!d)return console.log("Couldn't get Block with id: "+f),null;var g=d.getParent();d.workspace&&d.dispose(!0,!1,!0),d.fill(a,e),d.parent_=g}else d=Blockly.Block.obtain(a,e);d.svg_||d.initSvg();var h=b.inline;null!=h&&d.setInputsInline(this.parseBoolean(h));var i=b.disabled;null!=i&&d.setDisabled(this.parseBoolean(i));var j=b.deletable;null!=j&&d.setDeletable(this.parseBoolean(j));var k=b.movable;null!=k&&d.setMovable(this.parseBoolean(k));var l=b.editable;if(null!=l&&d.setEditable(this.parseBoolean(l)),null!=b.mutation&&d.domToMutation&&d.domToMutation(b.mutation),null!=b.comment){d.setCommentText(b.comment.text);var m=b.comment.pinned;m&&d.comment.setVisible(this.parseBoolean(m));var n=parseInt(b.comment.w,10),o=parseInt(b.comment.h,10);isNaN(n)||isNaN(o)||d.comment.setBubbleSize(n,o)}if(null!=b.fields)for(var p=[].concat(b.fields),q=0;q<p.length;q++)null!=p[q].value&&null!=p[q].name&&d.setFieldValue(p[q].value,p[q].name);var r=null;if(null!=b.children)for(var s=[].concat(b.children),t=0;t<s.length;t++){var u,v=s[t];if(null!=v.block){if(u=d.getInput(v.name),!u){console.log("Input "+v.name+" does not exist in block "+e);continue}r=Blockly.Json.domToBlock(a,v.block,c),r.outputConnection?u.connection.connect(r.outputConnection):r.previousConnection?u.connection.connect(r.previousConnection):console.log("Child block does not have output or previous statement.")}}b.next&&(d.nextConnection?d.nextConnection.targetConnection&&console.log("Next statement is already connected."):console.log("Next statement does not exist."),r=Blockly.Json.domToBlock(a,b.next,c),r.previousConnection?d.nextConnection.connect(r.previousConnection):console.log("Next block does not have previous statement."));var w=b.collapsed;null!=w&&d.setCollapsed(this.parseBoolean(w));var x=d.nextConnection&&d.nextConnection.targetBlock();return x?x.render():d.render(),d},Blockly.Json.parseBoolean=function(a){return 1==a||0==a?a:"true"==a?!0:!1},Blockly.Json.deleteNext=function(a){if(null!=a.children)for(var b=[].concat(a.children),c=0;c<b.length;c++);},Blockly.Xml={},Blockly.Xml.workspaceToDom=function(a){for(var b,c=Blockly.svgSize().width,d=Ext.DomHelper.createDom({tag:"xml"}),e=a.getTopBlocks(!0),f=0;b=e[f];f++){var g=Blockly.Xml.blockToDom_(b),h=b.getRelativeToSurfaceXY();g.setAttribute("x",Blockly.RTL?c-h.x:h.x),g.setAttribute("y",h.y),d.appendChild(g)}return d},Blockly.Xml.blockToDom_=function(a){function b(a){if(a.name&&a.EDITABLE){var b=Ext.DomHelper.createDom({tag:"field",children:a.getValue()});b.setAttribute("name",a.name),c.appendChild(b)}}var c=Ext.DomHelper.createDom({tag:"block",type:a.type,id:a.id});if(c.setAttribute("type",a.type),c.setAttribute("id",a.id),a.mutationToDom){var d=a.mutationToDom();d&&c.appendChild(d)}for(var e,f=0;e=a.inputList[f];f++)for(var g,h=0;g=e.fieldRow[h];h++)b(g);if(a.comment){var i=Ext.DomHelper.createDom({tag:"comment",children:a.comment.getText()});i.setAttribute("pinned",a.comment.isVisible());var j=a.comment.getBubbleSize();i.setAttribute("h",j.height),i.setAttribute("w",j.width),c.appendChild(i)}for(var e,k=!1,l=0;e=a.inputList[l];l++){var m,n=!0;if(e.type!=Blockly.DUMMY_INPUT){var o=e.connection.targetBlock();e.type==Blockly.INPUT_VALUE?(m=Ext.DomHelper.createDom({tag:"value"}),k=!0):e.type==Blockly.NEXT_STATEMENT&&(m=Ext.DomHelper.createDom({tag:"statement"})),o&&(m.appendChild(Blockly.Xml.blockToDom_(o)),n=!1),m.setAttribute("name",e.name),n||c.appendChild(m)}}if(k&&c.setAttribute("inline",a.inputsInline),a.isCollapsed()&&c.setAttribute("collapsed",!0),a.disabled&&c.setAttribute("disabled",!0),a.isDeletable()||c.setAttribute("deletable",!1),a.isMovable()||c.setAttribute("movable",!1),a.isEditable()||c.setAttribute("editable",!1),a.nextConnection){var p=a.nextConnection.targetBlock();if(p){var m=Ext.DomHelper.createDom({tag:"next",children:Blockly.Xml.blockToDom_(p)});c.appendChild(m)}}return c},Blockly.Xml.domToText=function(a){var b=new XMLSerializer;return b.serializeToString(a)},Blockly.Xml.domToPrettyText=function(a){for(var b=Blockly.Xml.domToText(a),c=b.split("<"),d="",e=1;e<c.length;e++){var f=c[e];"/"==f[0]&&(d=d.substring(2)),c[e]=d+"<"+f,"/"!=f[0]&&"/>"!=f.slice(-2)&&(d+="  ")}var g=c.join("\n");return g=g.replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>"),g.replace(/^\n/,"")},Blockly.Xml.textToDom=function(a){var b=new DOMParser,c=b.parseFromString(a,"text/xml");if(!c||!c.firstChild||"xml"!=c.firstChild.nodeName.toLowerCase()||c.firstChild!==c.lastChild)throw"Blockly.Xml.textToDom did not obtain a valid XML tree.";return c.firstChild},Blockly.Xml.domToWorkspace=function(a,b){for(var c,d=Blockly.svgSize().width,e=0;c=b.childNodes[e];e++)if("block"==c.nodeName.toLowerCase()){var f=Blockly.Xml.domToBlock(a,c),g=parseInt(c.getAttribute("x"),10),h=parseInt(c.getAttribute("y"),10);isNaN(g)||isNaN(h)||f.moveBy(Blockly.RTL?d-g:g,h)}},Blockly.Xml.domToBlock=function(a,b,c){var d=null,e=b.getAttribute("type");if(!e)throw"Block type unspecified: \n"+b.outerHTML;var f=b.getAttribute("id");if(c&&f){if(d=Blockly.Block.getById(f,a),!d)throw"Couldn't get Block with id: "+f;var g=d.getParent();d.workspace&&d.dispose(!0,!1,!0),d.fill(a,e),d.parent_=g}else d=Blockly.Block.obtain(a,e);d.svg_||d.initSvg();var h=b.getAttribute("inline");h&&d.setInputsInline("true"==h);var i=b.getAttribute("disabled");i&&d.setDisabled("true"==i);var j=b.getAttribute("deletable");j&&d.setDeletable("true"==j);var k=b.getAttribute("movable");k&&d.setMovable("true"==k);var l=b.getAttribute("editable");l&&d.setEditable("true"==l);for(var m,n=null,o=0;m=b.childNodes[o];o++)if(3!=m.nodeType||!m.data.match(/^\s*$/)){for(var p,q,r=null,s=0;q=m.childNodes[s];s++)3==q.nodeType&&q.data.match(/^\s*$/)||(r=q);var t=m.getAttribute("name");switch(m.nodeName.toLowerCase()){case"mutation":d.domToMutation&&d.domToMutation(m);break;case"comment":d.setCommentText(m.textContent);var u=m.getAttribute("pinned");u&&d.comment.setVisible("true"==u);var v=parseInt(m.getAttribute("w"),10),w=parseInt(m.getAttribute("h"),10);isNaN(v)||isNaN(w)||d.comment.setBubbleSize(v,w);break;case"title":case"field":d.setFieldValue(m.textContent,t);break;case"value":case"statement":if(p=d.getInput(t),!p)throw"Input "+t+" does not exist in block "+e;if(r&&"block"==r.nodeName.toLowerCase())if(n=Blockly.Xml.domToBlock(a,r,c),n.outputConnection)p.connection.connect(n.outputConnection);else{if(!n.previousConnection)throw"Child block does not have output or previous statement.";p.connection.connect(n.previousConnection)}break;case"next":if(r&&"block"==r.nodeName.toLowerCase()){if(!d.nextConnection)throw"Next statement does not exist.";if(d.nextConnection.targetConnection)throw"Next statement is already connected.";if(n=Blockly.Xml.domToBlock(a,r,c),!n.previousConnection)throw"Next block does not have previous statement.";d.nextConnection.connect(n.previousConnection)}}}var x=b.getAttribute("collapsed");x&&d.setCollapsed("true"==x);var y=d.nextConnection&&d.nextConnection.targetBlock();return y?y.render():d.render(),d},Blockly.Xml.deleteNext=function(a){for(var b,c=0;b=a.childNodes[c];c++)if("next"==b.nodeName.toLowerCase()){a.removeChild(b);break}};